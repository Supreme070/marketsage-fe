c2db674e07fcb5435b99dd0047c580a4
/**
 * Docker Environment Integration Tests for MCP Servers
 * 
 * Tests MCP functionality specifically in Docker environments,
 * including database connections, environment variables, and containerized operations.
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _test = require("@jest/test");
const _setup = require("./setup");
const _child_process = require("child_process");
const _path = /*#__PURE__*/ _interop_require_default(require("path"));
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
(0, _test.describe)('Docker Environment Integration Tests', ()=>{
    let dbManager;
    let performanceTracker;
    (0, _test.beforeAll)(async ()=>{
        // Skip these tests if not in Docker environment
        if (!(0, _setup.isDockerEnvironment)()) {
            console.log('⚠️  Skipping Docker tests - not in Docker environment');
            return;
        }
        dbManager = _setup.TestDatabaseManager.getInstance();
        await dbManager.setup();
        performanceTracker = new _setup.PerformanceTracker();
        console.log('🐳 Running tests in Docker environment');
    }, _setup.testConfig.timeouts.integration);
    (0, _test.afterAll)(async ()=>{
        if (!(0, _setup.isDockerEnvironment)()) return;
        await dbManager.teardown();
    }, _setup.testConfig.timeouts.database);
    (0, _test.beforeEach)(async ()=>{
        if (!(0, _setup.isDockerEnvironment)()) return;
        performanceTracker.reset();
    });
    (0, _test.describe)('Docker Environment Detection', ()=>{
        (0, _test.test)('should detect Docker environment correctly', ()=>{
            if (!(0, _setup.isDockerEnvironment)()) {
                console.log('📍 Running in local environment');
                return;
            }
            (0, _test.expect)((0, _setup.isDockerEnvironment)()).toBe(true);
            // Check for Docker-specific environment variables
            (0, _test.expect)(process.env.DATABASE_URL).toContain('marketsage-db');
            console.log('🐳 Docker environment detected');
        });
        (0, _test.test)('should have correct Docker database connection', async ()=>{
            if (!(0, _setup.isDockerEnvironment)()) return;
            performanceTracker.start();
            // Test direct database connection
            const result = await _setup.testPrisma.$queryRaw`SELECT version()`;
            const duration = performanceTracker.measure('docker_db_connection');
            (0, _test.expect)(result).toBeDefined();
            (0, _test.expect)(Array.isArray(result)).toBe(true);
            (0, _test.expect)(duration).toBeLessThan(_setup.testConfig.performance.maxQueryTime);
            console.log(`🔌 Docker DB connection: ${duration}ms`);
        });
    });
    (0, _test.describe)('Docker Database Operations', ()=>{
        (0, _test.test)('should perform database operations efficiently in Docker', async ()=>{
            if (!(0, _setup.isDockerEnvironment)()) return;
            performanceTracker.start();
            // Test complex query in Docker environment
            const campaignMetrics = await _setup.testPrisma.mCPCampaignMetrics.findMany({
                include: {
                    organization: true
                },
                where: {
                    campaignType: 'EMAIL'
                },
                orderBy: {
                    calculatedAt: 'desc'
                },
                take: 20
            });
            const duration = performanceTracker.measure('docker_complex_query');
            (0, _test.expect)(campaignMetrics.length).toBeGreaterThan(0);
            (0, _test.expect)(duration).toBeLessThan(_setup.testConfig.performance.maxQueryTime * 2); // Allow more time in Docker
            console.log(`🐳 Docker complex query: ${duration}ms`);
        });
        (0, _test.test)('should handle concurrent database operations in Docker', async ()=>{
            if (!(0, _setup.isDockerEnvironment)()) return;
            const concurrentOperations = Array.from({
                length: 5
            }, async (_, index)=>{
                performanceTracker.start();
                const result = await _setup.testPrisma.mCPCustomerPredictions.findMany({
                    where: {
                        segment: index % 2 === 0 ? 'VIP Customers' : 'Growth Potential'
                    },
                    take: 10
                });
                const duration = performanceTracker.measure(`docker_concurrent_${index}`);
                return {
                    result,
                    duration
                };
            });
            const results = await Promise.all(concurrentOperations);
            results.forEach(({ result, duration }, index)=>{
                (0, _test.expect)(Array.isArray(result)).toBe(true);
                (0, _test.expect)(duration).toBeLessThan(_setup.testConfig.performance.maxResponseTime);
                console.log(`🔄 Docker concurrent operation ${index}: ${duration}ms`);
            });
        });
        (0, _test.test)('should maintain data consistency in Docker environment', async ()=>{
            if (!(0, _setup.isDockerEnvironment)()) return;
            // Test transaction in Docker
            const result = await _setup.testPrisma.$transaction(async (tx)=>{
                const orgCount = await tx.organization.count();
                const contactCount = await tx.contact.count();
                const campaignCount = await tx.mCPCampaignMetrics.count();
                return {
                    orgCount,
                    contactCount,
                    campaignCount
                };
            });
            (0, _test.expect)(result.orgCount).toBeGreaterThan(0);
            (0, _test.expect)(result.contactCount).toBeGreaterThan(0);
            (0, _test.expect)(result.campaignCount).toBeGreaterThan(0);
            console.log('🔒 Docker transaction test passed');
        });
    });
    (0, _test.describe)('Docker Container Health', ()=>{
        (0, _test.test)('should verify Docker container resources', async ()=>{
            if (!(0, _setup.isDockerEnvironment)()) return;
            try {
                // Check container memory usage
                const memInfo = (0, _child_process.execSync)('cat /proc/meminfo | grep MemAvailable', {
                    encoding: 'utf8'
                });
                const availableMemory = parseInt(memInfo.split(':')[1].trim().split(' ')[0]);
                (0, _test.expect)(availableMemory).toBeGreaterThan(100000); // At least 100MB available
                console.log(`🧠 Available memory: ${Math.round(availableMemory / 1024)}MB`);
            } catch (error) {
                console.log('⚠️  Could not check container memory');
            }
        });
        (0, _test.test)('should verify Docker network connectivity', async ()=>{
            if (!(0, _setup.isDockerEnvironment)()) return;
            performanceTracker.start();
            // Test network connectivity to database
            const networkTest = await _setup.testPrisma.$queryRaw`SELECT 1 as connectivity_test`;
            const duration = performanceTracker.measure('docker_network_test');
            (0, _test.expect)(networkTest).toBeDefined();
            (0, _test.expect)(duration).toBeLessThan(_setup.testConfig.performance.maxQueryTime);
            console.log(`🌐 Docker network test: ${duration}ms`);
        });
    });
    (0, _test.describe)('Docker Environment Variables', ()=>{
        (0, _test.test)('should have proper Docker environment configuration', ()=>{
            if (!(0, _setup.isDockerEnvironment)()) return;
            // Verify essential environment variables
            (0, _test.expect)(process.env.DATABASE_URL).toBeDefined();
            (0, _test.expect)(process.env.DATABASE_URL).toContain('marketsage-db');
            // Check if running in container
            (0, _test.expect)(process.env.DOCKER_ENV || process.env.NODE_ENV).toBeDefined();
            console.log('✅ Docker environment variables verified');
        });
        (0, _test.test)('should handle Docker-specific database URL format', async ()=>{
            if (!(0, _setup.isDockerEnvironment)()) return;
            const dbUrl = process.env.DATABASE_URL;
            // Verify Docker internal hostname
            (0, _test.expect)(dbUrl).toContain('marketsage-db:5432');
            // Test connection with Docker URL
            await (0, _test.expect)(_setup.testPrisma.$connect()).resolves.not.toThrow();
            console.log('🔗 Docker database URL format verified');
        });
    });
    (0, _test.describe)('Docker Volume Persistence', ()=>{
        (0, _test.test)('should persist data across container operations', async ()=>{
            if (!(0, _setup.isDockerEnvironment)()) return;
            // Create test data
            const testMetric = await _setup.testPrisma.mCPMonitoringMetrics.create({
                data: {
                    organizationId: 'test-org-1',
                    metricType: 'docker_persistence_test',
                    value: 42.0,
                    timestamp: new Date(),
                    tags: JSON.stringify({
                        test: 'docker_persistence'
                    })
                }
            });
            (0, _test.expect)(testMetric.id).toBeDefined();
            // Verify data exists
            const retrievedMetric = await _setup.testPrisma.mCPMonitoringMetrics.findUnique({
                where: {
                    id: testMetric.id
                }
            });
            (0, _test.expect)(retrievedMetric).toBeDefined();
            (0, _test.expect)(retrievedMetric.metricType).toBe('docker_persistence_test');
            (0, _test.expect)(retrievedMetric.value).toBe(42.0);
            // Clean up
            await _setup.testPrisma.mCPMonitoringMetrics.delete({
                where: {
                    id: testMetric.id
                }
            });
            console.log('💾 Docker volume persistence verified');
        });
    });
    (0, _test.describe)('Docker MCP Integration', ()=>{
        (0, _test.test)('should run MCP seed scripts in Docker environment', async ()=>{
            if (!(0, _setup.isDockerEnvironment)()) return;
            performanceTracker.start();
            // Verify MCP data exists (should be seeded during setup)
            const counts = await dbManager.getDataCounts();
            const duration = performanceTracker.measure('docker_mcp_data_verification');
            (0, _test.expect)(counts.mcpCampaignMetrics).toBeGreaterThan(0);
            (0, _test.expect)(counts.mcpCustomerPredictions).toBeGreaterThan(0);
            (0, _test.expect)(counts.mcpVisitorSessions).toBeGreaterThan(0);
            (0, _test.expect)(counts.mcpMonitoringMetrics).toBeGreaterThan(0);
            (0, _test.expect)(duration).toBeLessThan(_setup.testConfig.performance.maxResponseTime);
            console.log(`🔄 Docker MCP data verification: ${duration}ms`);
            console.log('📊 MCP data counts in Docker:', counts);
        });
        (0, _test.test)('should handle Docker-specific file paths', async ()=>{
            if (!(0, _setup.isDockerEnvironment)()) return;
            // Test that we can access files in Docker container
            try {
                const packageJsonPath = _path.default.resolve(process.cwd(), 'package.json');
                const fs = require('fs');
                (0, _test.expect)(fs.existsSync(packageJsonPath)).toBe(true);
                console.log('📁 Docker file system access verified');
            } catch (error) {
                console.log('⚠️  Docker file system access test failed:', error.message);
            }
        });
    });
    (0, _test.describe)('Docker Performance Benchmarks', ()=>{
        (0, _test.test)('should meet performance standards in Docker environment', async ()=>{
            if (!(0, _setup.isDockerEnvironment)()) return;
            const benchmarkTests = [
                {
                    name: 'Simple Query',
                    test: ()=>_setup.testPrisma.organization.findMany({
                            take: 10
                        })
                },
                {
                    name: 'Complex Join',
                    test: ()=>_setup.testPrisma.mCPCustomerPredictions.findMany({
                            include: {
                                contact: true,
                                organization: true
                            },
                            take: 20
                        })
                },
                {
                    name: 'Aggregation',
                    test: ()=>_setup.testPrisma.mCPCampaignMetrics.aggregate({
                            _avg: {
                                openRate: true,
                                clickRate: true
                            },
                            _count: {
                                id: true
                            }
                        })
                },
                {
                    name: 'Time Series',
                    test: ()=>_setup.testPrisma.mCPMonitoringMetrics.findMany({
                            where: {
                                timestamp: {
                                    gte: new Date(Date.now() - 24 * 60 * 60 * 1000)
                                }
                            },
                            orderBy: {
                                timestamp: 'desc'
                            },
                            take: 100
                        })
                }
            ];
            for (const benchmark of benchmarkTests){
                performanceTracker.start();
                const result = await benchmark.test();
                const duration = performanceTracker.measure(`docker_${benchmark.name.toLowerCase().replace(' ', '_')}`);
                (0, _test.expect)(result).toBeDefined();
                (0, _test.expect)(duration).toBeLessThan(_setup.testConfig.performance.maxResponseTime * 1.5); // Allow 50% more time in Docker
                console.log(`🐳 Docker ${benchmark.name}: ${duration}ms`);
            }
        });
        (0, _test.test)('should handle Docker container resource limits', async ()=>{
            if (!(0, _setup.isDockerEnvironment)()) return;
            // Test memory-intensive operation
            performanceTracker.start();
            const largeDataset = await _setup.testPrisma.mCPVisitorSessions.findMany({
                include: {
                    organization: true
                },
                take: 500 // Larger dataset
            });
            const duration = performanceTracker.measure('docker_memory_intensive');
            (0, _test.expect)(largeDataset.length).toBeGreaterThan(0);
            (0, _test.expect)(duration).toBeLessThan(_setup.testConfig.performance.maxResponseTime * 3); // Allow more time for large dataset
            console.log(`🧠 Docker memory-intensive operation: ${duration}ms`);
        });
    });
    (0, _test.describe)('Docker Error Handling', ()=>{
        (0, _test.test)('should handle Docker-specific connection errors gracefully', async ()=>{
            if (!(0, _setup.isDockerEnvironment)()) return;
            // Test with temporary invalid database URL
            const originalUrl = process.env.DATABASE_URL;
            try {
                // This test verifies error handling rather than actually breaking the connection
                const invalidPrisma = new (require('@prisma/client')).PrismaClient({
                    datasources: {
                        db: {
                            url: 'postgresql://invalid:invalid@invalid-host:5432/invalid'
                        }
                    }
                });
                await (0, _test.expect)(invalidPrisma.$connect()).rejects.toThrow();
                console.log('🚫 Docker connection error handling verified');
            } catch (error) {
                // Expected behavior
                (0, _test.expect)(error).toBeDefined();
            }
        });
    });
    (0, _test.describe)('Docker Performance Summary', ()=>{
        (0, _test.test)('should generate Docker-specific performance report', async ()=>{
            if (!(0, _setup.isDockerEnvironment)()) return;
            const allStats = performanceTracker.getAllStats();
            console.log('\n🐳 Docker Environment Performance Report:');
            console.log('=========================================');
            Object.entries(allStats).forEach(([operation, stats])=>{
                if (operation.startsWith('docker_')) {
                    console.log(`${operation}:`);
                    console.log(`  Average: ${stats.avg.toFixed(2)}ms`);
                    console.log(`  Min: ${stats.min}ms`);
                    console.log(`  Max: ${stats.max}ms`);
                    console.log(`  Count: ${stats.count}`);
                    console.log('');
                }
            });
            // Calculate Docker-specific metrics
            const dockerOperations = Object.entries(allStats).filter(([key])=>key.startsWith('docker_'));
            const dockerAvg = dockerOperations.reduce((sum, [_, stats])=>sum + stats.avg, 0) / dockerOperations.length;
            console.log(`🐳 Docker Average Response Time: ${dockerAvg.toFixed(2)}ms`);
            console.log(`🎯 Docker Performance Target: ${_setup.testConfig.performance.maxResponseTime * 1.5}ms`);
            console.log(`✅ Docker Performance Status: ${dockerAvg < _setup.testConfig.performance.maxResponseTime * 1.5 ? 'PASSED' : 'FAILED'}`);
            (0, _test.expect)(dockerAvg).toBeLessThan(_setup.testConfig.performance.maxResponseTime * 1.5);
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9zdXByZW1lL0Rlc2t0b3AvbWFya2V0c2FnZS9zcmMvX190ZXN0c19fL2ludGVncmF0aW9uL21jcC9kb2NrZXItZW52aXJvbm1lbnQudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIERvY2tlciBFbnZpcm9ubWVudCBJbnRlZ3JhdGlvbiBUZXN0cyBmb3IgTUNQIFNlcnZlcnNcbiAqIFxuICogVGVzdHMgTUNQIGZ1bmN0aW9uYWxpdHkgc3BlY2lmaWNhbGx5IGluIERvY2tlciBlbnZpcm9ubWVudHMsXG4gKiBpbmNsdWRpbmcgZGF0YWJhc2UgY29ubmVjdGlvbnMsIGVudmlyb25tZW50IHZhcmlhYmxlcywgYW5kIGNvbnRhaW5lcml6ZWQgb3BlcmF0aW9ucy5cbiAqL1xuXG5pbXBvcnQgeyBkZXNjcmliZSwgYmVmb3JlQWxsLCBhZnRlckFsbCwgYmVmb3JlRWFjaCwgdGVzdCwgZXhwZWN0IH0gZnJvbSAnQGplc3QvdGVzdCc7XG5pbXBvcnQgeyBUZXN0RGF0YWJhc2VNYW5hZ2VyLCB0ZXN0UHJpc21hLCBQZXJmb3JtYW5jZVRyYWNrZXIsIHRlc3RDb25maWcsIGlzRG9ja2VyRW52aXJvbm1lbnQgfSBmcm9tICcuL3NldHVwJztcbmltcG9ydCB7IGV4ZWNTeW5jIH0gZnJvbSAnY2hpbGRfcHJvY2Vzcyc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcblxuZGVzY3JpYmUoJ0RvY2tlciBFbnZpcm9ubWVudCBJbnRlZ3JhdGlvbiBUZXN0cycsICgpID0+IHtcbiAgbGV0IGRiTWFuYWdlcjogVGVzdERhdGFiYXNlTWFuYWdlcjtcbiAgbGV0IHBlcmZvcm1hbmNlVHJhY2tlcjogUGVyZm9ybWFuY2VUcmFja2VyO1xuXG4gIGJlZm9yZUFsbChhc3luYyAoKSA9PiB7XG4gICAgLy8gU2tpcCB0aGVzZSB0ZXN0cyBpZiBub3QgaW4gRG9ja2VyIGVudmlyb25tZW50XG4gICAgaWYgKCFpc0RvY2tlckVudmlyb25tZW50KCkpIHtcbiAgICAgIGNvbnNvbGUubG9nKCfimqDvuI8gIFNraXBwaW5nIERvY2tlciB0ZXN0cyAtIG5vdCBpbiBEb2NrZXIgZW52aXJvbm1lbnQnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBkYk1hbmFnZXIgPSBUZXN0RGF0YWJhc2VNYW5hZ2VyLmdldEluc3RhbmNlKCk7XG4gICAgYXdhaXQgZGJNYW5hZ2VyLnNldHVwKCk7XG4gICAgcGVyZm9ybWFuY2VUcmFja2VyID0gbmV3IFBlcmZvcm1hbmNlVHJhY2tlcigpO1xuICAgIFxuICAgIGNvbnNvbGUubG9nKCfwn5CzIFJ1bm5pbmcgdGVzdHMgaW4gRG9ja2VyIGVudmlyb25tZW50Jyk7XG4gIH0sIHRlc3RDb25maWcudGltZW91dHMuaW50ZWdyYXRpb24pO1xuXG4gIGFmdGVyQWxsKGFzeW5jICgpID0+IHtcbiAgICBpZiAoIWlzRG9ja2VyRW52aXJvbm1lbnQoKSkgcmV0dXJuO1xuICAgIFxuICAgIGF3YWl0IGRiTWFuYWdlci50ZWFyZG93bigpO1xuICB9LCB0ZXN0Q29uZmlnLnRpbWVvdXRzLmRhdGFiYXNlKTtcblxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICBpZiAoIWlzRG9ja2VyRW52aXJvbm1lbnQoKSkgcmV0dXJuO1xuICAgIFxuICAgIHBlcmZvcm1hbmNlVHJhY2tlci5yZXNldCgpO1xuICB9KTtcblxuICBkZXNjcmliZSgnRG9ja2VyIEVudmlyb25tZW50IERldGVjdGlvbicsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgZGV0ZWN0IERvY2tlciBlbnZpcm9ubWVudCBjb3JyZWN0bHknLCAoKSA9PiB7XG4gICAgICBpZiAoIWlzRG9ja2VyRW52aXJvbm1lbnQoKSkge1xuICAgICAgICBjb25zb2xlLmxvZygn8J+TjSBSdW5uaW5nIGluIGxvY2FsIGVudmlyb25tZW50Jyk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgZXhwZWN0KGlzRG9ja2VyRW52aXJvbm1lbnQoKSkudG9CZSh0cnVlKTtcbiAgICAgIFxuICAgICAgLy8gQ2hlY2sgZm9yIERvY2tlci1zcGVjaWZpYyBlbnZpcm9ubWVudCB2YXJpYWJsZXNcbiAgICAgIGV4cGVjdChwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkwpLnRvQ29udGFpbignbWFya2V0c2FnZS1kYicpO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZygn8J+QsyBEb2NrZXIgZW52aXJvbm1lbnQgZGV0ZWN0ZWQnKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYXZlIGNvcnJlY3QgRG9ja2VyIGRhdGFiYXNlIGNvbm5lY3Rpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBpZiAoIWlzRG9ja2VyRW52aXJvbm1lbnQoKSkgcmV0dXJuO1xuXG4gICAgICBwZXJmb3JtYW5jZVRyYWNrZXIuc3RhcnQoKTtcbiAgICAgIFxuICAgICAgLy8gVGVzdCBkaXJlY3QgZGF0YWJhc2UgY29ubmVjdGlvblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGVzdFByaXNtYS4kcXVlcnlSYXdgU0VMRUNUIHZlcnNpb24oKWA7XG4gICAgICBcbiAgICAgIGNvbnN0IGR1cmF0aW9uID0gcGVyZm9ybWFuY2VUcmFja2VyLm1lYXN1cmUoJ2RvY2tlcl9kYl9jb25uZWN0aW9uJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoQXJyYXkuaXNBcnJheShyZXN1bHQpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGR1cmF0aW9uKS50b0JlTGVzc1RoYW4odGVzdENvbmZpZy5wZXJmb3JtYW5jZS5tYXhRdWVyeVRpbWUpO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZyhg8J+UjCBEb2NrZXIgREIgY29ubmVjdGlvbjogJHtkdXJhdGlvbn1tc2ApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRG9ja2VyIERhdGFiYXNlIE9wZXJhdGlvbnMnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIHBlcmZvcm0gZGF0YWJhc2Ugb3BlcmF0aW9ucyBlZmZpY2llbnRseSBpbiBEb2NrZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBpZiAoIWlzRG9ja2VyRW52aXJvbm1lbnQoKSkgcmV0dXJuO1xuXG4gICAgICBwZXJmb3JtYW5jZVRyYWNrZXIuc3RhcnQoKTtcbiAgICAgIFxuICAgICAgLy8gVGVzdCBjb21wbGV4IHF1ZXJ5IGluIERvY2tlciBlbnZpcm9ubWVudFxuICAgICAgY29uc3QgY2FtcGFpZ25NZXRyaWNzID0gYXdhaXQgdGVzdFByaXNtYS5tQ1BDYW1wYWlnbk1ldHJpY3MuZmluZE1hbnkoe1xuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgb3JnYW5pemF0aW9uOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgY2FtcGFpZ25UeXBlOiAnRU1BSUwnXG4gICAgICAgIH0sXG4gICAgICAgIG9yZGVyQnk6IHsgY2FsY3VsYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgICAgdGFrZTogMjBcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zdCBkdXJhdGlvbiA9IHBlcmZvcm1hbmNlVHJhY2tlci5tZWFzdXJlKCdkb2NrZXJfY29tcGxleF9xdWVyeScpO1xuICAgICAgXG4gICAgICBleHBlY3QoY2FtcGFpZ25NZXRyaWNzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgZXhwZWN0KGR1cmF0aW9uKS50b0JlTGVzc1RoYW4odGVzdENvbmZpZy5wZXJmb3JtYW5jZS5tYXhRdWVyeVRpbWUgKiAyKTsgLy8gQWxsb3cgbW9yZSB0aW1lIGluIERvY2tlclxuICAgICAgXG4gICAgICBjb25zb2xlLmxvZyhg8J+QsyBEb2NrZXIgY29tcGxleCBxdWVyeTogJHtkdXJhdGlvbn1tc2ApO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBjb25jdXJyZW50IGRhdGFiYXNlIG9wZXJhdGlvbnMgaW4gRG9ja2VyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKCFpc0RvY2tlckVudmlyb25tZW50KCkpIHJldHVybjtcblxuICAgICAgY29uc3QgY29uY3VycmVudE9wZXJhdGlvbnMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiA1IH0sIGFzeW5jIChfLCBpbmRleCkgPT4ge1xuICAgICAgICBwZXJmb3JtYW5jZVRyYWNrZXIuc3RhcnQoKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRlc3RQcmlzbWEubUNQQ3VzdG9tZXJQcmVkaWN0aW9ucy5maW5kTWFueSh7XG4gICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgIHNlZ21lbnQ6IGluZGV4ICUgMiA9PT0gMCA/ICdWSVAgQ3VzdG9tZXJzJyA6ICdHcm93dGggUG90ZW50aWFsJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdGFrZTogMTBcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBkdXJhdGlvbiA9IHBlcmZvcm1hbmNlVHJhY2tlci5tZWFzdXJlKGBkb2NrZXJfY29uY3VycmVudF8ke2luZGV4fWApO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHsgcmVzdWx0LCBkdXJhdGlvbiB9O1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChjb25jdXJyZW50T3BlcmF0aW9ucyk7XG4gICAgICBcbiAgICAgIHJlc3VsdHMuZm9yRWFjaCgoeyByZXN1bHQsIGR1cmF0aW9uIH0sIGluZGV4KSA9PiB7XG4gICAgICAgIGV4cGVjdChBcnJheS5pc0FycmF5KHJlc3VsdCkpLnRvQmUodHJ1ZSk7XG4gICAgICAgIGV4cGVjdChkdXJhdGlvbikudG9CZUxlc3NUaGFuKHRlc3RDb25maWcucGVyZm9ybWFuY2UubWF4UmVzcG9uc2VUaW1lKTtcbiAgICAgICAgY29uc29sZS5sb2coYPCflIQgRG9ja2VyIGNvbmN1cnJlbnQgb3BlcmF0aW9uICR7aW5kZXh9OiAke2R1cmF0aW9ufW1zYCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBtYWludGFpbiBkYXRhIGNvbnNpc3RlbmN5IGluIERvY2tlciBlbnZpcm9ubWVudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGlmICghaXNEb2NrZXJFbnZpcm9ubWVudCgpKSByZXR1cm47XG5cbiAgICAgIC8vIFRlc3QgdHJhbnNhY3Rpb24gaW4gRG9ja2VyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0ZXN0UHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgY29uc3Qgb3JnQ291bnQgPSBhd2FpdCB0eC5vcmdhbml6YXRpb24uY291bnQoKTtcbiAgICAgICAgY29uc3QgY29udGFjdENvdW50ID0gYXdhaXQgdHguY29udGFjdC5jb3VudCgpO1xuICAgICAgICBjb25zdCBjYW1wYWlnbkNvdW50ID0gYXdhaXQgdHgubUNQQ2FtcGFpZ25NZXRyaWNzLmNvdW50KCk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4geyBvcmdDb3VudCwgY29udGFjdENvdW50LCBjYW1wYWlnbkNvdW50IH07XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5vcmdDb3VudCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5jb250YWN0Q291bnQpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY2FtcGFpZ25Db3VudCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZygn8J+UkiBEb2NrZXIgdHJhbnNhY3Rpb24gdGVzdCBwYXNzZWQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0RvY2tlciBDb250YWluZXIgSGVhbHRoJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCB2ZXJpZnkgRG9ja2VyIGNvbnRhaW5lciByZXNvdXJjZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBpZiAoIWlzRG9ja2VyRW52aXJvbm1lbnQoKSkgcmV0dXJuO1xuXG4gICAgICB0cnkge1xuICAgICAgICAvLyBDaGVjayBjb250YWluZXIgbWVtb3J5IHVzYWdlXG4gICAgICAgIGNvbnN0IG1lbUluZm8gPSBleGVjU3luYygnY2F0IC9wcm9jL21lbWluZm8gfCBncmVwIE1lbUF2YWlsYWJsZScsIHsgZW5jb2Rpbmc6ICd1dGY4JyB9KTtcbiAgICAgICAgY29uc3QgYXZhaWxhYmxlTWVtb3J5ID0gcGFyc2VJbnQobWVtSW5mby5zcGxpdCgnOicpWzFdLnRyaW0oKS5zcGxpdCgnICcpWzBdKTtcbiAgICAgICAgXG4gICAgICAgIGV4cGVjdChhdmFpbGFibGVNZW1vcnkpLnRvQmVHcmVhdGVyVGhhbigxMDAwMDApOyAvLyBBdCBsZWFzdCAxMDBNQiBhdmFpbGFibGVcbiAgICAgICAgXG4gICAgICAgIGNvbnNvbGUubG9nKGDwn6egIEF2YWlsYWJsZSBtZW1vcnk6ICR7TWF0aC5yb3VuZChhdmFpbGFibGVNZW1vcnkgLyAxMDI0KX1NQmApO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ+KaoO+4jyAgQ291bGQgbm90IGNoZWNrIGNvbnRhaW5lciBtZW1vcnknKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCB2ZXJpZnkgRG9ja2VyIG5ldHdvcmsgY29ubmVjdGl2aXR5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKCFpc0RvY2tlckVudmlyb25tZW50KCkpIHJldHVybjtcblxuICAgICAgcGVyZm9ybWFuY2VUcmFja2VyLnN0YXJ0KCk7XG4gICAgICBcbiAgICAgIC8vIFRlc3QgbmV0d29yayBjb25uZWN0aXZpdHkgdG8gZGF0YWJhc2VcbiAgICAgIGNvbnN0IG5ldHdvcmtUZXN0ID0gYXdhaXQgdGVzdFByaXNtYS4kcXVlcnlSYXdgU0VMRUNUIDEgYXMgY29ubmVjdGl2aXR5X3Rlc3RgO1xuICAgICAgXG4gICAgICBjb25zdCBkdXJhdGlvbiA9IHBlcmZvcm1hbmNlVHJhY2tlci5tZWFzdXJlKCdkb2NrZXJfbmV0d29ya190ZXN0Jyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChuZXR3b3JrVGVzdCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChkdXJhdGlvbikudG9CZUxlc3NUaGFuKHRlc3RDb25maWcucGVyZm9ybWFuY2UubWF4UXVlcnlUaW1lKTtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coYPCfjJAgRG9ja2VyIG5ldHdvcmsgdGVzdDogJHtkdXJhdGlvbn1tc2ApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRG9ja2VyIEVudmlyb25tZW50IFZhcmlhYmxlcycsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgaGF2ZSBwcm9wZXIgRG9ja2VyIGVudmlyb25tZW50IGNvbmZpZ3VyYXRpb24nLCAoKSA9PiB7XG4gICAgICBpZiAoIWlzRG9ja2VyRW52aXJvbm1lbnQoKSkgcmV0dXJuO1xuXG4gICAgICAvLyBWZXJpZnkgZXNzZW50aWFsIGVudmlyb25tZW50IHZhcmlhYmxlc1xuICAgICAgZXhwZWN0KHByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkwpLnRvQ29udGFpbignbWFya2V0c2FnZS1kYicpO1xuICAgICAgXG4gICAgICAvLyBDaGVjayBpZiBydW5uaW5nIGluIGNvbnRhaW5lclxuICAgICAgZXhwZWN0KHByb2Nlc3MuZW52LkRPQ0tFUl9FTlYgfHwgcHJvY2Vzcy5lbnYuTk9ERV9FTlYpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKCfinIUgRG9ja2VyIGVudmlyb25tZW50IHZhcmlhYmxlcyB2ZXJpZmllZCcpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBEb2NrZXItc3BlY2lmaWMgZGF0YWJhc2UgVVJMIGZvcm1hdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGlmICghaXNEb2NrZXJFbnZpcm9ubWVudCgpKSByZXR1cm47XG5cbiAgICAgIGNvbnN0IGRiVXJsID0gcHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMO1xuICAgICAgXG4gICAgICAvLyBWZXJpZnkgRG9ja2VyIGludGVybmFsIGhvc3RuYW1lXG4gICAgICBleHBlY3QoZGJVcmwpLnRvQ29udGFpbignbWFya2V0c2FnZS1kYjo1NDMyJyk7XG4gICAgICBcbiAgICAgIC8vIFRlc3QgY29ubmVjdGlvbiB3aXRoIERvY2tlciBVUkxcbiAgICAgIGF3YWl0IGV4cGVjdCh0ZXN0UHJpc21hLiRjb25uZWN0KCkpLnJlc29sdmVzLm5vdC50b1Rocm93KCk7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKCfwn5SXIERvY2tlciBkYXRhYmFzZSBVUkwgZm9ybWF0IHZlcmlmaWVkJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdEb2NrZXIgVm9sdW1lIFBlcnNpc3RlbmNlJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBwZXJzaXN0IGRhdGEgYWNyb3NzIGNvbnRhaW5lciBvcGVyYXRpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKCFpc0RvY2tlckVudmlyb25tZW50KCkpIHJldHVybjtcblxuICAgICAgLy8gQ3JlYXRlIHRlc3QgZGF0YVxuICAgICAgY29uc3QgdGVzdE1ldHJpYyA9IGF3YWl0IHRlc3RQcmlzbWEubUNQTW9uaXRvcmluZ01ldHJpY3MuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIG9yZ2FuaXphdGlvbklkOiAndGVzdC1vcmctMScsXG4gICAgICAgICAgbWV0cmljVHlwZTogJ2RvY2tlcl9wZXJzaXN0ZW5jZV90ZXN0JyxcbiAgICAgICAgICB2YWx1ZTogNDIuMCxcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgICAgdGFnczogSlNPTi5zdHJpbmdpZnkoeyB0ZXN0OiAnZG9ja2VyX3BlcnNpc3RlbmNlJyB9KVxuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHRlc3RNZXRyaWMuaWQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBcbiAgICAgIC8vIFZlcmlmeSBkYXRhIGV4aXN0c1xuICAgICAgY29uc3QgcmV0cmlldmVkTWV0cmljID0gYXdhaXQgdGVzdFByaXNtYS5tQ1BNb25pdG9yaW5nTWV0cmljcy5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IHRlc3RNZXRyaWMuaWQgfVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXRyaWV2ZWRNZXRyaWMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmV0cmlldmVkTWV0cmljIS5tZXRyaWNUeXBlKS50b0JlKCdkb2NrZXJfcGVyc2lzdGVuY2VfdGVzdCcpO1xuICAgICAgZXhwZWN0KHJldHJpZXZlZE1ldHJpYyEudmFsdWUpLnRvQmUoNDIuMCk7XG4gICAgICBcbiAgICAgIC8vIENsZWFuIHVwXG4gICAgICBhd2FpdCB0ZXN0UHJpc21hLm1DUE1vbml0b3JpbmdNZXRyaWNzLmRlbGV0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiB0ZXN0TWV0cmljLmlkIH1cbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZygn8J+SviBEb2NrZXIgdm9sdW1lIHBlcnNpc3RlbmNlIHZlcmlmaWVkJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdEb2NrZXIgTUNQIEludGVncmF0aW9uJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBydW4gTUNQIHNlZWQgc2NyaXB0cyBpbiBEb2NrZXIgZW52aXJvbm1lbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBpZiAoIWlzRG9ja2VyRW52aXJvbm1lbnQoKSkgcmV0dXJuO1xuXG4gICAgICBwZXJmb3JtYW5jZVRyYWNrZXIuc3RhcnQoKTtcbiAgICAgIFxuICAgICAgLy8gVmVyaWZ5IE1DUCBkYXRhIGV4aXN0cyAoc2hvdWxkIGJlIHNlZWRlZCBkdXJpbmcgc2V0dXApXG4gICAgICBjb25zdCBjb3VudHMgPSBhd2FpdCBkYk1hbmFnZXIuZ2V0RGF0YUNvdW50cygpO1xuICAgICAgXG4gICAgICBjb25zdCBkdXJhdGlvbiA9IHBlcmZvcm1hbmNlVHJhY2tlci5tZWFzdXJlKCdkb2NrZXJfbWNwX2RhdGFfdmVyaWZpY2F0aW9uJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChjb3VudHMubWNwQ2FtcGFpZ25NZXRyaWNzKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICBleHBlY3QoY291bnRzLm1jcEN1c3RvbWVyUHJlZGljdGlvbnMpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChjb3VudHMubWNwVmlzaXRvclNlc3Npb25zKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICBleHBlY3QoY291bnRzLm1jcE1vbml0b3JpbmdNZXRyaWNzKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICBleHBlY3QoZHVyYXRpb24pLnRvQmVMZXNzVGhhbih0ZXN0Q29uZmlnLnBlcmZvcm1hbmNlLm1heFJlc3BvbnNlVGltZSk7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKGDwn5SEIERvY2tlciBNQ1AgZGF0YSB2ZXJpZmljYXRpb246ICR7ZHVyYXRpb259bXNgKTtcbiAgICAgIGNvbnNvbGUubG9nKCfwn5OKIE1DUCBkYXRhIGNvdW50cyBpbiBEb2NrZXI6JywgY291bnRzKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgRG9ja2VyLXNwZWNpZmljIGZpbGUgcGF0aHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBpZiAoIWlzRG9ja2VyRW52aXJvbm1lbnQoKSkgcmV0dXJuO1xuXG4gICAgICAvLyBUZXN0IHRoYXQgd2UgY2FuIGFjY2VzcyBmaWxlcyBpbiBEb2NrZXIgY29udGFpbmVyXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBwYWNrYWdlSnNvblBhdGggPSBwYXRoLnJlc29sdmUocHJvY2Vzcy5jd2QoKSwgJ3BhY2thZ2UuanNvbicpO1xuICAgICAgICBjb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJyk7XG4gICAgICAgIFxuICAgICAgICBleHBlY3QoZnMuZXhpc3RzU3luYyhwYWNrYWdlSnNvblBhdGgpKS50b0JlKHRydWUpO1xuICAgICAgICBcbiAgICAgICAgY29uc29sZS5sb2coJ/Cfk4EgRG9ja2VyIGZpbGUgc3lzdGVtIGFjY2VzcyB2ZXJpZmllZCcpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ+KaoO+4jyAgRG9ja2VyIGZpbGUgc3lzdGVtIGFjY2VzcyB0ZXN0IGZhaWxlZDonLCBlcnJvci5tZXNzYWdlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0RvY2tlciBQZXJmb3JtYW5jZSBCZW5jaG1hcmtzJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBtZWV0IHBlcmZvcm1hbmNlIHN0YW5kYXJkcyBpbiBEb2NrZXIgZW52aXJvbm1lbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBpZiAoIWlzRG9ja2VyRW52aXJvbm1lbnQoKSkgcmV0dXJuO1xuXG4gICAgICBjb25zdCBiZW5jaG1hcmtUZXN0cyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdTaW1wbGUgUXVlcnknLFxuICAgICAgICAgIHRlc3Q6ICgpID0+IHRlc3RQcmlzbWEub3JnYW5pemF0aW9uLmZpbmRNYW55KHsgdGFrZTogMTAgfSlcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdDb21wbGV4IEpvaW4nLFxuICAgICAgICAgIHRlc3Q6ICgpID0+IHRlc3RQcmlzbWEubUNQQ3VzdG9tZXJQcmVkaWN0aW9ucy5maW5kTWFueSh7XG4gICAgICAgICAgICBpbmNsdWRlOiB7IGNvbnRhY3Q6IHRydWUsIG9yZ2FuaXphdGlvbjogdHJ1ZSB9LFxuICAgICAgICAgICAgdGFrZTogMjBcbiAgICAgICAgICB9KVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ0FnZ3JlZ2F0aW9uJyxcbiAgICAgICAgICB0ZXN0OiAoKSA9PiB0ZXN0UHJpc21hLm1DUENhbXBhaWduTWV0cmljcy5hZ2dyZWdhdGUoe1xuICAgICAgICAgICAgX2F2ZzogeyBvcGVuUmF0ZTogdHJ1ZSwgY2xpY2tSYXRlOiB0cnVlIH0sXG4gICAgICAgICAgICBfY291bnQ6IHsgaWQ6IHRydWUgfVxuICAgICAgICAgIH0pXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiAnVGltZSBTZXJpZXMnLFxuICAgICAgICAgIHRlc3Q6ICgpID0+IHRlc3RQcmlzbWEubUNQTW9uaXRvcmluZ01ldHJpY3MuZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgdGltZXN0YW1wOiB7XG4gICAgICAgICAgICAgICAgZ3RlOiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMjQgKiA2MCAqIDYwICogMTAwMClcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9yZGVyQnk6IHsgdGltZXN0YW1wOiAnZGVzYycgfSxcbiAgICAgICAgICAgIHRha2U6IDEwMFxuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgIF07XG5cbiAgICAgIGZvciAoY29uc3QgYmVuY2htYXJrIG9mIGJlbmNobWFya1Rlc3RzKSB7XG4gICAgICAgIHBlcmZvcm1hbmNlVHJhY2tlci5zdGFydCgpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYmVuY2htYXJrLnRlc3QoKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGR1cmF0aW9uID0gcGVyZm9ybWFuY2VUcmFja2VyLm1lYXN1cmUoYGRvY2tlcl8ke2JlbmNobWFyay5uYW1lLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgnICcsICdfJyl9YCk7XG4gICAgICAgIFxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgICBleHBlY3QoZHVyYXRpb24pLnRvQmVMZXNzVGhhbih0ZXN0Q29uZmlnLnBlcmZvcm1hbmNlLm1heFJlc3BvbnNlVGltZSAqIDEuNSk7IC8vIEFsbG93IDUwJSBtb3JlIHRpbWUgaW4gRG9ja2VyXG4gICAgICAgIFxuICAgICAgICBjb25zb2xlLmxvZyhg8J+QsyBEb2NrZXIgJHtiZW5jaG1hcmsubmFtZX06ICR7ZHVyYXRpb259bXNgKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgRG9ja2VyIGNvbnRhaW5lciByZXNvdXJjZSBsaW1pdHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBpZiAoIWlzRG9ja2VyRW52aXJvbm1lbnQoKSkgcmV0dXJuO1xuXG4gICAgICAvLyBUZXN0IG1lbW9yeS1pbnRlbnNpdmUgb3BlcmF0aW9uXG4gICAgICBwZXJmb3JtYW5jZVRyYWNrZXIuc3RhcnQoKTtcbiAgICAgIFxuICAgICAgY29uc3QgbGFyZ2VEYXRhc2V0ID0gYXdhaXQgdGVzdFByaXNtYS5tQ1BWaXNpdG9yU2Vzc2lvbnMuZmluZE1hbnkoe1xuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgb3JnYW5pemF0aW9uOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIHRha2U6IDUwMCAvLyBMYXJnZXIgZGF0YXNldFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGNvbnN0IGR1cmF0aW9uID0gcGVyZm9ybWFuY2VUcmFja2VyLm1lYXN1cmUoJ2RvY2tlcl9tZW1vcnlfaW50ZW5zaXZlJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChsYXJnZURhdGFzZXQubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICBleHBlY3QoZHVyYXRpb24pLnRvQmVMZXNzVGhhbih0ZXN0Q29uZmlnLnBlcmZvcm1hbmNlLm1heFJlc3BvbnNlVGltZSAqIDMpOyAvLyBBbGxvdyBtb3JlIHRpbWUgZm9yIGxhcmdlIGRhdGFzZXRcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coYPCfp6AgRG9ja2VyIG1lbW9yeS1pbnRlbnNpdmUgb3BlcmF0aW9uOiAke2R1cmF0aW9ufW1zYCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdEb2NrZXIgRXJyb3IgSGFuZGxpbmcnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBEb2NrZXItc3BlY2lmaWMgY29ubmVjdGlvbiBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGlmICghaXNEb2NrZXJFbnZpcm9ubWVudCgpKSByZXR1cm47XG5cbiAgICAgIC8vIFRlc3Qgd2l0aCB0ZW1wb3JhcnkgaW52YWxpZCBkYXRhYmFzZSBVUkxcbiAgICAgIGNvbnN0IG9yaWdpbmFsVXJsID0gcHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMO1xuICAgICAgXG4gICAgICB0cnkge1xuICAgICAgICAvLyBUaGlzIHRlc3QgdmVyaWZpZXMgZXJyb3IgaGFuZGxpbmcgcmF0aGVyIHRoYW4gYWN0dWFsbHkgYnJlYWtpbmcgdGhlIGNvbm5lY3Rpb25cbiAgICAgICAgY29uc3QgaW52YWxpZFByaXNtYSA9IG5ldyAocmVxdWlyZSgnQHByaXNtYS9jbGllbnQnKS5QcmlzbWFDbGllbnQpKHtcbiAgICAgICAgICBkYXRhc291cmNlczoge1xuICAgICAgICAgICAgZGI6IHtcbiAgICAgICAgICAgICAgdXJsOiAncG9zdGdyZXNxbDovL2ludmFsaWQ6aW52YWxpZEBpbnZhbGlkLWhvc3Q6NTQzMi9pbnZhbGlkJ1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBhd2FpdCBleHBlY3QoaW52YWxpZFByaXNtYS4kY29ubmVjdCgpKS5yZWplY3RzLnRvVGhyb3coKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5qrIERvY2tlciBjb25uZWN0aW9uIGVycm9yIGhhbmRsaW5nIHZlcmlmaWVkJyk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAvLyBFeHBlY3RlZCBiZWhhdmlvclxuICAgICAgICBleHBlY3QoZXJyb3IpLnRvQmVEZWZpbmVkKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdEb2NrZXIgUGVyZm9ybWFuY2UgU3VtbWFyeScsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgZ2VuZXJhdGUgRG9ja2VyLXNwZWNpZmljIHBlcmZvcm1hbmNlIHJlcG9ydCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGlmICghaXNEb2NrZXJFbnZpcm9ubWVudCgpKSByZXR1cm47XG5cbiAgICAgIGNvbnN0IGFsbFN0YXRzID0gcGVyZm9ybWFuY2VUcmFja2VyLmdldEFsbFN0YXRzKCk7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKCdcXG7wn5CzIERvY2tlciBFbnZpcm9ubWVudCBQZXJmb3JtYW5jZSBSZXBvcnQ6Jyk7XG4gICAgICBjb25zb2xlLmxvZygnPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0nKTtcbiAgICAgIFxuICAgICAgT2JqZWN0LmVudHJpZXMoYWxsU3RhdHMpLmZvckVhY2goKFtvcGVyYXRpb24sIHN0YXRzXSkgPT4ge1xuICAgICAgICBpZiAob3BlcmF0aW9uLnN0YXJ0c1dpdGgoJ2RvY2tlcl8nKSkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGAke29wZXJhdGlvbn06YCk7XG4gICAgICAgICAgY29uc29sZS5sb2coYCAgQXZlcmFnZTogJHtzdGF0cy5hdmcudG9GaXhlZCgyKX1tc2ApO1xuICAgICAgICAgIGNvbnNvbGUubG9nKGAgIE1pbjogJHtzdGF0cy5taW59bXNgKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgICBNYXg6ICR7c3RhdHMubWF4fW1zYCk7XG4gICAgICAgICAgY29uc29sZS5sb2coYCAgQ291bnQ6ICR7c3RhdHMuY291bnR9YCk7XG4gICAgICAgICAgY29uc29sZS5sb2coJycpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgLy8gQ2FsY3VsYXRlIERvY2tlci1zcGVjaWZpYyBtZXRyaWNzXG4gICAgICBjb25zdCBkb2NrZXJPcGVyYXRpb25zID0gT2JqZWN0LmVudHJpZXMoYWxsU3RhdHMpLmZpbHRlcigoW2tleV0pID0+IGtleS5zdGFydHNXaXRoKCdkb2NrZXJfJykpO1xuICAgICAgY29uc3QgZG9ja2VyQXZnID0gZG9ja2VyT3BlcmF0aW9ucy5yZWR1Y2UoKHN1bSwgW18sIHN0YXRzXSkgPT4gc3VtICsgc3RhdHMuYXZnLCAwKSAvIGRvY2tlck9wZXJhdGlvbnMubGVuZ3RoO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZyhg8J+QsyBEb2NrZXIgQXZlcmFnZSBSZXNwb25zZSBUaW1lOiAke2RvY2tlckF2Zy50b0ZpeGVkKDIpfW1zYCk7XG4gICAgICBjb25zb2xlLmxvZyhg8J+OryBEb2NrZXIgUGVyZm9ybWFuY2UgVGFyZ2V0OiAke3Rlc3RDb25maWcucGVyZm9ybWFuY2UubWF4UmVzcG9uc2VUaW1lICogMS41fW1zYCk7XG4gICAgICBjb25zb2xlLmxvZyhg4pyFIERvY2tlciBQZXJmb3JtYW5jZSBTdGF0dXM6ICR7ZG9ja2VyQXZnIDwgdGVzdENvbmZpZy5wZXJmb3JtYW5jZS5tYXhSZXNwb25zZVRpbWUgKiAxLjUgPyAnUEFTU0VEJyA6ICdGQUlMRUQnfWApO1xuICAgICAgXG4gICAgICBleHBlY3QoZG9ja2VyQXZnKS50b0JlTGVzc1RoYW4odGVzdENvbmZpZy5wZXJmb3JtYW5jZS5tYXhSZXNwb25zZVRpbWUgKiAxLjUpO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJuYW1lcyI6WyJkZXNjcmliZSIsImRiTWFuYWdlciIsInBlcmZvcm1hbmNlVHJhY2tlciIsImJlZm9yZUFsbCIsImlzRG9ja2VyRW52aXJvbm1lbnQiLCJjb25zb2xlIiwibG9nIiwiVGVzdERhdGFiYXNlTWFuYWdlciIsImdldEluc3RhbmNlIiwic2V0dXAiLCJQZXJmb3JtYW5jZVRyYWNrZXIiLCJ0ZXN0Q29uZmlnIiwidGltZW91dHMiLCJpbnRlZ3JhdGlvbiIsImFmdGVyQWxsIiwidGVhcmRvd24iLCJkYXRhYmFzZSIsImJlZm9yZUVhY2giLCJyZXNldCIsInRlc3QiLCJleHBlY3QiLCJ0b0JlIiwicHJvY2VzcyIsImVudiIsIkRBVEFCQVNFX1VSTCIsInRvQ29udGFpbiIsInN0YXJ0IiwicmVzdWx0IiwidGVzdFByaXNtYSIsIiRxdWVyeVJhdyIsImR1cmF0aW9uIiwibWVhc3VyZSIsInRvQmVEZWZpbmVkIiwiQXJyYXkiLCJpc0FycmF5IiwidG9CZUxlc3NUaGFuIiwicGVyZm9ybWFuY2UiLCJtYXhRdWVyeVRpbWUiLCJjYW1wYWlnbk1ldHJpY3MiLCJtQ1BDYW1wYWlnbk1ldHJpY3MiLCJmaW5kTWFueSIsImluY2x1ZGUiLCJvcmdhbml6YXRpb24iLCJ3aGVyZSIsImNhbXBhaWduVHlwZSIsIm9yZGVyQnkiLCJjYWxjdWxhdGVkQXQiLCJ0YWtlIiwibGVuZ3RoIiwidG9CZUdyZWF0ZXJUaGFuIiwiY29uY3VycmVudE9wZXJhdGlvbnMiLCJmcm9tIiwiXyIsImluZGV4IiwibUNQQ3VzdG9tZXJQcmVkaWN0aW9ucyIsInNlZ21lbnQiLCJyZXN1bHRzIiwiUHJvbWlzZSIsImFsbCIsImZvckVhY2giLCJtYXhSZXNwb25zZVRpbWUiLCIkdHJhbnNhY3Rpb24iLCJ0eCIsIm9yZ0NvdW50IiwiY291bnQiLCJjb250YWN0Q291bnQiLCJjb250YWN0IiwiY2FtcGFpZ25Db3VudCIsIm1lbUluZm8iLCJleGVjU3luYyIsImVuY29kaW5nIiwiYXZhaWxhYmxlTWVtb3J5IiwicGFyc2VJbnQiLCJzcGxpdCIsInRyaW0iLCJNYXRoIiwicm91bmQiLCJlcnJvciIsIm5ldHdvcmtUZXN0IiwiRE9DS0VSX0VOViIsIk5PREVfRU5WIiwiZGJVcmwiLCIkY29ubmVjdCIsInJlc29sdmVzIiwibm90IiwidG9UaHJvdyIsInRlc3RNZXRyaWMiLCJtQ1BNb25pdG9yaW5nTWV0cmljcyIsImNyZWF0ZSIsImRhdGEiLCJvcmdhbml6YXRpb25JZCIsIm1ldHJpY1R5cGUiLCJ2YWx1ZSIsInRpbWVzdGFtcCIsIkRhdGUiLCJ0YWdzIiwiSlNPTiIsInN0cmluZ2lmeSIsImlkIiwicmV0cmlldmVkTWV0cmljIiwiZmluZFVuaXF1ZSIsImRlbGV0ZSIsImNvdW50cyIsImdldERhdGFDb3VudHMiLCJtY3BDYW1wYWlnbk1ldHJpY3MiLCJtY3BDdXN0b21lclByZWRpY3Rpb25zIiwibWNwVmlzaXRvclNlc3Npb25zIiwibWNwTW9uaXRvcmluZ01ldHJpY3MiLCJwYWNrYWdlSnNvblBhdGgiLCJwYXRoIiwicmVzb2x2ZSIsImN3ZCIsImZzIiwicmVxdWlyZSIsImV4aXN0c1N5bmMiLCJtZXNzYWdlIiwiYmVuY2htYXJrVGVzdHMiLCJuYW1lIiwiYWdncmVnYXRlIiwiX2F2ZyIsIm9wZW5SYXRlIiwiY2xpY2tSYXRlIiwiX2NvdW50IiwiZ3RlIiwibm93IiwiYmVuY2htYXJrIiwidG9Mb3dlckNhc2UiLCJyZXBsYWNlIiwibGFyZ2VEYXRhc2V0IiwibUNQVmlzaXRvclNlc3Npb25zIiwib3JpZ2luYWxVcmwiLCJpbnZhbGlkUHJpc21hIiwiUHJpc21hQ2xpZW50IiwiZGF0YXNvdXJjZXMiLCJkYiIsInVybCIsInJlamVjdHMiLCJhbGxTdGF0cyIsImdldEFsbFN0YXRzIiwiT2JqZWN0IiwiZW50cmllcyIsIm9wZXJhdGlvbiIsInN0YXRzIiwic3RhcnRzV2l0aCIsImF2ZyIsInRvRml4ZWQiLCJtaW4iLCJtYXgiLCJkb2NrZXJPcGVyYXRpb25zIiwiZmlsdGVyIiwia2V5IiwiZG9ja2VyQXZnIiwicmVkdWNlIiwic3VtIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Q0FLQzs7OztzQkFFdUU7dUJBQzZCOytCQUM1RTs2REFDUjs7Ozs7O0FBRWpCQSxJQUFBQSxjQUFRLEVBQUMsd0NBQXdDO0lBQy9DLElBQUlDO0lBQ0osSUFBSUM7SUFFSkMsSUFBQUEsZUFBUyxFQUFDO1FBQ1IsZ0RBQWdEO1FBQ2hELElBQUksQ0FBQ0MsSUFBQUEsMEJBQW1CLEtBQUk7WUFDMUJDLFFBQVFDLEdBQUcsQ0FBQztZQUNaO1FBQ0Y7UUFF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