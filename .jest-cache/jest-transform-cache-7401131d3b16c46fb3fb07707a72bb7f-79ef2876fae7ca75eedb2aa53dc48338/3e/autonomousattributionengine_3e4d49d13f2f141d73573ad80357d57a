fd916f3f298b3f92ed5f68325103dc70
/**
 * Autonomous Attribution Engine
 * ============================
 * Connects multi-touch attribution with autonomous decision-making
 * Enables AI to make data-driven decisions based on attribution insights
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    AutonomousAttributionEngine: function() {
        return AutonomousAttributionEngine;
    },
    autonomousAttributionEngine: function() {
        return autonomousAttributionEngine;
    }
});
const _logger = require("../logger");
const _api = require("@opentelemetry/api");
const _prisma = /*#__PURE__*/ _interop_require_default(require("../db/prisma"));
const _events = require("events");
const _client = require("@prisma/client");
const _enhancedconversions = require("../enhanced-conversions");
const _strategicdecisionengine = require("../ai/strategic-decision-engine");
const _realtimedecisionengine = require("../ai/realtime-decision-engine");
const _multiagentcoordinator = require("../ai/multi-agent-coordinator");
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
class AutonomousAttributionEngine extends _events.EventEmitter {
    constructor(){
        super(), this.analysisInterval = null, this.decisionQueue = [], this.insightHistory = new Map(), this.performanceBaseline = new Map();
        this.initializeEngine();
    }
    /**
   * Initialize the autonomous attribution engine
   */ async initializeEngine() {
        try {
            _logger.logger.info('Initializing autonomous attribution engine...');
            // Load performance baselines
            await this.loadPerformanceBaselines();
            // Start continuous analysis
            this.startContinuousAnalysis();
            // Register with strategic decision engine
            this.registerWithDecisionEngines();
            _logger.logger.info('Autonomous attribution engine initialized successfully');
        } catch (error) {
            _logger.logger.error('Failed to initialize autonomous attribution engine', {
                error: error instanceof Error ? error.message : String(error)
            });
            throw error;
        }
    }
    /**
   * Load historical performance baselines
   */ async loadPerformanceBaselines() {
        try {
            // Get last 30 days of conversion data
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            const conversions = await _prisma.default.conversionTracking.findMany({
                where: {
                    occurredAt: {
                        gte: thirtyDaysAgo
                    }
                },
                include: {
                    event: true
                }
            });
            // Calculate baseline performance by channel
            const channelData = new Map();
            for (const conversion of conversions){
                const touchPoints = conversion.touchPoints ? JSON.parse(conversion.touchPoints) : [];
                for (const touchPoint of touchPoints){
                    const key = `${touchPoint.entityType}_${touchPoint.type}`;
                    if (!channelData.has(key)) {
                        channelData.set(key, {
                            conversions: 0,
                            revenue: 0,
                            touchPoints: []
                        });
                    }
                    const data = channelData.get(key);
                    data.conversions++;
                    data.revenue += conversion.value || 0;
                    data.touchPoints.push(touchPoint);
                }
            }
            // Convert to performance baselines
            for (const [key, data] of channelData.entries()){
                const [entityType, channel] = key.split('_');
                const performance = {
                    channel,
                    entityType: entityType,
                    conversions: data.conversions,
                    revenue: data.revenue,
                    cost: 0,
                    roi: 0,
                    roas: 0,
                    attribution: {
                        firstTouch: 0,
                        lastTouch: 0,
                        linear: 0,
                        timeDecay: 0,
                        positionBased: 0
                    },
                    trend: 'stable'
                };
                this.performanceBaseline.set(key, performance);
            }
            _logger.logger.info('Loaded performance baselines', {
                channels: this.performanceBaseline.size
            });
        } catch (error) {
            _logger.logger.error('Failed to load performance baselines', {
                error: error instanceof Error ? error.message : String(error)
            });
        }
    }
    /**
   * Start continuous attribution analysis
   */ startContinuousAnalysis() {
        // Run analysis every 30 minutes
        this.analysisInterval = setInterval(async ()=>{
            await this.performAttributionAnalysis();
        }, 30 * 60 * 1000);
        // Run initial analysis
        this.performAttributionAnalysis();
    }
    /**
   * Perform comprehensive attribution analysis
   */ async performAttributionAnalysis() {
        const tracer = _api.trace.getTracer('attribution-analysis');
        return tracer.startActiveSpan('analyze-attribution', async (span)=>{
            try {
                span.setAttributes({
                    'analysis.timestamp': Date.now(),
                    'analysis.type': 'comprehensive'
                });
                _logger.logger.info('Starting autonomous attribution analysis...');
                // Analyze channel performance
                const channelInsights = await this.analyzeChannelPerformance();
                // Analyze customer journey patterns
                const journeyInsights = await this.analyzeJourneyPatterns();
                // Identify conversion drivers
                const driverInsights = await this.identifyConversionDrivers();
                // Detect anomalies
                const anomalyInsights = await this.detectAttributionAnomalies();
                // Generate optimization opportunities
                const optimizationInsights = await this.generateOptimizationOpportunities();
                // Process all insights
                const allInsights = [
                    ...channelInsights,
                    ...journeyInsights,
                    ...driverInsights,
                    ...anomalyInsights,
                    ...optimizationInsights
                ];
                // Generate autonomous actions
                for (const insight of allInsights){
                    if (insight.actionRequired && insight.suggestedActions) {
                        await this.processAutonomousActions(insight);
                    }
                }
                // Store insights
                this.storeInsights(allInsights);
                // Emit analysis complete event
                this.emit('analysis_complete', {
                    timestamp: new Date(),
                    insightCount: allInsights.length,
                    actionsGenerated: this.decisionQueue.length
                });
                _logger.logger.info('Attribution analysis completed', {
                    insights: allInsights.length,
                    actions: this.decisionQueue.length
                });
            } catch (error) {
                span.setStatus({
                    code: 2,
                    message: String(error)
                });
                _logger.logger.error('Attribution analysis failed', {
                    error: error instanceof Error ? error.message : String(error)
                });
            } finally{
                span.end();
            }
        });
    }
    /**
   * Analyze channel performance across attribution models
   */ async analyzeChannelPerformance() {
        const insights = [];
        try {
            // Get recent conversions
            const sevenDaysAgo = new Date();
            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
            const conversions = await _prisma.default.conversionTracking.findMany({
                where: {
                    occurredAt: {
                        gte: sevenDaysAgo
                    }
                },
                include: {
                    event: true
                }
            });
            // Analyze by channel and attribution model
            const channelMetrics = new Map();
            const models = [
                _client.AttributionModel.FIRST_TOUCH,
                _client.AttributionModel.LAST_TOUCH,
                _client.AttributionModel.LINEAR,
                _client.AttributionModel.TIME_DECAY,
                _client.AttributionModel.POSITION_BASED
            ];
            for (const conversion of conversions){
                const touchPoints = conversion.touchPoints ? JSON.parse(conversion.touchPoints) : [];
                if (touchPoints.length === 0) continue;
                // Apply each attribution model
                for (const model of models){
                    const attributedTouchPoints = (0, _enhancedconversions.applyAttributionModel)(touchPoints, model);
                    for (const touchPoint of attributedTouchPoints){
                        const key = `${touchPoint.entityType}_${touchPoint.type}`;
                        if (!channelMetrics.has(key)) {
                            channelMetrics.set(key, {
                                channel: touchPoint.type,
                                entityType: touchPoint.entityType,
                                conversions: 0,
                                revenue: 0,
                                cost: 0,
                                roi: 0,
                                roas: 0,
                                attribution: {
                                    firstTouch: 0,
                                    lastTouch: 0,
                                    linear: 0,
                                    timeDecay: 0,
                                    positionBased: 0
                                },
                                trend: 'stable'
                            });
                        }
                        const metrics = channelMetrics.get(key);
                        const attributionKey = model.toLowerCase().replace('_', '');
                        metrics.conversions += touchPoint.weight || 0;
                        metrics.revenue += (conversion.value || 0) * (touchPoint.weight || 0);
                        metrics.attribution[attributionKey] += touchPoint.weight || 0;
                    }
                }
            }
            // Compare with baselines and generate insights
            for (const [key, metrics] of channelMetrics.entries()){
                const baseline = this.performanceBaseline.get(key);
                if (baseline) {
                    // Calculate trend
                    const conversionChange = (metrics.conversions - baseline.conversions) / baseline.conversions;
                    metrics.trend = conversionChange > 0.1 ? 'improving' : conversionChange < -0.1 ? 'declining' : 'stable';
                    // Check for significant changes
                    if (Math.abs(conversionChange) > 0.2) {
                        const insight = {
                            id: `insight_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                            timestamp: new Date(),
                            type: 'channel_performance',
                            confidence: 0.85,
                            insight: `${metrics.channel} channel ${metrics.trend} with ${Math.round(Math.abs(conversionChange) * 100)}% change in conversions`,
                            details: {
                                channels: [
                                    metrics
                                ],
                                impact: {
                                    revenue: {
                                        current: metrics.revenue,
                                        projected: metrics.revenue * (1 + conversionChange),
                                        change: conversionChange
                                    },
                                    conversions: {
                                        current: metrics.conversions,
                                        projected: metrics.conversions * (1 + conversionChange),
                                        change: conversionChange
                                    },
                                    efficiency: {
                                        currentCPA: metrics.cost / metrics.conversions || 0,
                                        projectedCPA: metrics.cost / (metrics.conversions * (1 + conversionChange)) || 0,
                                        currentROAS: metrics.revenue / metrics.cost || 0,
                                        projectedROAS: metrics.revenue * (1 + conversionChange) / metrics.cost || 0
                                    }
                                }
                            },
                            actionRequired: Math.abs(conversionChange) > 0.3,
                            suggestedActions: this.generateChannelActions(metrics, conversionChange)
                        };
                        insights.push(insight);
                    }
                }
            }
        } catch (error) {
            _logger.logger.error('Channel performance analysis failed', {
                error: error instanceof Error ? error.message : String(error)
            });
        }
        return insights;
    }
    /**
   * Analyze customer journey patterns
   */ async analyzeJourneyPatterns() {
        const insights = [];
        try {
            // Get conversions with multiple touchpoints
            const conversions = await _prisma.default.conversionTracking.findMany({
                where: {
                    touchPoints: {
                        not: null
                    }
                },
                include: {
                    event: true
                },
                take: 1000,
                orderBy: {
                    occurredAt: 'desc'
                }
            });
            // Extract journey patterns
            const patternMap = new Map();
            for (const conversion of conversions){
                const touchPoints = JSON.parse(conversion.touchPoints);
                if (touchPoints.length < 2) continue;
                // Create pattern key
                const patternKey = touchPoints.map((tp)=>`${tp.entityType}_${tp.type}`).join(' -> ');
                if (!patternMap.has(patternKey)) {
                    patternMap.set(patternKey, {
                        id: `pattern_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                        pattern: touchPoints,
                        frequency: 0,
                        avgTimeToConversion: 0,
                        avgValue: 0,
                        conversionRate: 0,
                        channels: [
                            ...new Set(touchPoints.map((tp)=>tp.type))
                        ],
                        significance: 'low',
                        insights: []
                    });
                }
                const pattern = patternMap.get(patternKey);
                pattern.frequency++;
                pattern.avgValue = (pattern.avgValue * (pattern.frequency - 1) + (conversion.value || 0)) / pattern.frequency;
                // Calculate time to conversion
                const firstTouch = new Date(touchPoints[0].timestamp);
                const lastTouch = new Date(touchPoints[touchPoints.length - 1].timestamp);
                const timeToConversion = (lastTouch.getTime() - firstTouch.getTime()) / (1000 * 60 * 60); // hours
                pattern.avgTimeToConversion = (pattern.avgTimeToConversion * (pattern.frequency - 1) + timeToConversion) / pattern.frequency;
            }
            // Analyze significant patterns
            const totalConversions = conversions.length;
            for (const pattern of patternMap.values()){
                pattern.conversionRate = pattern.frequency / totalConversions;
                pattern.significance = pattern.conversionRate > 0.1 ? 'high' : pattern.conversionRate > 0.05 ? 'medium' : 'low';
                if (pattern.significance !== 'low') {
                    // Generate insights
                    pattern.insights = this.generateJourneyInsights(pattern);
                    const insight = {
                        id: `insight_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                        timestamp: new Date(),
                        type: 'journey_pattern',
                        confidence: Math.min(0.6 + pattern.conversionRate, 0.95),
                        insight: `Discovered ${pattern.significance} value journey pattern with ${Math.round(pattern.conversionRate * 100)}% of conversions`,
                        details: {
                            journeyPatterns: [
                                pattern
                            ]
                        },
                        actionRequired: pattern.significance === 'high',
                        suggestedActions: pattern.significance === 'high' ? this.generateJourneyActions(pattern) : undefined
                    };
                    insights.push(insight);
                }
            }
        } catch (error) {
            _logger.logger.error('Journey pattern analysis failed', {
                error: error instanceof Error ? error.message : String(error)
            });
        }
        return insights;
    }
    /**
   * Identify key conversion drivers
   */ async identifyConversionDrivers() {
        const insights = [];
        try {
            // Analyze various conversion factors
            const drivers = [];
            // Channel sequence analysis
            const sequenceDriver = await this.analyzeChannelSequence();
            if (sequenceDriver) drivers.push(sequenceDriver);
            // Timing analysis
            const timingDriver = await this.analyzeConversionTiming();
            if (timingDriver) drivers.push(timingDriver);
            // Frequency analysis
            const frequencyDriver = await this.analyzeTouchpointFrequency();
            if (frequencyDriver) drivers.push(frequencyDriver);
            // Content type analysis
            const contentDriver = await this.analyzeContentPerformance();
            if (contentDriver) drivers.push(contentDriver);
            // Create insights for significant drivers
            const significantDrivers = drivers.filter((d)=>Math.abs(d.impact) > 0.2);
            if (significantDrivers.length > 0) {
                const insight = {
                    id: `insight_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                    timestamp: new Date(),
                    type: 'conversion_driver',
                    confidence: 0.8,
                    insight: `Identified ${significantDrivers.length} key conversion drivers`,
                    details: {
                        conversionDrivers: significantDrivers,
                        recommendations: this.generateDriverRecommendations(significantDrivers)
                    },
                    actionRequired: significantDrivers.some((d)=>Math.abs(d.impact) > 0.4),
                    suggestedActions: this.generateDriverActions(significantDrivers)
                };
                insights.push(insight);
            }
        } catch (error) {
            _logger.logger.error('Conversion driver analysis failed', {
                error: error instanceof Error ? error.message : String(error)
            });
        }
        return insights;
    }
    /**
   * Detect attribution anomalies
   */ async detectAttributionAnomalies() {
        const insights = [];
        try {
            // Compare current performance with historical patterns
            const anomalies = [];
            // Check for sudden channel performance changes
            for (const [key, baseline] of this.performanceBaseline.entries()){
                const current = await this.getCurrentChannelMetrics(key);
                if (current) {
                    const conversionChange = Math.abs((current.conversions - baseline.conversions) / baseline.conversions);
                    const revenueChange = Math.abs((current.revenue - baseline.revenue) / baseline.revenue);
                    if (conversionChange > 0.5 || revenueChange > 0.5) {
                        anomalies.push(`${baseline.channel} showing ${Math.round(Math.max(conversionChange, revenueChange) * 100)}% deviation from baseline`);
                    }
                }
            }
            // Check for unusual journey patterns
            const unusualPatterns = await this.detectUnusualJourneys();
            anomalies.push(...unusualPatterns);
            if (anomalies.length > 0) {
                const insight = {
                    id: `insight_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                    timestamp: new Date(),
                    type: 'anomaly',
                    confidence: 0.75,
                    insight: `Detected ${anomalies.length} attribution anomalies requiring attention`,
                    details: {
                        channels: anomalies.map((a)=>({
                                channel: a,
                                entityType: _client.EntityType.CAMPAIGN,
                                conversions: 0,
                                revenue: 0,
                                cost: 0,
                                roi: 0,
                                roas: 0,
                                attribution: {
                                    firstTouch: 0,
                                    lastTouch: 0,
                                    linear: 0,
                                    timeDecay: 0,
                                    positionBased: 0
                                },
                                trend: 'stable',
                                anomalies: [
                                    a
                                ]
                            }))
                    },
                    actionRequired: true,
                    suggestedActions: [
                        {
                            id: `action_${Date.now()}`,
                            type: 'immediate',
                            action: 'investigate_anomalies',
                            description: 'Investigate and address attribution anomalies',
                            targetEntity: {
                                type: _client.EntityType.CAMPAIGN,
                                id: 'all'
                            },
                            parameters: {
                                anomalies
                            },
                            approvalRequired: false,
                            riskLevel: 'low'
                        }
                    ]
                };
                insights.push(insight);
            }
        } catch (error) {
            _logger.logger.error('Anomaly detection failed', {
                error: error instanceof Error ? error.message : String(error)
            });
        }
        return insights;
    }
    /**
   * Generate optimization opportunities
   */ async generateOptimizationOpportunities() {
        const insights = [];
        try {
            const recommendations = [];
            // Budget reallocation opportunities
            const budgetReco = await this.analyzeBudgetAllocation();
            if (budgetReco) recommendations.push(budgetReco);
            // Channel mix optimization
            const channelMixReco = await this.optimizeChannelMix();
            if (channelMixReco) recommendations.push(channelMixReco);
            // Journey optimization
            const journeyReco = await this.optimizeCustomerJourneys();
            if (journeyReco) recommendations.push(journeyReco);
            // Timing optimization
            const timingReco = await this.optimizeCampaignTiming();
            if (timingReco) recommendations.push(timingReco);
            if (recommendations.length > 0) {
                const insight = {
                    id: `insight_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                    timestamp: new Date(),
                    type: 'optimization_opportunity',
                    confidence: 0.85,
                    insight: `Identified ${recommendations.length} optimization opportunities`,
                    details: {
                        recommendations,
                        impact: this.calculateTotalImpact(recommendations)
                    },
                    actionRequired: recommendations.some((r)=>r.priority === 'high'),
                    suggestedActions: this.generateOptimizationActions(recommendations)
                };
                insights.push(insight);
            }
        } catch (error) {
            _logger.logger.error('Optimization analysis failed', {
                error: error instanceof Error ? error.message : String(error)
            });
        }
        return insights;
    }
    /**
   * Process autonomous actions based on insights
   */ async processAutonomousActions(insight) {
        if (!insight.suggestedActions) return;
        for (const action of insight.suggestedActions){
            // Check risk level and approval requirements
            if (action.riskLevel === 'high' || action.approvalRequired) {
                // Queue for approval
                await this.queueForApproval(action, insight);
            } else if (action.type === 'immediate') {
                // Execute immediately
                await this.executeAutonomousAction(action);
            } else if (action.type === 'scheduled') {
                // Schedule for later execution
                await this.scheduleAction(action);
            } else if (action.type === 'conditional') {
                // Set up monitoring for trigger condition
                await this.setupConditionalTrigger(action);
            }
        }
    }
    /**
   * Execute an autonomous action
   */ async executeAutonomousAction(action) {
        const tracer = _api.trace.getTracer('autonomous-attribution');
        return tracer.startActiveSpan('execute-action', async (span)=>{
            try {
                span.setAttributes({
                    'action.id': action.id,
                    'action.type': action.type,
                    'action.riskLevel': action.riskLevel
                });
                _logger.logger.info('Executing autonomous attribution action', {
                    actionId: action.id,
                    action: action.action,
                    targetEntity: action.targetEntity
                });
                // Execute based on action type
                switch(action.action){
                    case 'reallocate_budget':
                        await this.executeBudgetReallocation(action);
                        break;
                    case 'adjust_channel_mix':
                        await this.executeChannelMixAdjustment(action);
                        break;
                    case 'optimize_journey':
                        await this.executeJourneyOptimization(action);
                        break;
                    case 'update_attribution_model':
                        await this.updateAttributionModel(action);
                        break;
                    case 'pause_underperforming':
                        await this.pauseUnderperformingChannels(action);
                        break;
                    case 'scale_high_performers':
                        await this.scaleHighPerformingChannels(action);
                        break;
                    default:
                        _logger.logger.warn('Unknown autonomous action', {
                            action: action.action
                        });
                }
                // Emit action executed event
                this.emit('action_executed', {
                    actionId: action.id,
                    action: action.action,
                    timestamp: new Date(),
                    success: true
                });
            } catch (error) {
                span.setStatus({
                    code: 2,
                    message: String(error)
                });
                _logger.logger.error('Autonomous action execution failed', {
                    actionId: action.id,
                    error: error instanceof Error ? error.message : String(error)
                });
            } finally{
                span.end();
            }
        });
    }
    /**
   * Register with decision engines for coordination
   */ registerWithDecisionEngines() {
        // Register attribution insights provider
        _strategicdecisionengine.strategicDecisionEngine.registerDataProvider('attribution', {
            getInsights: async ()=>this.getRecentInsights(),
            getMetrics: async ()=>this.getAttributionMetrics(),
            getRecommendations: async ()=>this.getAttributionRecommendations()
        });
        // Register real-time attribution handler
        _realtimedecisionengine.realtimeDecisionEngine.registerHandler('attribution_change', async (event)=>{
            await this.handleRealtimeAttributionChange(event);
        });
        // Register with multi-agent coordinator
        _multiagentcoordinator.multiAgentCoordinator.on('collaboration_request', async (request)=>{
            if (request.capabilities.includes('attribution')) {
                await this.participateInCollaboration(request);
            }
        });
    }
    /**
   * Get recent attribution insights
   */ async getRecentInsights(hours = 24) {
        const cutoff = new Date();
        cutoff.setHours(cutoff.getHours() - hours);
        const allInsights = [];
        for (const insights of this.insightHistory.values()){
            allInsights.push(...insights.filter((i)=>i.timestamp > cutoff));
        }
        return allInsights.sort((a, b)=>b.timestamp.getTime() - a.timestamp.getTime());
    }
    /**
   * Get current attribution metrics
   */ async getAttributionMetrics() {
        const metrics = {
            totalConversions: 0,
            totalRevenue: 0,
            avgTimeToConversion: 0,
            topChannels: [],
            attributionHealth: 'good'
        };
        // Calculate metrics from recent data
        const recentConversions = await _prisma.default.conversionTracking.findMany({
            where: {
                occurredAt: {
                    gte: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000)
                }
            }
        });
        metrics.totalConversions = recentConversions.length;
        metrics.totalRevenue = recentConversions.reduce((sum, c)=>sum + (c.value || 0), 0);
        return metrics;
    }
    /**
   * Get attribution-based recommendations
   */ async getAttributionRecommendations() {
        const insights = await this.getRecentInsights(168); // Last week
        const recommendations = [];
        for (const insight of insights){
            if (insight.details.recommendations) {
                recommendations.push(...insight.details.recommendations);
            }
        }
        return recommendations.sort((a, b)=>{
            const priorityOrder = {
                high: 0,
                medium: 1,
                low: 2
            };
            return priorityOrder[a.priority] - priorityOrder[b.priority];
        });
    }
    /**
   * Handle real-time attribution changes
   */ async handleRealtimeAttributionChange(event) {
        _logger.logger.info('Handling real-time attribution change', {
            event
        });
        // Trigger immediate analysis if significant
        if (event.significance === 'high') {
            await this.performAttributionAnalysis();
        }
    }
    /**
   * Participate in multi-agent collaboration
   */ async participateInCollaboration(request) {
        _logger.logger.info('Participating in multi-agent collaboration for attribution', {
            sessionId: request.sessionId,
            objective: request.objective
        });
        // Provide attribution insights for collaboration
        const insights = await this.getRecentInsights();
        const metrics = await this.getAttributionMetrics();
        return {
            agentId: 'attribution_engine',
            insights,
            metrics,
            recommendations: await this.getAttributionRecommendations()
        };
    }
    // Helper methods for generating actions and recommendations
    generateChannelActions(metrics, change) {
        const actions = [];
        if (change > 0.3) {
            // Channel performing well - scale up
            actions.push({
                id: `action_${Date.now()}_scale`,
                type: 'immediate',
                action: 'scale_high_performers',
                description: `Scale up ${metrics.channel} channel due to ${Math.round(change * 100)}% improvement`,
                targetEntity: {
                    type: metrics.entityType,
                    id: metrics.channel
                },
                parameters: {
                    scalePercentage: Math.min(50, Math.round(change * 100))
                },
                approvalRequired: change > 0.5,
                riskLevel: change > 0.5 ? 'medium' : 'low'
            });
        } else if (change < -0.3) {
            // Channel underperforming - investigate or pause
            actions.push({
                id: `action_${Date.now()}_pause`,
                type: 'conditional',
                action: 'pause_underperforming',
                description: `Consider pausing ${metrics.channel} channel due to ${Math.round(Math.abs(change) * 100)}% decline`,
                targetEntity: {
                    type: metrics.entityType,
                    id: metrics.channel
                },
                parameters: {
                    threshold: -0.4
                },
                trigger: {
                    condition: 'performance_below_threshold',
                    threshold: -0.4
                },
                approvalRequired: true,
                riskLevel: 'medium'
            });
        }
        return actions;
    }
    generateJourneyInsights(pattern) {
        const insights = [];
        if (pattern.avgTimeToConversion < 24) {
            insights.push('Fast conversion journey - customers decide quickly');
        } else if (pattern.avgTimeToConversion > 168) {
            insights.push('Long consideration period - nurturing required');
        }
        if (pattern.channels.length > 3) {
            insights.push('Multi-channel journey - coordination important');
        }
        if (pattern.avgValue > 1000) {
            insights.push('High-value conversion path - prioritize optimization');
        }
        return insights;
    }
    generateJourneyActions(pattern) {
        return [
            {
                id: `action_${Date.now()}_optimize_journey`,
                type: 'scheduled',
                action: 'optimize_journey',
                description: `Optimize high-value journey pattern with ${pattern.frequency} conversions`,
                targetEntity: {
                    type: _client.EntityType.WORKFLOW,
                    id: 'journey_optimization'
                },
                parameters: {
                    pattern: pattern.pattern,
                    targetConversionRate: pattern.conversionRate * 1.2
                },
                approvalRequired: false,
                riskLevel: 'low'
            }
        ];
    }
    generateDriverRecommendations(drivers) {
        return drivers.map((driver)=>({
                id: `reco_${Date.now()}_${driver.factor}`,
                type: driver.type === 'channel' ? 'channel_optimization' : driver.type === 'timing' ? 'timing_change' : 'content_adjustment',
                priority: Math.abs(driver.impact) > 0.4 ? 'high' : 'medium',
                description: driver.description,
                expectedImpact: {
                    conversions: driver.impact * 20,
                    revenue: driver.impact * 25,
                    cost: 5
                },
                implementation: {
                    difficulty: 'medium',
                    timeframe: '1-2 weeks',
                    steps: [
                        `Analyze ${driver.factor}`,
                        'Implement changes',
                        'Monitor results'
                    ]
                }
            }));
    }
    generateDriverActions(drivers) {
        const highImpactDrivers = drivers.filter((d)=>Math.abs(d.impact) > 0.4);
        return highImpactDrivers.map((driver)=>({
                id: `action_${Date.now()}_${driver.factor}`,
                type: 'scheduled',
                action: 'implement_driver_optimization',
                description: `Optimize ${driver.factor} based on attribution analysis`,
                targetEntity: {
                    type: _client.EntityType.CAMPAIGN,
                    id: 'all'
                },
                parameters: {
                    driver,
                    optimization: driver.type
                },
                approvalRequired: driver.type === 'budget_reallocation',
                riskLevel: driver.type === 'budget_reallocation' ? 'medium' : 'low'
            }));
    }
    calculateTotalImpact(recommendations) {
        const current = {
            revenue: 100000,
            conversions: 1000
        }; // Example baseline
        const projectedRevenue = recommendations.reduce((sum, r)=>sum + current.revenue * (r.expectedImpact.revenue / 100), current.revenue);
        const projectedConversions = recommendations.reduce((sum, r)=>sum + current.conversions * (r.expectedImpact.conversions / 100), current.conversions);
        return {
            revenue: {
                current: current.revenue,
                projected: projectedRevenue,
                change: (projectedRevenue - current.revenue) / current.revenue
            },
            conversions: {
                current: current.conversions,
                projected: projectedConversions,
                change: (projectedConversions - current.conversions) / current.conversions
            },
            efficiency: {
                currentCPA: 50,
                projectedCPA: 45,
                currentROAS: 4,
                projectedROAS: 4.5
            }
        };
    }
    generateOptimizationActions(recommendations) {
        return recommendations.filter((r)=>r.priority === 'high').map((r)=>({
                id: `action_${Date.now()}_${r.type}`,
                type: 'scheduled',
                action: `implement_${r.type}`,
                description: r.description,
                targetEntity: {
                    type: _client.EntityType.CAMPAIGN,
                    id: 'optimization_target'
                },
                parameters: {
                    recommendation: r,
                    steps: r.implementation.steps
                },
                approvalRequired: r.implementation.difficulty === 'hard',
                riskLevel: r.implementation.difficulty === 'hard' ? 'high' : r.implementation.difficulty === 'medium' ? 'medium' : 'low'
            }));
    }
    // Stub methods for specific analyses
    async analyzeChannelSequence() {
        // Implementation would analyze optimal channel sequences
        return null;
    }
    async analyzeConversionTiming() {
        // Implementation would analyze optimal timing patterns
        return null;
    }
    async analyzeTouchpointFrequency() {
        // Implementation would analyze optimal contact frequency
        return null;
    }
    async analyzeContentPerformance() {
        // Implementation would analyze content effectiveness
        return null;
    }
    async getCurrentChannelMetrics(key) {
        // Implementation would fetch current metrics
        return null;
    }
    async detectUnusualJourneys() {
        // Implementation would detect anomalous journey patterns
        return [];
    }
    async analyzeBudgetAllocation() {
        // Implementation would analyze and recommend budget changes
        return null;
    }
    async optimizeChannelMix() {
        // Implementation would recommend channel mix changes
        return null;
    }
    async optimizeCustomerJourneys() {
        // Implementation would recommend journey optimizations
        return null;
    }
    async optimizeCampaignTiming() {
        // Implementation would recommend timing optimizations
        return null;
    }
    async queueForApproval(action, insight) {
        _logger.logger.info('Queueing action for approval', {
            actionId: action.id,
            insightId: insight.id
        });
    }
    async scheduleAction(action) {
        _logger.logger.info('Scheduling action for later execution', {
            actionId: action.id
        });
    }
    async setupConditionalTrigger(action) {
        _logger.logger.info('Setting up conditional trigger for action', {
            actionId: action.id,
            trigger: action.trigger
        });
    }
    async executeBudgetReallocation(action) {
        _logger.logger.info('Executing budget reallocation', action.parameters);
    }
    async executeChannelMixAdjustment(action) {
        _logger.logger.info('Executing channel mix adjustment', action.parameters);
    }
    async executeJourneyOptimization(action) {
        _logger.logger.info('Executing journey optimization', action.parameters);
    }
    async updateAttributionModel(action) {
        _logger.logger.info('Updating attribution model', action.parameters);
    }
    async pauseUnderperformingChannels(action) {
        _logger.logger.info('Pausing underperforming channels', action.parameters);
    }
    async scaleHighPerformingChannels(action) {
        _logger.logger.info('Scaling high performing channels', action.parameters);
    }
    storeInsights(insights) {
        const key = new Date().toISOString().split('T')[0]; // Daily key
        if (!this.insightHistory.has(key)) {
            this.insightHistory.set(key, []);
        }
        this.insightHistory.get(key).push(...insights);
        // Keep only last 30 days
        const cutoff = new Date();
        cutoff.setDate(cutoff.getDate() - 30);
        for (const [date, _] of this.insightHistory.entries()){
            if (new Date(date) < cutoff) {
                this.insightHistory.delete(date);
            }
        }
    }
    /**
   * Cleanup and stop the engine
   */ destroy() {
        if (this.analysisInterval) {
            clearInterval(this.analysisInterval);
            this.analysisInterval = null;
        }
        this.removeAllListeners();
        _logger.logger.info('Autonomous attribution engine destroyed');
    }
}
const autonomousAttributionEngine = new AutonomousAttributionEngine();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9zdXByZW1lL0Rlc2t0b3AvbWFya2V0c2FnZS9zcmMvbGliL2F0dHJpYnV0aW9uL2F1dG9ub21vdXMtYXR0cmlidXRpb24tZW5naW5lLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQXV0b25vbW91cyBBdHRyaWJ1dGlvbiBFbmdpbmVcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqIENvbm5lY3RzIG11bHRpLXRvdWNoIGF0dHJpYnV0aW9uIHdpdGggYXV0b25vbW91cyBkZWNpc2lvbi1tYWtpbmdcbiAqIEVuYWJsZXMgQUkgdG8gbWFrZSBkYXRhLWRyaXZlbiBkZWNpc2lvbnMgYmFzZWQgb24gYXR0cmlidXRpb24gaW5zaWdodHNcbiAqL1xuXG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICdAL2xpYi9sb2dnZXInO1xuaW1wb3J0IHsgdHJhY2UgfSBmcm9tICdAb3BlbnRlbGVtZXRyeS9hcGknO1xuaW1wb3J0IHByaXNtYSBmcm9tICdAL2xpYi9kYi9wcmlzbWEnO1xuaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSAnZXZlbnRzJztcbmltcG9ydCB7IFxuICBBdHRyaWJ1dGlvbk1vZGVsLCBcbiAgQ29udmVyc2lvbkNhdGVnb3J5LFxuICBFbnRpdHlUeXBlLFxuICB0eXBlIENvbnZlcnNpb25FdmVudCxcbiAgdHlwZSBDb252ZXJzaW9uVHJhY2tpbmdcbn0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xuaW1wb3J0IHsgXG4gIHRyYWNrQ29udmVyc2lvbiwgXG4gIGFwcGx5QXR0cmlidXRpb25Nb2RlbCxcbiAgZ2V0Q29udmVyc2lvbkF0dHJpYnV0aW9uLFxuICB0eXBlIFRvdWNoUG9pbnRcbn0gZnJvbSAnQC9saWIvZW5oYW5jZWQtY29udmVyc2lvbnMnO1xuaW1wb3J0IHsgc3RyYXRlZ2ljRGVjaXNpb25FbmdpbmUgfSBmcm9tICdAL2xpYi9haS9zdHJhdGVnaWMtZGVjaXNpb24tZW5naW5lJztcbmltcG9ydCB7IHJlYWx0aW1lRGVjaXNpb25FbmdpbmUgfSBmcm9tICdAL2xpYi9haS9yZWFsdGltZS1kZWNpc2lvbi1lbmdpbmUnO1xuaW1wb3J0IHsgbXVsdGlBZ2VudENvb3JkaW5hdG9yIH0gZnJvbSAnQC9saWIvYWkvbXVsdGktYWdlbnQtY29vcmRpbmF0b3InO1xuXG5leHBvcnQgaW50ZXJmYWNlIEF0dHJpYnV0aW9uSW5zaWdodCB7XG4gIGlkOiBzdHJpbmc7XG4gIHRpbWVzdGFtcDogRGF0ZTtcbiAgdHlwZTogJ2NoYW5uZWxfcGVyZm9ybWFuY2UnIHwgJ2pvdXJuZXlfcGF0dGVybicgfCAnY29udmVyc2lvbl9kcml2ZXInIHwgJ29wdGltaXphdGlvbl9vcHBvcnR1bml0eScgfCAnYW5vbWFseSc7XG4gIGNvbmZpZGVuY2U6IG51bWJlcjsgLy8gMC0xXG4gIGluc2lnaHQ6IHN0cmluZztcbiAgZGV0YWlsczoge1xuICAgIGNoYW5uZWxzPzogQ2hhbm5lbFBlcmZvcm1hbmNlW107XG4gICAgam91cm5leVBhdHRlcm5zPzogSm91cm5leVBhdHRlcm5bXTtcbiAgICBjb252ZXJzaW9uRHJpdmVycz86IENvbnZlcnNpb25Ecml2ZXJbXTtcbiAgICByZWNvbW1lbmRhdGlvbnM/OiBBdHRyaWJ1dGlvblJlY29tbWVuZGF0aW9uW107XG4gICAgaW1wYWN0PzogQnVzaW5lc3NJbXBhY3Q7XG4gIH07XG4gIGFjdGlvblJlcXVpcmVkOiBib29sZWFuO1xuICBzdWdnZXN0ZWRBY3Rpb25zPzogQXV0b25vbW91c0FjdGlvbltdO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENoYW5uZWxQZXJmb3JtYW5jZSB7XG4gIGNoYW5uZWw6IHN0cmluZztcbiAgZW50aXR5VHlwZTogRW50aXR5VHlwZTtcbiAgY29udmVyc2lvbnM6IG51bWJlcjtcbiAgcmV2ZW51ZTogbnVtYmVyO1xuICBjb3N0OiBudW1iZXI7XG4gIHJvaTogbnVtYmVyO1xuICByb2FzOiBudW1iZXI7IC8vIFJldHVybiBvbiBBZCBTcGVuZFxuICBhdHRyaWJ1dGlvbjoge1xuICAgIGZpcnN0VG91Y2g6IG51bWJlcjtcbiAgICBsYXN0VG91Y2g6IG51bWJlcjtcbiAgICBsaW5lYXI6IG51bWJlcjtcbiAgICB0aW1lRGVjYXk6IG51bWJlcjtcbiAgICBwb3NpdGlvbkJhc2VkOiBudW1iZXI7XG4gIH07XG4gIHRyZW5kOiAnaW1wcm92aW5nJyB8ICdzdGFibGUnIHwgJ2RlY2xpbmluZyc7XG4gIGFub21hbGllcz86IHN0cmluZ1tdO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEpvdXJuZXlQYXR0ZXJuIHtcbiAgaWQ6IHN0cmluZztcbiAgcGF0dGVybjogVG91Y2hQb2ludFtdO1xuICBmcmVxdWVuY3k6IG51bWJlcjtcbiAgYXZnVGltZVRvQ29udmVyc2lvbjogbnVtYmVyOyAvLyBob3Vyc1xuICBhdmdWYWx1ZTogbnVtYmVyO1xuICBjb252ZXJzaW9uUmF0ZTogbnVtYmVyO1xuICBjaGFubmVsczogc3RyaW5nW107XG4gIHNpZ25pZmljYW5jZTogJ2hpZ2gnIHwgJ21lZGl1bScgfCAnbG93JztcbiAgaW5zaWdodHM6IHN0cmluZ1tdO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENvbnZlcnNpb25Ecml2ZXIge1xuICBmYWN0b3I6IHN0cmluZztcbiAgdHlwZTogJ2NoYW5uZWwnIHwgJ2NvbnRlbnQnIHwgJ3RpbWluZycgfCAnZnJlcXVlbmN5JyB8ICdzZXF1ZW5jZSc7XG4gIGltcGFjdDogbnVtYmVyOyAvLyAtMSB0byAxXG4gIGNvbmZpZGVuY2U6IG51bWJlcjsgLy8gMC0xXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gIGV4YW1wbGVzOiBzdHJpbmdbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBdHRyaWJ1dGlvblJlY29tbWVuZGF0aW9uIHtcbiAgaWQ6IHN0cmluZztcbiAgdHlwZTogJ2J1ZGdldF9yZWFsbG9jYXRpb24nIHwgJ2NoYW5uZWxfb3B0aW1pemF0aW9uJyB8ICdqb3VybmV5X29wdGltaXphdGlvbicgfCAnY29udGVudF9hZGp1c3RtZW50JyB8ICd0aW1pbmdfY2hhbmdlJztcbiAgcHJpb3JpdHk6ICdoaWdoJyB8ICdtZWRpdW0nIHwgJ2xvdyc7XG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gIGV4cGVjdGVkSW1wYWN0OiB7XG4gICAgY29udmVyc2lvbnM6IG51bWJlcjsgLy8gcGVyY2VudGFnZSBjaGFuZ2VcbiAgICByZXZlbnVlOiBudW1iZXI7IC8vIHBlcmNlbnRhZ2UgY2hhbmdlXG4gICAgY29zdDogbnVtYmVyOyAvLyBwZXJjZW50YWdlIGNoYW5nZVxuICB9O1xuICBpbXBsZW1lbnRhdGlvbjoge1xuICAgIGRpZmZpY3VsdHk6ICdlYXN5JyB8ICdtZWRpdW0nIHwgJ2hhcmQnO1xuICAgIHRpbWVmcmFtZTogc3RyaW5nO1xuICAgIHN0ZXBzOiBzdHJpbmdbXTtcbiAgfTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBCdXNpbmVzc0ltcGFjdCB7XG4gIHJldmVudWU6IHtcbiAgICBjdXJyZW50OiBudW1iZXI7XG4gICAgcHJvamVjdGVkOiBudW1iZXI7XG4gICAgY2hhbmdlOiBudW1iZXI7XG4gIH07XG4gIGNvbnZlcnNpb25zOiB7XG4gICAgY3VycmVudDogbnVtYmVyO1xuICAgIHByb2plY3RlZDogbnVtYmVyO1xuICAgIGNoYW5nZTogbnVtYmVyO1xuICB9O1xuICBlZmZpY2llbmN5OiB7XG4gICAgY3VycmVudENQQTogbnVtYmVyOyAvLyBDb3N0IFBlciBBY3F1aXNpdGlvblxuICAgIHByb2plY3RlZENQQTogbnVtYmVyO1xuICAgIGN1cnJlbnRST0FTOiBudW1iZXI7XG4gICAgcHJvamVjdGVkUk9BUzogbnVtYmVyO1xuICB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEF1dG9ub21vdXNBY3Rpb24ge1xuICBpZDogc3RyaW5nO1xuICB0eXBlOiAnaW1tZWRpYXRlJyB8ICdzY2hlZHVsZWQnIHwgJ2NvbmRpdGlvbmFsJztcbiAgYWN0aW9uOiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gIHRhcmdldEVudGl0eToge1xuICAgIHR5cGU6IEVudGl0eVR5cGU7XG4gICAgaWQ6IHN0cmluZztcbiAgfTtcbiAgcGFyYW1ldGVyczogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgdHJpZ2dlcj86IHtcbiAgICBjb25kaXRpb246IHN0cmluZztcbiAgICB0aHJlc2hvbGQ6IG51bWJlcjtcbiAgfTtcbiAgYXBwcm92YWxSZXF1aXJlZDogYm9vbGVhbjtcbiAgcmlza0xldmVsOiAnbG93JyB8ICdtZWRpdW0nIHwgJ2hpZ2gnO1xufVxuXG5jbGFzcyBBdXRvbm9tb3VzQXR0cmlidXRpb25FbmdpbmUgZXh0ZW5kcyBFdmVudEVtaXR0ZXIge1xuICBwcml2YXRlIGFuYWx5c2lzSW50ZXJ2YWw6IE5vZGVKUy5UaW1lb3V0IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgZGVjaXNpb25RdWV1ZTogQXV0b25vbW91c0FjdGlvbltdID0gW107XG4gIHByaXZhdGUgaW5zaWdodEhpc3Rvcnk6IE1hcDxzdHJpbmcsIEF0dHJpYnV0aW9uSW5zaWdodFtdPiA9IG5ldyBNYXAoKTtcbiAgcHJpdmF0ZSBwZXJmb3JtYW5jZUJhc2VsaW5lOiBNYXA8c3RyaW5nLCBDaGFubmVsUGVyZm9ybWFuY2U+ID0gbmV3IE1hcCgpO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5pbml0aWFsaXplRW5naW5lKCk7XG4gIH1cblxuICAvKipcbiAgICogSW5pdGlhbGl6ZSB0aGUgYXV0b25vbW91cyBhdHRyaWJ1dGlvbiBlbmdpbmVcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgaW5pdGlhbGl6ZUVuZ2luZSgpIHtcbiAgICB0cnkge1xuICAgICAgbG9nZ2VyLmluZm8oJ0luaXRpYWxpemluZyBhdXRvbm9tb3VzIGF0dHJpYnV0aW9uIGVuZ2luZS4uLicpO1xuXG4gICAgICAvLyBMb2FkIHBlcmZvcm1hbmNlIGJhc2VsaW5lc1xuICAgICAgYXdhaXQgdGhpcy5sb2FkUGVyZm9ybWFuY2VCYXNlbGluZXMoKTtcblxuICAgICAgLy8gU3RhcnQgY29udGludW91cyBhbmFseXNpc1xuICAgICAgdGhpcy5zdGFydENvbnRpbnVvdXNBbmFseXNpcygpO1xuXG4gICAgICAvLyBSZWdpc3RlciB3aXRoIHN0cmF0ZWdpYyBkZWNpc2lvbiBlbmdpbmVcbiAgICAgIHRoaXMucmVnaXN0ZXJXaXRoRGVjaXNpb25FbmdpbmVzKCk7XG5cbiAgICAgIGxvZ2dlci5pbmZvKCdBdXRvbm9tb3VzIGF0dHJpYnV0aW9uIGVuZ2luZSBpbml0aWFsaXplZCBzdWNjZXNzZnVsbHknKTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBpbml0aWFsaXplIGF1dG9ub21vdXMgYXR0cmlidXRpb24gZW5naW5lJywge1xuICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpXG4gICAgICB9KTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBMb2FkIGhpc3RvcmljYWwgcGVyZm9ybWFuY2UgYmFzZWxpbmVzXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGxvYWRQZXJmb3JtYW5jZUJhc2VsaW5lcygpIHtcbiAgICB0cnkge1xuICAgICAgLy8gR2V0IGxhc3QgMzAgZGF5cyBvZiBjb252ZXJzaW9uIGRhdGFcbiAgICAgIGNvbnN0IHRoaXJ0eURheXNBZ28gPSBuZXcgRGF0ZSgpO1xuICAgICAgdGhpcnR5RGF5c0Fnby5zZXREYXRlKHRoaXJ0eURheXNBZ28uZ2V0RGF0ZSgpIC0gMzApO1xuXG4gICAgICBjb25zdCBjb252ZXJzaW9ucyA9IGF3YWl0IHByaXNtYS5jb252ZXJzaW9uVHJhY2tpbmcuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIG9jY3VycmVkQXQ6IHsgZ3RlOiB0aGlydHlEYXlzQWdvIH1cbiAgICAgICAgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIGV2ZW50OiB0cnVlXG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICAvLyBDYWxjdWxhdGUgYmFzZWxpbmUgcGVyZm9ybWFuY2UgYnkgY2hhbm5lbFxuICAgICAgY29uc3QgY2hhbm5lbERhdGEgPSBuZXcgTWFwPHN0cmluZywgYW55PigpO1xuXG4gICAgICBmb3IgKGNvbnN0IGNvbnZlcnNpb24gb2YgY29udmVyc2lvbnMpIHtcbiAgICAgICAgY29uc3QgdG91Y2hQb2ludHMgPSBjb252ZXJzaW9uLnRvdWNoUG9pbnRzID8gXG4gICAgICAgICAgSlNPTi5wYXJzZShjb252ZXJzaW9uLnRvdWNoUG9pbnRzIGFzIHN0cmluZykgYXMgVG91Y2hQb2ludFtdIDogW107XG5cbiAgICAgICAgZm9yIChjb25zdCB0b3VjaFBvaW50IG9mIHRvdWNoUG9pbnRzKSB7XG4gICAgICAgICAgY29uc3Qga2V5ID0gYCR7dG91Y2hQb2ludC5lbnRpdHlUeXBlfV8ke3RvdWNoUG9pbnQudHlwZX1gO1xuICAgICAgICAgIFxuICAgICAgICAgIGlmICghY2hhbm5lbERhdGEuaGFzKGtleSkpIHtcbiAgICAgICAgICAgIGNoYW5uZWxEYXRhLnNldChrZXksIHtcbiAgICAgICAgICAgICAgY29udmVyc2lvbnM6IDAsXG4gICAgICAgICAgICAgIHJldmVudWU6IDAsXG4gICAgICAgICAgICAgIHRvdWNoUG9pbnRzOiBbXVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29uc3QgZGF0YSA9IGNoYW5uZWxEYXRhLmdldChrZXkpO1xuICAgICAgICAgIGRhdGEuY29udmVyc2lvbnMrKztcbiAgICAgICAgICBkYXRhLnJldmVudWUgKz0gY29udmVyc2lvbi52YWx1ZSB8fCAwO1xuICAgICAgICAgIGRhdGEudG91Y2hQb2ludHMucHVzaCh0b3VjaFBvaW50KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBDb252ZXJ0IHRvIHBlcmZvcm1hbmNlIGJhc2VsaW5lc1xuICAgICAgZm9yIChjb25zdCBba2V5LCBkYXRhXSBvZiBjaGFubmVsRGF0YS5lbnRyaWVzKCkpIHtcbiAgICAgICAgY29uc3QgW2VudGl0eVR5cGUsIGNoYW5uZWxdID0ga2V5LnNwbGl0KCdfJyk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBwZXJmb3JtYW5jZTogQ2hhbm5lbFBlcmZvcm1hbmNlID0ge1xuICAgICAgICAgIGNoYW5uZWwsXG4gICAgICAgICAgZW50aXR5VHlwZTogZW50aXR5VHlwZSBhcyBFbnRpdHlUeXBlLFxuICAgICAgICAgIGNvbnZlcnNpb25zOiBkYXRhLmNvbnZlcnNpb25zLFxuICAgICAgICAgIHJldmVudWU6IGRhdGEucmV2ZW51ZSxcbiAgICAgICAgICBjb3N0OiAwLCAvLyBXb3VsZCBuZWVkIGNvc3QgZGF0YSBmcm9tIGNhbXBhaWduc1xuICAgICAgICAgIHJvaTogMCxcbiAgICAgICAgICByb2FzOiAwLFxuICAgICAgICAgIGF0dHJpYnV0aW9uOiB7XG4gICAgICAgICAgICBmaXJzdFRvdWNoOiAwLFxuICAgICAgICAgICAgbGFzdFRvdWNoOiAwLFxuICAgICAgICAgICAgbGluZWFyOiAwLFxuICAgICAgICAgICAgdGltZURlY2F5OiAwLFxuICAgICAgICAgICAgcG9zaXRpb25CYXNlZDogMFxuICAgICAgICAgIH0sXG4gICAgICAgICAgdHJlbmQ6ICdzdGFibGUnXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5wZXJmb3JtYW5jZUJhc2VsaW5lLnNldChrZXksIHBlcmZvcm1hbmNlKTtcbiAgICAgIH1cblxuICAgICAgbG9nZ2VyLmluZm8oJ0xvYWRlZCBwZXJmb3JtYW5jZSBiYXNlbGluZXMnLCB7XG4gICAgICAgIGNoYW5uZWxzOiB0aGlzLnBlcmZvcm1hbmNlQmFzZWxpbmUuc2l6ZVxuICAgICAgfSk7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gbG9hZCBwZXJmb3JtYW5jZSBiYXNlbGluZXMnLCB7XG4gICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvcilcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTdGFydCBjb250aW51b3VzIGF0dHJpYnV0aW9uIGFuYWx5c2lzXG4gICAqL1xuICBwcml2YXRlIHN0YXJ0Q29udGludW91c0FuYWx5c2lzKCkge1xuICAgIC8vIFJ1biBhbmFseXNpcyBldmVyeSAzMCBtaW51dGVzXG4gICAgdGhpcy5hbmFseXNpc0ludGVydmFsID0gc2V0SW50ZXJ2YWwoYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgdGhpcy5wZXJmb3JtQXR0cmlidXRpb25BbmFseXNpcygpO1xuICAgIH0sIDMwICogNjAgKiAxMDAwKTtcblxuICAgIC8vIFJ1biBpbml0aWFsIGFuYWx5c2lzXG4gICAgdGhpcy5wZXJmb3JtQXR0cmlidXRpb25BbmFseXNpcygpO1xuICB9XG5cbiAgLyoqXG4gICAqIFBlcmZvcm0gY29tcHJlaGVuc2l2ZSBhdHRyaWJ1dGlvbiBhbmFseXNpc1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBwZXJmb3JtQXR0cmlidXRpb25BbmFseXNpcygpIHtcbiAgICBjb25zdCB0cmFjZXIgPSB0cmFjZS5nZXRUcmFjZXIoJ2F0dHJpYnV0aW9uLWFuYWx5c2lzJyk7XG4gICAgXG4gICAgcmV0dXJuIHRyYWNlci5zdGFydEFjdGl2ZVNwYW4oJ2FuYWx5emUtYXR0cmlidXRpb24nLCBhc3luYyAoc3BhbikgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgc3Bhbi5zZXRBdHRyaWJ1dGVzKHtcbiAgICAgICAgICAnYW5hbHlzaXMudGltZXN0YW1wJzogRGF0ZS5ub3coKSxcbiAgICAgICAgICAnYW5hbHlzaXMudHlwZSc6ICdjb21wcmVoZW5zaXZlJ1xuICAgICAgICB9KTtcblxuICAgICAgICBsb2dnZXIuaW5mbygnU3RhcnRpbmcgYXV0b25vbW91cyBhdHRyaWJ1dGlvbiBhbmFseXNpcy4uLicpO1xuXG4gICAgICAgIC8vIEFuYWx5emUgY2hhbm5lbCBwZXJmb3JtYW5jZVxuICAgICAgICBjb25zdCBjaGFubmVsSW5zaWdodHMgPSBhd2FpdCB0aGlzLmFuYWx5emVDaGFubmVsUGVyZm9ybWFuY2UoKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEFuYWx5emUgY3VzdG9tZXIgam91cm5leSBwYXR0ZXJuc1xuICAgICAgICBjb25zdCBqb3VybmV5SW5zaWdodHMgPSBhd2FpdCB0aGlzLmFuYWx5emVKb3VybmV5UGF0dGVybnMoKTtcbiAgICAgICAgXG4gICAgICAgIC8vIElkZW50aWZ5IGNvbnZlcnNpb24gZHJpdmVyc1xuICAgICAgICBjb25zdCBkcml2ZXJJbnNpZ2h0cyA9IGF3YWl0IHRoaXMuaWRlbnRpZnlDb252ZXJzaW9uRHJpdmVycygpO1xuICAgICAgICBcbiAgICAgICAgLy8gRGV0ZWN0IGFub21hbGllc1xuICAgICAgICBjb25zdCBhbm9tYWx5SW5zaWdodHMgPSBhd2FpdCB0aGlzLmRldGVjdEF0dHJpYnV0aW9uQW5vbWFsaWVzKCk7XG4gICAgICAgIFxuICAgICAgICAvLyBHZW5lcmF0ZSBvcHRpbWl6YXRpb24gb3Bwb3J0dW5pdGllc1xuICAgICAgICBjb25zdCBvcHRpbWl6YXRpb25JbnNpZ2h0cyA9IGF3YWl0IHRoaXMuZ2VuZXJhdGVPcHRpbWl6YXRpb25PcHBvcnR1bml0aWVzKCk7XG5cbiAgICAgICAgLy8gUHJvY2VzcyBhbGwgaW5zaWdodHNcbiAgICAgICAgY29uc3QgYWxsSW5zaWdodHMgPSBbXG4gICAgICAgICAgLi4uY2hhbm5lbEluc2lnaHRzLFxuICAgICAgICAgIC4uLmpvdXJuZXlJbnNpZ2h0cyxcbiAgICAgICAgICAuLi5kcml2ZXJJbnNpZ2h0cyxcbiAgICAgICAgICAuLi5hbm9tYWx5SW5zaWdodHMsXG4gICAgICAgICAgLi4ub3B0aW1pemF0aW9uSW5zaWdodHNcbiAgICAgICAgXTtcblxuICAgICAgICAvLyBHZW5lcmF0ZSBhdXRvbm9tb3VzIGFjdGlvbnNcbiAgICAgICAgZm9yIChjb25zdCBpbnNpZ2h0IG9mIGFsbEluc2lnaHRzKSB7XG4gICAgICAgICAgaWYgKGluc2lnaHQuYWN0aW9uUmVxdWlyZWQgJiYgaW5zaWdodC5zdWdnZXN0ZWRBY3Rpb25zKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnByb2Nlc3NBdXRvbm9tb3VzQWN0aW9ucyhpbnNpZ2h0KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTdG9yZSBpbnNpZ2h0c1xuICAgICAgICB0aGlzLnN0b3JlSW5zaWdodHMoYWxsSW5zaWdodHMpO1xuXG4gICAgICAgIC8vIEVtaXQgYW5hbHlzaXMgY29tcGxldGUgZXZlbnRcbiAgICAgICAgdGhpcy5lbWl0KCdhbmFseXNpc19jb21wbGV0ZScsIHtcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgICAgaW5zaWdodENvdW50OiBhbGxJbnNpZ2h0cy5sZW5ndGgsXG4gICAgICAgICAgYWN0aW9uc0dlbmVyYXRlZDogdGhpcy5kZWNpc2lvblF1ZXVlLmxlbmd0aFxuICAgICAgICB9KTtcblxuICAgICAgICBsb2dnZXIuaW5mbygnQXR0cmlidXRpb24gYW5hbHlzaXMgY29tcGxldGVkJywge1xuICAgICAgICAgIGluc2lnaHRzOiBhbGxJbnNpZ2h0cy5sZW5ndGgsXG4gICAgICAgICAgYWN0aW9uczogdGhpcy5kZWNpc2lvblF1ZXVlLmxlbmd0aFxuICAgICAgICB9KTtcblxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgc3Bhbi5zZXRTdGF0dXMoeyBjb2RlOiAyLCBtZXNzYWdlOiBTdHJpbmcoZXJyb3IpIH0pO1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ0F0dHJpYnV0aW9uIGFuYWx5c2lzIGZhaWxlZCcsIHtcbiAgICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpXG4gICAgICAgIH0pO1xuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgc3Bhbi5lbmQoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBbmFseXplIGNoYW5uZWwgcGVyZm9ybWFuY2UgYWNyb3NzIGF0dHJpYnV0aW9uIG1vZGVsc1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBhbmFseXplQ2hhbm5lbFBlcmZvcm1hbmNlKCk6IFByb21pc2U8QXR0cmlidXRpb25JbnNpZ2h0W10+IHtcbiAgICBjb25zdCBpbnNpZ2h0czogQXR0cmlidXRpb25JbnNpZ2h0W10gPSBbXTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBHZXQgcmVjZW50IGNvbnZlcnNpb25zXG4gICAgICBjb25zdCBzZXZlbkRheXNBZ28gPSBuZXcgRGF0ZSgpO1xuICAgICAgc2V2ZW5EYXlzQWdvLnNldERhdGUoc2V2ZW5EYXlzQWdvLmdldERhdGUoKSAtIDcpO1xuXG4gICAgICBjb25zdCBjb252ZXJzaW9ucyA9IGF3YWl0IHByaXNtYS5jb252ZXJzaW9uVHJhY2tpbmcuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIG9jY3VycmVkQXQ6IHsgZ3RlOiBzZXZlbkRheXNBZ28gfVxuICAgICAgICB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgZXZlbnQ6IHRydWVcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIC8vIEFuYWx5emUgYnkgY2hhbm5lbCBhbmQgYXR0cmlidXRpb24gbW9kZWxcbiAgICAgIGNvbnN0IGNoYW5uZWxNZXRyaWNzID0gbmV3IE1hcDxzdHJpbmcsIENoYW5uZWxQZXJmb3JtYW5jZT4oKTtcbiAgICAgIGNvbnN0IG1vZGVsczogQXR0cmlidXRpb25Nb2RlbFtdID0gW1xuICAgICAgICBBdHRyaWJ1dGlvbk1vZGVsLkZJUlNUX1RPVUNILFxuICAgICAgICBBdHRyaWJ1dGlvbk1vZGVsLkxBU1RfVE9VQ0gsXG4gICAgICAgIEF0dHJpYnV0aW9uTW9kZWwuTElORUFSLFxuICAgICAgICBBdHRyaWJ1dGlvbk1vZGVsLlRJTUVfREVDQVksXG4gICAgICAgIEF0dHJpYnV0aW9uTW9kZWwuUE9TSVRJT05fQkFTRURcbiAgICAgIF07XG5cbiAgICAgIGZvciAoY29uc3QgY29udmVyc2lvbiBvZiBjb252ZXJzaW9ucykge1xuICAgICAgICBjb25zdCB0b3VjaFBvaW50cyA9IGNvbnZlcnNpb24udG91Y2hQb2ludHMgPyBcbiAgICAgICAgICBKU09OLnBhcnNlKGNvbnZlcnNpb24udG91Y2hQb2ludHMgYXMgc3RyaW5nKSBhcyBUb3VjaFBvaW50W10gOiBbXTtcblxuICAgICAgICBpZiAodG91Y2hQb2ludHMubGVuZ3RoID09PSAwKSBjb250aW51ZTtcblxuICAgICAgICAvLyBBcHBseSBlYWNoIGF0dHJpYnV0aW9uIG1vZGVsXG4gICAgICAgIGZvciAoY29uc3QgbW9kZWwgb2YgbW9kZWxzKSB7XG4gICAgICAgICAgY29uc3QgYXR0cmlidXRlZFRvdWNoUG9pbnRzID0gYXBwbHlBdHRyaWJ1dGlvbk1vZGVsKHRvdWNoUG9pbnRzLCBtb2RlbCk7XG4gICAgICAgICAgXG4gICAgICAgICAgZm9yIChjb25zdCB0b3VjaFBvaW50IG9mIGF0dHJpYnV0ZWRUb3VjaFBvaW50cykge1xuICAgICAgICAgICAgY29uc3Qga2V5ID0gYCR7dG91Y2hQb2ludC5lbnRpdHlUeXBlfV8ke3RvdWNoUG9pbnQudHlwZX1gO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoIWNoYW5uZWxNZXRyaWNzLmhhcyhrZXkpKSB7XG4gICAgICAgICAgICAgIGNoYW5uZWxNZXRyaWNzLnNldChrZXksIHtcbiAgICAgICAgICAgICAgICBjaGFubmVsOiB0b3VjaFBvaW50LnR5cGUsXG4gICAgICAgICAgICAgICAgZW50aXR5VHlwZTogdG91Y2hQb2ludC5lbnRpdHlUeXBlLFxuICAgICAgICAgICAgICAgIGNvbnZlcnNpb25zOiAwLFxuICAgICAgICAgICAgICAgIHJldmVudWU6IDAsXG4gICAgICAgICAgICAgICAgY29zdDogMCxcbiAgICAgICAgICAgICAgICByb2k6IDAsXG4gICAgICAgICAgICAgICAgcm9hczogMCxcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGlvbjoge1xuICAgICAgICAgICAgICAgICAgZmlyc3RUb3VjaDogMCxcbiAgICAgICAgICAgICAgICAgIGxhc3RUb3VjaDogMCxcbiAgICAgICAgICAgICAgICAgIGxpbmVhcjogMCxcbiAgICAgICAgICAgICAgICAgIHRpbWVEZWNheTogMCxcbiAgICAgICAgICAgICAgICAgIHBvc2l0aW9uQmFzZWQ6IDBcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRyZW5kOiAnc3RhYmxlJ1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgbWV0cmljcyA9IGNoYW5uZWxNZXRyaWNzLmdldChrZXkpITtcbiAgICAgICAgICAgIGNvbnN0IGF0dHJpYnV0aW9uS2V5ID0gbW9kZWwudG9Mb3dlckNhc2UoKS5yZXBsYWNlKCdfJywgJycpIGFzIGtleW9mIHR5cGVvZiBtZXRyaWNzLmF0dHJpYnV0aW9uO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBtZXRyaWNzLmNvbnZlcnNpb25zICs9IHRvdWNoUG9pbnQud2VpZ2h0IHx8IDA7XG4gICAgICAgICAgICBtZXRyaWNzLnJldmVudWUgKz0gKGNvbnZlcnNpb24udmFsdWUgfHwgMCkgKiAodG91Y2hQb2ludC53ZWlnaHQgfHwgMCk7XG4gICAgICAgICAgICBtZXRyaWNzLmF0dHJpYnV0aW9uW2F0dHJpYnV0aW9uS2V5XSArPSB0b3VjaFBvaW50LndlaWdodCB8fCAwO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBDb21wYXJlIHdpdGggYmFzZWxpbmVzIGFuZCBnZW5lcmF0ZSBpbnNpZ2h0c1xuICAgICAgZm9yIChjb25zdCBba2V5LCBtZXRyaWNzXSBvZiBjaGFubmVsTWV0cmljcy5lbnRyaWVzKCkpIHtcbiAgICAgICAgY29uc3QgYmFzZWxpbmUgPSB0aGlzLnBlcmZvcm1hbmNlQmFzZWxpbmUuZ2V0KGtleSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoYmFzZWxpbmUpIHtcbiAgICAgICAgICAvLyBDYWxjdWxhdGUgdHJlbmRcbiAgICAgICAgICBjb25zdCBjb252ZXJzaW9uQ2hhbmdlID0gKG1ldHJpY3MuY29udmVyc2lvbnMgLSBiYXNlbGluZS5jb252ZXJzaW9ucykgLyBiYXNlbGluZS5jb252ZXJzaW9ucztcbiAgICAgICAgICBtZXRyaWNzLnRyZW5kID0gY29udmVyc2lvbkNoYW5nZSA+IDAuMSA/ICdpbXByb3ZpbmcnIDogXG4gICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2lvbkNoYW5nZSA8IC0wLjEgPyAnZGVjbGluaW5nJyA6ICdzdGFibGUnO1xuXG4gICAgICAgICAgLy8gQ2hlY2sgZm9yIHNpZ25pZmljYW50IGNoYW5nZXNcbiAgICAgICAgICBpZiAoTWF0aC5hYnMoY29udmVyc2lvbkNoYW5nZSkgPiAwLjIpIHtcbiAgICAgICAgICAgIGNvbnN0IGluc2lnaHQ6IEF0dHJpYnV0aW9uSW5zaWdodCA9IHtcbiAgICAgICAgICAgICAgaWQ6IGBpbnNpZ2h0XyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YCxcbiAgICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgICB0eXBlOiAnY2hhbm5lbF9wZXJmb3JtYW5jZScsXG4gICAgICAgICAgICAgIGNvbmZpZGVuY2U6IDAuODUsXG4gICAgICAgICAgICAgIGluc2lnaHQ6IGAke21ldHJpY3MuY2hhbm5lbH0gY2hhbm5lbCAke21ldHJpY3MudHJlbmR9IHdpdGggJHtNYXRoLnJvdW5kKE1hdGguYWJzKGNvbnZlcnNpb25DaGFuZ2UpICogMTAwKX0lIGNoYW5nZSBpbiBjb252ZXJzaW9uc2AsXG4gICAgICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgICAgICBjaGFubmVsczogW21ldHJpY3NdLFxuICAgICAgICAgICAgICAgIGltcGFjdDoge1xuICAgICAgICAgICAgICAgICAgcmV2ZW51ZToge1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50OiBtZXRyaWNzLnJldmVudWUsXG4gICAgICAgICAgICAgICAgICAgIHByb2plY3RlZDogbWV0cmljcy5yZXZlbnVlICogKDEgKyBjb252ZXJzaW9uQ2hhbmdlKSxcbiAgICAgICAgICAgICAgICAgICAgY2hhbmdlOiBjb252ZXJzaW9uQ2hhbmdlXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgY29udmVyc2lvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudDogbWV0cmljcy5jb252ZXJzaW9ucyxcbiAgICAgICAgICAgICAgICAgICAgcHJvamVjdGVkOiBtZXRyaWNzLmNvbnZlcnNpb25zICogKDEgKyBjb252ZXJzaW9uQ2hhbmdlKSxcbiAgICAgICAgICAgICAgICAgICAgY2hhbmdlOiBjb252ZXJzaW9uQ2hhbmdlXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgZWZmaWNpZW5jeToge1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50Q1BBOiBtZXRyaWNzLmNvc3QgLyBtZXRyaWNzLmNvbnZlcnNpb25zIHx8IDAsXG4gICAgICAgICAgICAgICAgICAgIHByb2plY3RlZENQQTogbWV0cmljcy5jb3N0IC8gKG1ldHJpY3MuY29udmVyc2lvbnMgKiAoMSArIGNvbnZlcnNpb25DaGFuZ2UpKSB8fCAwLFxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50Uk9BUzogbWV0cmljcy5yZXZlbnVlIC8gbWV0cmljcy5jb3N0IHx8IDAsXG4gICAgICAgICAgICAgICAgICAgIHByb2plY3RlZFJPQVM6IChtZXRyaWNzLnJldmVudWUgKiAoMSArIGNvbnZlcnNpb25DaGFuZ2UpKSAvIG1ldHJpY3MuY29zdCB8fCAwXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBhY3Rpb25SZXF1aXJlZDogTWF0aC5hYnMoY29udmVyc2lvbkNoYW5nZSkgPiAwLjMsXG4gICAgICAgICAgICAgIHN1Z2dlc3RlZEFjdGlvbnM6IHRoaXMuZ2VuZXJhdGVDaGFubmVsQWN0aW9ucyhtZXRyaWNzLCBjb252ZXJzaW9uQ2hhbmdlKVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaW5zaWdodHMucHVzaChpbnNpZ2h0KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0NoYW5uZWwgcGVyZm9ybWFuY2UgYW5hbHlzaXMgZmFpbGVkJywge1xuICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gaW5zaWdodHM7XG4gIH1cblxuICAvKipcbiAgICogQW5hbHl6ZSBjdXN0b21lciBqb3VybmV5IHBhdHRlcm5zXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGFuYWx5emVKb3VybmV5UGF0dGVybnMoKTogUHJvbWlzZTxBdHRyaWJ1dGlvbkluc2lnaHRbXT4ge1xuICAgIGNvbnN0IGluc2lnaHRzOiBBdHRyaWJ1dGlvbkluc2lnaHRbXSA9IFtdO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIEdldCBjb252ZXJzaW9ucyB3aXRoIG11bHRpcGxlIHRvdWNocG9pbnRzXG4gICAgICBjb25zdCBjb252ZXJzaW9ucyA9IGF3YWl0IHByaXNtYS5jb252ZXJzaW9uVHJhY2tpbmcuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIHRvdWNoUG9pbnRzOiB7IG5vdDogbnVsbCB9XG4gICAgICAgIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBldmVudDogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICB0YWtlOiAxMDAwLFxuICAgICAgICBvcmRlckJ5OiB7IG9jY3VycmVkQXQ6ICdkZXNjJyB9XG4gICAgICB9KTtcblxuICAgICAgLy8gRXh0cmFjdCBqb3VybmV5IHBhdHRlcm5zXG4gICAgICBjb25zdCBwYXR0ZXJuTWFwID0gbmV3IE1hcDxzdHJpbmcsIEpvdXJuZXlQYXR0ZXJuPigpO1xuXG4gICAgICBmb3IgKGNvbnN0IGNvbnZlcnNpb24gb2YgY29udmVyc2lvbnMpIHtcbiAgICAgICAgY29uc3QgdG91Y2hQb2ludHMgPSBKU09OLnBhcnNlKGNvbnZlcnNpb24udG91Y2hQb2ludHMgYXMgc3RyaW5nKSBhcyBUb3VjaFBvaW50W107XG4gICAgICAgIFxuICAgICAgICBpZiAodG91Y2hQb2ludHMubGVuZ3RoIDwgMikgY29udGludWU7XG5cbiAgICAgICAgLy8gQ3JlYXRlIHBhdHRlcm4ga2V5XG4gICAgICAgIGNvbnN0IHBhdHRlcm5LZXkgPSB0b3VjaFBvaW50c1xuICAgICAgICAgIC5tYXAodHAgPT4gYCR7dHAuZW50aXR5VHlwZX1fJHt0cC50eXBlfWApXG4gICAgICAgICAgLmpvaW4oJyAtPiAnKTtcblxuICAgICAgICBpZiAoIXBhdHRlcm5NYXAuaGFzKHBhdHRlcm5LZXkpKSB7XG4gICAgICAgICAgcGF0dGVybk1hcC5zZXQocGF0dGVybktleSwge1xuICAgICAgICAgICAgaWQ6IGBwYXR0ZXJuXyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YCxcbiAgICAgICAgICAgIHBhdHRlcm46IHRvdWNoUG9pbnRzLFxuICAgICAgICAgICAgZnJlcXVlbmN5OiAwLFxuICAgICAgICAgICAgYXZnVGltZVRvQ29udmVyc2lvbjogMCxcbiAgICAgICAgICAgIGF2Z1ZhbHVlOiAwLFxuICAgICAgICAgICAgY29udmVyc2lvblJhdGU6IDAsXG4gICAgICAgICAgICBjaGFubmVsczogWy4uLm5ldyBTZXQodG91Y2hQb2ludHMubWFwKHRwID0+IHRwLnR5cGUpKV0sXG4gICAgICAgICAgICBzaWduaWZpY2FuY2U6ICdsb3cnLFxuICAgICAgICAgICAgaW5zaWdodHM6IFtdXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBwYXR0ZXJuID0gcGF0dGVybk1hcC5nZXQocGF0dGVybktleSkhO1xuICAgICAgICBwYXR0ZXJuLmZyZXF1ZW5jeSsrO1xuICAgICAgICBwYXR0ZXJuLmF2Z1ZhbHVlID0gKHBhdHRlcm4uYXZnVmFsdWUgKiAocGF0dGVybi5mcmVxdWVuY3kgLSAxKSArIChjb252ZXJzaW9uLnZhbHVlIHx8IDApKSAvIHBhdHRlcm4uZnJlcXVlbmN5O1xuICAgICAgICBcbiAgICAgICAgLy8gQ2FsY3VsYXRlIHRpbWUgdG8gY29udmVyc2lvblxuICAgICAgICBjb25zdCBmaXJzdFRvdWNoID0gbmV3IERhdGUodG91Y2hQb2ludHNbMF0udGltZXN0YW1wKTtcbiAgICAgICAgY29uc3QgbGFzdFRvdWNoID0gbmV3IERhdGUodG91Y2hQb2ludHNbdG91Y2hQb2ludHMubGVuZ3RoIC0gMV0udGltZXN0YW1wKTtcbiAgICAgICAgY29uc3QgdGltZVRvQ29udmVyc2lvbiA9IChsYXN0VG91Y2guZ2V0VGltZSgpIC0gZmlyc3RUb3VjaC5nZXRUaW1lKCkpIC8gKDEwMDAgKiA2MCAqIDYwKTsgLy8gaG91cnNcbiAgICAgICAgXG4gICAgICAgIHBhdHRlcm4uYXZnVGltZVRvQ29udmVyc2lvbiA9IChwYXR0ZXJuLmF2Z1RpbWVUb0NvbnZlcnNpb24gKiAocGF0dGVybi5mcmVxdWVuY3kgLSAxKSArIHRpbWVUb0NvbnZlcnNpb24pIC8gcGF0dGVybi5mcmVxdWVuY3k7XG4gICAgICB9XG5cbiAgICAgIC8vIEFuYWx5emUgc2lnbmlmaWNhbnQgcGF0dGVybnNcbiAgICAgIGNvbnN0IHRvdGFsQ29udmVyc2lvbnMgPSBjb252ZXJzaW9ucy5sZW5ndGg7XG4gICAgICBcbiAgICAgIGZvciAoY29uc3QgcGF0dGVybiBvZiBwYXR0ZXJuTWFwLnZhbHVlcygpKSB7XG4gICAgICAgIHBhdHRlcm4uY29udmVyc2lvblJhdGUgPSBwYXR0ZXJuLmZyZXF1ZW5jeSAvIHRvdGFsQ29udmVyc2lvbnM7XG4gICAgICAgIHBhdHRlcm4uc2lnbmlmaWNhbmNlID0gcGF0dGVybi5jb252ZXJzaW9uUmF0ZSA+IDAuMSA/ICdoaWdoJyA6IFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0dGVybi5jb252ZXJzaW9uUmF0ZSA+IDAuMDUgPyAnbWVkaXVtJyA6ICdsb3cnO1xuXG4gICAgICAgIGlmIChwYXR0ZXJuLnNpZ25pZmljYW5jZSAhPT0gJ2xvdycpIHtcbiAgICAgICAgICAvLyBHZW5lcmF0ZSBpbnNpZ2h0c1xuICAgICAgICAgIHBhdHRlcm4uaW5zaWdodHMgPSB0aGlzLmdlbmVyYXRlSm91cm5leUluc2lnaHRzKHBhdHRlcm4pO1xuXG4gICAgICAgICAgY29uc3QgaW5zaWdodDogQXR0cmlidXRpb25JbnNpZ2h0ID0ge1xuICAgICAgICAgICAgaWQ6IGBpbnNpZ2h0XyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YCxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgICAgIHR5cGU6ICdqb3VybmV5X3BhdHRlcm4nLFxuICAgICAgICAgICAgY29uZmlkZW5jZTogTWF0aC5taW4oMC42ICsgcGF0dGVybi5jb252ZXJzaW9uUmF0ZSwgMC45NSksXG4gICAgICAgICAgICBpbnNpZ2h0OiBgRGlzY292ZXJlZCAke3BhdHRlcm4uc2lnbmlmaWNhbmNlfSB2YWx1ZSBqb3VybmV5IHBhdHRlcm4gd2l0aCAke01hdGgucm91bmQocGF0dGVybi5jb252ZXJzaW9uUmF0ZSAqIDEwMCl9JSBvZiBjb252ZXJzaW9uc2AsXG4gICAgICAgICAgICBkZXRhaWxzOiB7XG4gICAgICAgICAgICAgIGpvdXJuZXlQYXR0ZXJuczogW3BhdHRlcm5dXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYWN0aW9uUmVxdWlyZWQ6IHBhdHRlcm4uc2lnbmlmaWNhbmNlID09PSAnaGlnaCcsXG4gICAgICAgICAgICBzdWdnZXN0ZWRBY3Rpb25zOiBwYXR0ZXJuLnNpZ25pZmljYW5jZSA9PT0gJ2hpZ2gnID8gXG4gICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVKb3VybmV5QWN0aW9ucyhwYXR0ZXJuKSA6IHVuZGVmaW5lZFxuICAgICAgICAgIH07XG5cbiAgICAgICAgICBpbnNpZ2h0cy5wdXNoKGluc2lnaHQpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdKb3VybmV5IHBhdHRlcm4gYW5hbHlzaXMgZmFpbGVkJywge1xuICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gaW5zaWdodHM7XG4gIH1cblxuICAvKipcbiAgICogSWRlbnRpZnkga2V5IGNvbnZlcnNpb24gZHJpdmVyc1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBpZGVudGlmeUNvbnZlcnNpb25Ecml2ZXJzKCk6IFByb21pc2U8QXR0cmlidXRpb25JbnNpZ2h0W10+IHtcbiAgICBjb25zdCBpbnNpZ2h0czogQXR0cmlidXRpb25JbnNpZ2h0W10gPSBbXTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBBbmFseXplIHZhcmlvdXMgY29udmVyc2lvbiBmYWN0b3JzXG4gICAgICBjb25zdCBkcml2ZXJzOiBDb252ZXJzaW9uRHJpdmVyW10gPSBbXTtcblxuICAgICAgLy8gQ2hhbm5lbCBzZXF1ZW5jZSBhbmFseXNpc1xuICAgICAgY29uc3Qgc2VxdWVuY2VEcml2ZXIgPSBhd2FpdCB0aGlzLmFuYWx5emVDaGFubmVsU2VxdWVuY2UoKTtcbiAgICAgIGlmIChzZXF1ZW5jZURyaXZlcikgZHJpdmVycy5wdXNoKHNlcXVlbmNlRHJpdmVyKTtcblxuICAgICAgLy8gVGltaW5nIGFuYWx5c2lzXG4gICAgICBjb25zdCB0aW1pbmdEcml2ZXIgPSBhd2FpdCB0aGlzLmFuYWx5emVDb252ZXJzaW9uVGltaW5nKCk7XG4gICAgICBpZiAodGltaW5nRHJpdmVyKSBkcml2ZXJzLnB1c2godGltaW5nRHJpdmVyKTtcblxuICAgICAgLy8gRnJlcXVlbmN5IGFuYWx5c2lzXG4gICAgICBjb25zdCBmcmVxdWVuY3lEcml2ZXIgPSBhd2FpdCB0aGlzLmFuYWx5emVUb3VjaHBvaW50RnJlcXVlbmN5KCk7XG4gICAgICBpZiAoZnJlcXVlbmN5RHJpdmVyKSBkcml2ZXJzLnB1c2goZnJlcXVlbmN5RHJpdmVyKTtcblxuICAgICAgLy8gQ29udGVudCB0eXBlIGFuYWx5c2lzXG4gICAgICBjb25zdCBjb250ZW50RHJpdmVyID0gYXdhaXQgdGhpcy5hbmFseXplQ29udGVudFBlcmZvcm1hbmNlKCk7XG4gICAgICBpZiAoY29udGVudERyaXZlcikgZHJpdmVycy5wdXNoKGNvbnRlbnREcml2ZXIpO1xuXG4gICAgICAvLyBDcmVhdGUgaW5zaWdodHMgZm9yIHNpZ25pZmljYW50IGRyaXZlcnNcbiAgICAgIGNvbnN0IHNpZ25pZmljYW50RHJpdmVycyA9IGRyaXZlcnMuZmlsdGVyKGQgPT4gTWF0aC5hYnMoZC5pbXBhY3QpID4gMC4yKTtcblxuICAgICAgaWYgKHNpZ25pZmljYW50RHJpdmVycy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnN0IGluc2lnaHQ6IEF0dHJpYnV0aW9uSW5zaWdodCA9IHtcbiAgICAgICAgICBpZDogYGluc2lnaHRfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gLFxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgICB0eXBlOiAnY29udmVyc2lvbl9kcml2ZXInLFxuICAgICAgICAgIGNvbmZpZGVuY2U6IDAuOCxcbiAgICAgICAgICBpbnNpZ2h0OiBgSWRlbnRpZmllZCAke3NpZ25pZmljYW50RHJpdmVycy5sZW5ndGh9IGtleSBjb252ZXJzaW9uIGRyaXZlcnNgLFxuICAgICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICAgIGNvbnZlcnNpb25Ecml2ZXJzOiBzaWduaWZpY2FudERyaXZlcnMsXG4gICAgICAgICAgICByZWNvbW1lbmRhdGlvbnM6IHRoaXMuZ2VuZXJhdGVEcml2ZXJSZWNvbW1lbmRhdGlvbnMoc2lnbmlmaWNhbnREcml2ZXJzKVxuICAgICAgICAgIH0sXG4gICAgICAgICAgYWN0aW9uUmVxdWlyZWQ6IHNpZ25pZmljYW50RHJpdmVycy5zb21lKGQgPT4gTWF0aC5hYnMoZC5pbXBhY3QpID4gMC40KSxcbiAgICAgICAgICBzdWdnZXN0ZWRBY3Rpb25zOiB0aGlzLmdlbmVyYXRlRHJpdmVyQWN0aW9ucyhzaWduaWZpY2FudERyaXZlcnMpXG4gICAgICAgIH07XG5cbiAgICAgICAgaW5zaWdodHMucHVzaChpbnNpZ2h0KTtcbiAgICAgIH1cblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0NvbnZlcnNpb24gZHJpdmVyIGFuYWx5c2lzIGZhaWxlZCcsIHtcbiAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGluc2lnaHRzO1xuICB9XG5cbiAgLyoqXG4gICAqIERldGVjdCBhdHRyaWJ1dGlvbiBhbm9tYWxpZXNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZGV0ZWN0QXR0cmlidXRpb25Bbm9tYWxpZXMoKTogUHJvbWlzZTxBdHRyaWJ1dGlvbkluc2lnaHRbXT4ge1xuICAgIGNvbnN0IGluc2lnaHRzOiBBdHRyaWJ1dGlvbkluc2lnaHRbXSA9IFtdO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIENvbXBhcmUgY3VycmVudCBwZXJmb3JtYW5jZSB3aXRoIGhpc3RvcmljYWwgcGF0dGVybnNcbiAgICAgIGNvbnN0IGFub21hbGllczogc3RyaW5nW10gPSBbXTtcblxuICAgICAgLy8gQ2hlY2sgZm9yIHN1ZGRlbiBjaGFubmVsIHBlcmZvcm1hbmNlIGNoYW5nZXNcbiAgICAgIGZvciAoY29uc3QgW2tleSwgYmFzZWxpbmVdIG9mIHRoaXMucGVyZm9ybWFuY2VCYXNlbGluZS5lbnRyaWVzKCkpIHtcbiAgICAgICAgY29uc3QgY3VycmVudCA9IGF3YWl0IHRoaXMuZ2V0Q3VycmVudENoYW5uZWxNZXRyaWNzKGtleSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoY3VycmVudCkge1xuICAgICAgICAgIGNvbnN0IGNvbnZlcnNpb25DaGFuZ2UgPSBNYXRoLmFicygoY3VycmVudC5jb252ZXJzaW9ucyAtIGJhc2VsaW5lLmNvbnZlcnNpb25zKSAvIGJhc2VsaW5lLmNvbnZlcnNpb25zKTtcbiAgICAgICAgICBjb25zdCByZXZlbnVlQ2hhbmdlID0gTWF0aC5hYnMoKGN1cnJlbnQucmV2ZW51ZSAtIGJhc2VsaW5lLnJldmVudWUpIC8gYmFzZWxpbmUucmV2ZW51ZSk7XG5cbiAgICAgICAgICBpZiAoY29udmVyc2lvbkNoYW5nZSA+IDAuNSB8fCByZXZlbnVlQ2hhbmdlID4gMC41KSB7XG4gICAgICAgICAgICBhbm9tYWxpZXMucHVzaChgJHtiYXNlbGluZS5jaGFubmVsfSBzaG93aW5nICR7TWF0aC5yb3VuZChNYXRoLm1heChjb252ZXJzaW9uQ2hhbmdlLCByZXZlbnVlQ2hhbmdlKSAqIDEwMCl9JSBkZXZpYXRpb24gZnJvbSBiYXNlbGluZWApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBmb3IgdW51c3VhbCBqb3VybmV5IHBhdHRlcm5zXG4gICAgICBjb25zdCB1bnVzdWFsUGF0dGVybnMgPSBhd2FpdCB0aGlzLmRldGVjdFVudXN1YWxKb3VybmV5cygpO1xuICAgICAgYW5vbWFsaWVzLnB1c2goLi4udW51c3VhbFBhdHRlcm5zKTtcblxuICAgICAgaWYgKGFub21hbGllcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnN0IGluc2lnaHQ6IEF0dHJpYnV0aW9uSW5zaWdodCA9IHtcbiAgICAgICAgICBpZDogYGluc2lnaHRfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gLFxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgICB0eXBlOiAnYW5vbWFseScsXG4gICAgICAgICAgY29uZmlkZW5jZTogMC43NSxcbiAgICAgICAgICBpbnNpZ2h0OiBgRGV0ZWN0ZWQgJHthbm9tYWxpZXMubGVuZ3RofSBhdHRyaWJ1dGlvbiBhbm9tYWxpZXMgcmVxdWlyaW5nIGF0dGVudGlvbmAsXG4gICAgICAgICAgZGV0YWlsczoge1xuICAgICAgICAgICAgY2hhbm5lbHM6IGFub21hbGllcy5tYXAoYSA9PiAoe1xuICAgICAgICAgICAgICBjaGFubmVsOiBhLFxuICAgICAgICAgICAgICBlbnRpdHlUeXBlOiBFbnRpdHlUeXBlLkNBTVBBSUdOLFxuICAgICAgICAgICAgICBjb252ZXJzaW9uczogMCxcbiAgICAgICAgICAgICAgcmV2ZW51ZTogMCxcbiAgICAgICAgICAgICAgY29zdDogMCxcbiAgICAgICAgICAgICAgcm9pOiAwLFxuICAgICAgICAgICAgICByb2FzOiAwLFxuICAgICAgICAgICAgICBhdHRyaWJ1dGlvbjoge1xuICAgICAgICAgICAgICAgIGZpcnN0VG91Y2g6IDAsXG4gICAgICAgICAgICAgICAgbGFzdFRvdWNoOiAwLFxuICAgICAgICAgICAgICAgIGxpbmVhcjogMCxcbiAgICAgICAgICAgICAgICB0aW1lRGVjYXk6IDAsXG4gICAgICAgICAgICAgICAgcG9zaXRpb25CYXNlZDogMFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB0cmVuZDogJ3N0YWJsZScgYXMgY29uc3QsXG4gICAgICAgICAgICAgIGFub21hbGllczogW2FdXG4gICAgICAgICAgICB9KSlcbiAgICAgICAgICB9LFxuICAgICAgICAgIGFjdGlvblJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgIHN1Z2dlc3RlZEFjdGlvbnM6IFt7XG4gICAgICAgICAgICBpZDogYGFjdGlvbl8ke0RhdGUubm93KCl9YCxcbiAgICAgICAgICAgIHR5cGU6ICdpbW1lZGlhdGUnLFxuICAgICAgICAgICAgYWN0aW9uOiAnaW52ZXN0aWdhdGVfYW5vbWFsaWVzJyxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnSW52ZXN0aWdhdGUgYW5kIGFkZHJlc3MgYXR0cmlidXRpb24gYW5vbWFsaWVzJyxcbiAgICAgICAgICAgIHRhcmdldEVudGl0eToge1xuICAgICAgICAgICAgICB0eXBlOiBFbnRpdHlUeXBlLkNBTVBBSUdOLFxuICAgICAgICAgICAgICBpZDogJ2FsbCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwYXJhbWV0ZXJzOiB7IGFub21hbGllcyB9LFxuICAgICAgICAgICAgYXBwcm92YWxSZXF1aXJlZDogZmFsc2UsXG4gICAgICAgICAgICByaXNrTGV2ZWw6ICdsb3cnXG4gICAgICAgICAgfV1cbiAgICAgICAgfTtcblxuICAgICAgICBpbnNpZ2h0cy5wdXNoKGluc2lnaHQpO1xuICAgICAgfVxuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignQW5vbWFseSBkZXRlY3Rpb24gZmFpbGVkJywge1xuICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gaW5zaWdodHM7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgb3B0aW1pemF0aW9uIG9wcG9ydHVuaXRpZXNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZ2VuZXJhdGVPcHRpbWl6YXRpb25PcHBvcnR1bml0aWVzKCk6IFByb21pc2U8QXR0cmlidXRpb25JbnNpZ2h0W10+IHtcbiAgICBjb25zdCBpbnNpZ2h0czogQXR0cmlidXRpb25JbnNpZ2h0W10gPSBbXTtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZWNvbW1lbmRhdGlvbnM6IEF0dHJpYnV0aW9uUmVjb21tZW5kYXRpb25bXSA9IFtdO1xuXG4gICAgICAvLyBCdWRnZXQgcmVhbGxvY2F0aW9uIG9wcG9ydHVuaXRpZXNcbiAgICAgIGNvbnN0IGJ1ZGdldFJlY28gPSBhd2FpdCB0aGlzLmFuYWx5emVCdWRnZXRBbGxvY2F0aW9uKCk7XG4gICAgICBpZiAoYnVkZ2V0UmVjbykgcmVjb21tZW5kYXRpb25zLnB1c2goYnVkZ2V0UmVjbyk7XG5cbiAgICAgIC8vIENoYW5uZWwgbWl4IG9wdGltaXphdGlvblxuICAgICAgY29uc3QgY2hhbm5lbE1peFJlY28gPSBhd2FpdCB0aGlzLm9wdGltaXplQ2hhbm5lbE1peCgpO1xuICAgICAgaWYgKGNoYW5uZWxNaXhSZWNvKSByZWNvbW1lbmRhdGlvbnMucHVzaChjaGFubmVsTWl4UmVjbyk7XG5cbiAgICAgIC8vIEpvdXJuZXkgb3B0aW1pemF0aW9uXG4gICAgICBjb25zdCBqb3VybmV5UmVjbyA9IGF3YWl0IHRoaXMub3B0aW1pemVDdXN0b21lckpvdXJuZXlzKCk7XG4gICAgICBpZiAoam91cm5leVJlY28pIHJlY29tbWVuZGF0aW9ucy5wdXNoKGpvdXJuZXlSZWNvKTtcblxuICAgICAgLy8gVGltaW5nIG9wdGltaXphdGlvblxuICAgICAgY29uc3QgdGltaW5nUmVjbyA9IGF3YWl0IHRoaXMub3B0aW1pemVDYW1wYWlnblRpbWluZygpO1xuICAgICAgaWYgKHRpbWluZ1JlY28pIHJlY29tbWVuZGF0aW9ucy5wdXNoKHRpbWluZ1JlY28pO1xuXG4gICAgICBpZiAocmVjb21tZW5kYXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc3QgaW5zaWdodDogQXR0cmlidXRpb25JbnNpZ2h0ID0ge1xuICAgICAgICAgIGlkOiBgaW5zaWdodF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWAsXG4gICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIHR5cGU6ICdvcHRpbWl6YXRpb25fb3Bwb3J0dW5pdHknLFxuICAgICAgICAgIGNvbmZpZGVuY2U6IDAuODUsXG4gICAgICAgICAgaW5zaWdodDogYElkZW50aWZpZWQgJHtyZWNvbW1lbmRhdGlvbnMubGVuZ3RofSBvcHRpbWl6YXRpb24gb3Bwb3J0dW5pdGllc2AsXG4gICAgICAgICAgZGV0YWlsczoge1xuICAgICAgICAgICAgcmVjb21tZW5kYXRpb25zLFxuICAgICAgICAgICAgaW1wYWN0OiB0aGlzLmNhbGN1bGF0ZVRvdGFsSW1wYWN0KHJlY29tbWVuZGF0aW9ucylcbiAgICAgICAgICB9LFxuICAgICAgICAgIGFjdGlvblJlcXVpcmVkOiByZWNvbW1lbmRhdGlvbnMuc29tZShyID0+IHIucHJpb3JpdHkgPT09ICdoaWdoJyksXG4gICAgICAgICAgc3VnZ2VzdGVkQWN0aW9uczogdGhpcy5nZW5lcmF0ZU9wdGltaXphdGlvbkFjdGlvbnMocmVjb21tZW5kYXRpb25zKVxuICAgICAgICB9O1xuXG4gICAgICAgIGluc2lnaHRzLnB1c2goaW5zaWdodCk7XG4gICAgICB9XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdPcHRpbWl6YXRpb24gYW5hbHlzaXMgZmFpbGVkJywge1xuICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gaW5zaWdodHM7XG4gIH1cblxuICAvKipcbiAgICogUHJvY2VzcyBhdXRvbm9tb3VzIGFjdGlvbnMgYmFzZWQgb24gaW5zaWdodHNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgcHJvY2Vzc0F1dG9ub21vdXNBY3Rpb25zKGluc2lnaHQ6IEF0dHJpYnV0aW9uSW5zaWdodCkge1xuICAgIGlmICghaW5zaWdodC5zdWdnZXN0ZWRBY3Rpb25zKSByZXR1cm47XG5cbiAgICBmb3IgKGNvbnN0IGFjdGlvbiBvZiBpbnNpZ2h0LnN1Z2dlc3RlZEFjdGlvbnMpIHtcbiAgICAgIC8vIENoZWNrIHJpc2sgbGV2ZWwgYW5kIGFwcHJvdmFsIHJlcXVpcmVtZW50c1xuICAgICAgaWYgKGFjdGlvbi5yaXNrTGV2ZWwgPT09ICdoaWdoJyB8fCBhY3Rpb24uYXBwcm92YWxSZXF1aXJlZCkge1xuICAgICAgICAvLyBRdWV1ZSBmb3IgYXBwcm92YWxcbiAgICAgICAgYXdhaXQgdGhpcy5xdWV1ZUZvckFwcHJvdmFsKGFjdGlvbiwgaW5zaWdodCk7XG4gICAgICB9IGVsc2UgaWYgKGFjdGlvbi50eXBlID09PSAnaW1tZWRpYXRlJykge1xuICAgICAgICAvLyBFeGVjdXRlIGltbWVkaWF0ZWx5XG4gICAgICAgIGF3YWl0IHRoaXMuZXhlY3V0ZUF1dG9ub21vdXNBY3Rpb24oYWN0aW9uKTtcbiAgICAgIH0gZWxzZSBpZiAoYWN0aW9uLnR5cGUgPT09ICdzY2hlZHVsZWQnKSB7XG4gICAgICAgIC8vIFNjaGVkdWxlIGZvciBsYXRlciBleGVjdXRpb25cbiAgICAgICAgYXdhaXQgdGhpcy5zY2hlZHVsZUFjdGlvbihhY3Rpb24pO1xuICAgICAgfSBlbHNlIGlmIChhY3Rpb24udHlwZSA9PT0gJ2NvbmRpdGlvbmFsJykge1xuICAgICAgICAvLyBTZXQgdXAgbW9uaXRvcmluZyBmb3IgdHJpZ2dlciBjb25kaXRpb25cbiAgICAgICAgYXdhaXQgdGhpcy5zZXR1cENvbmRpdGlvbmFsVHJpZ2dlcihhY3Rpb24pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlIGFuIGF1dG9ub21vdXMgYWN0aW9uXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGV4ZWN1dGVBdXRvbm9tb3VzQWN0aW9uKGFjdGlvbjogQXV0b25vbW91c0FjdGlvbikge1xuICAgIGNvbnN0IHRyYWNlciA9IHRyYWNlLmdldFRyYWNlcignYXV0b25vbW91cy1hdHRyaWJ1dGlvbicpO1xuICAgIFxuICAgIHJldHVybiB0cmFjZXIuc3RhcnRBY3RpdmVTcGFuKCdleGVjdXRlLWFjdGlvbicsIGFzeW5jIChzcGFuKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBzcGFuLnNldEF0dHJpYnV0ZXMoe1xuICAgICAgICAgICdhY3Rpb24uaWQnOiBhY3Rpb24uaWQsXG4gICAgICAgICAgJ2FjdGlvbi50eXBlJzogYWN0aW9uLnR5cGUsXG4gICAgICAgICAgJ2FjdGlvbi5yaXNrTGV2ZWwnOiBhY3Rpb24ucmlza0xldmVsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGxvZ2dlci5pbmZvKCdFeGVjdXRpbmcgYXV0b25vbW91cyBhdHRyaWJ1dGlvbiBhY3Rpb24nLCB7XG4gICAgICAgICAgYWN0aW9uSWQ6IGFjdGlvbi5pZCxcbiAgICAgICAgICBhY3Rpb246IGFjdGlvbi5hY3Rpb24sXG4gICAgICAgICAgdGFyZ2V0RW50aXR5OiBhY3Rpb24udGFyZ2V0RW50aXR5XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEV4ZWN1dGUgYmFzZWQgb24gYWN0aW9uIHR5cGVcbiAgICAgICAgc3dpdGNoIChhY3Rpb24uYWN0aW9uKSB7XG4gICAgICAgICAgY2FzZSAncmVhbGxvY2F0ZV9idWRnZXQnOlxuICAgICAgICAgICAgYXdhaXQgdGhpcy5leGVjdXRlQnVkZ2V0UmVhbGxvY2F0aW9uKGFjdGlvbik7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgJ2FkanVzdF9jaGFubmVsX21peCc6XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmV4ZWN1dGVDaGFubmVsTWl4QWRqdXN0bWVudChhY3Rpb24pO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlICdvcHRpbWl6ZV9qb3VybmV5JzpcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuZXhlY3V0ZUpvdXJuZXlPcHRpbWl6YXRpb24oYWN0aW9uKTtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSAndXBkYXRlX2F0dHJpYnV0aW9uX21vZGVsJzpcbiAgICAgICAgICAgIGF3YWl0IHRoaXMudXBkYXRlQXR0cmlidXRpb25Nb2RlbChhY3Rpb24pO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlICdwYXVzZV91bmRlcnBlcmZvcm1pbmcnOlxuICAgICAgICAgICAgYXdhaXQgdGhpcy5wYXVzZVVuZGVycGVyZm9ybWluZ0NoYW5uZWxzKGFjdGlvbik7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgJ3NjYWxlX2hpZ2hfcGVyZm9ybWVycyc6XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnNjYWxlSGlnaFBlcmZvcm1pbmdDaGFubmVscyhhY3Rpb24pO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgbG9nZ2VyLndhcm4oJ1Vua25vd24gYXV0b25vbW91cyBhY3Rpb24nLCB7IGFjdGlvbjogYWN0aW9uLmFjdGlvbiB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEVtaXQgYWN0aW9uIGV4ZWN1dGVkIGV2ZW50XG4gICAgICAgIHRoaXMuZW1pdCgnYWN0aW9uX2V4ZWN1dGVkJywge1xuICAgICAgICAgIGFjdGlvbklkOiBhY3Rpb24uaWQsXG4gICAgICAgICAgYWN0aW9uOiBhY3Rpb24uYWN0aW9uLFxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgICBzdWNjZXNzOiB0cnVlXG4gICAgICAgIH0pO1xuXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBzcGFuLnNldFN0YXR1cyh7IGNvZGU6IDIsIG1lc3NhZ2U6IFN0cmluZyhlcnJvcikgfSk7XG4gICAgICAgIGxvZ2dlci5lcnJvcignQXV0b25vbW91cyBhY3Rpb24gZXhlY3V0aW9uIGZhaWxlZCcsIHtcbiAgICAgICAgICBhY3Rpb25JZDogYWN0aW9uLmlkLFxuICAgICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvcilcbiAgICAgICAgfSk7XG4gICAgICB9IGZpbmFsbHkge1xuICAgICAgICBzcGFuLmVuZCgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlZ2lzdGVyIHdpdGggZGVjaXNpb24gZW5naW5lcyBmb3IgY29vcmRpbmF0aW9uXG4gICAqL1xuICBwcml2YXRlIHJlZ2lzdGVyV2l0aERlY2lzaW9uRW5naW5lcygpIHtcbiAgICAvLyBSZWdpc3RlciBhdHRyaWJ1dGlvbiBpbnNpZ2h0cyBwcm92aWRlclxuICAgIHN0cmF0ZWdpY0RlY2lzaW9uRW5naW5lLnJlZ2lzdGVyRGF0YVByb3ZpZGVyKCdhdHRyaWJ1dGlvbicsIHtcbiAgICAgIGdldEluc2lnaHRzOiBhc3luYyAoKSA9PiB0aGlzLmdldFJlY2VudEluc2lnaHRzKCksXG4gICAgICBnZXRNZXRyaWNzOiBhc3luYyAoKSA9PiB0aGlzLmdldEF0dHJpYnV0aW9uTWV0cmljcygpLFxuICAgICAgZ2V0UmVjb21tZW5kYXRpb25zOiBhc3luYyAoKSA9PiB0aGlzLmdldEF0dHJpYnV0aW9uUmVjb21tZW5kYXRpb25zKClcbiAgICB9KTtcblxuICAgIC8vIFJlZ2lzdGVyIHJlYWwtdGltZSBhdHRyaWJ1dGlvbiBoYW5kbGVyXG4gICAgcmVhbHRpbWVEZWNpc2lvbkVuZ2luZS5yZWdpc3RlckhhbmRsZXIoJ2F0dHJpYnV0aW9uX2NoYW5nZScsIGFzeW5jIChldmVudCkgPT4ge1xuICAgICAgYXdhaXQgdGhpcy5oYW5kbGVSZWFsdGltZUF0dHJpYnV0aW9uQ2hhbmdlKGV2ZW50KTtcbiAgICB9KTtcblxuICAgIC8vIFJlZ2lzdGVyIHdpdGggbXVsdGktYWdlbnQgY29vcmRpbmF0b3JcbiAgICBtdWx0aUFnZW50Q29vcmRpbmF0b3Iub24oJ2NvbGxhYm9yYXRpb25fcmVxdWVzdCcsIGFzeW5jIChyZXF1ZXN0KSA9PiB7XG4gICAgICBpZiAocmVxdWVzdC5jYXBhYmlsaXRpZXMuaW5jbHVkZXMoJ2F0dHJpYnV0aW9uJykpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5wYXJ0aWNpcGF0ZUluQ29sbGFib3JhdGlvbihyZXF1ZXN0KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgcmVjZW50IGF0dHJpYnV0aW9uIGluc2lnaHRzXG4gICAqL1xuICBhc3luYyBnZXRSZWNlbnRJbnNpZ2h0cyhob3VycyA9IDI0KTogUHJvbWlzZTxBdHRyaWJ1dGlvbkluc2lnaHRbXT4ge1xuICAgIGNvbnN0IGN1dG9mZiA9IG5ldyBEYXRlKCk7XG4gICAgY3V0b2ZmLnNldEhvdXJzKGN1dG9mZi5nZXRIb3VycygpIC0gaG91cnMpO1xuXG4gICAgY29uc3QgYWxsSW5zaWdodHM6IEF0dHJpYnV0aW9uSW5zaWdodFtdID0gW107XG4gICAgXG4gICAgZm9yIChjb25zdCBpbnNpZ2h0cyBvZiB0aGlzLmluc2lnaHRIaXN0b3J5LnZhbHVlcygpKSB7XG4gICAgICBhbGxJbnNpZ2h0cy5wdXNoKC4uLmluc2lnaHRzLmZpbHRlcihpID0+IGkudGltZXN0YW1wID4gY3V0b2ZmKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGFsbEluc2lnaHRzLnNvcnQoKGEsIGIpID0+IGIudGltZXN0YW1wLmdldFRpbWUoKSAtIGEudGltZXN0YW1wLmdldFRpbWUoKSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGN1cnJlbnQgYXR0cmlidXRpb24gbWV0cmljc1xuICAgKi9cbiAgYXN5bmMgZ2V0QXR0cmlidXRpb25NZXRyaWNzKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgYW55Pj4ge1xuICAgIGNvbnN0IG1ldHJpY3MgPSB7XG4gICAgICB0b3RhbENvbnZlcnNpb25zOiAwLFxuICAgICAgdG90YWxSZXZlbnVlOiAwLFxuICAgICAgYXZnVGltZVRvQ29udmVyc2lvbjogMCxcbiAgICAgIHRvcENoYW5uZWxzOiBbXSBhcyBhbnlbXSxcbiAgICAgIGF0dHJpYnV0aW9uSGVhbHRoOiAnZ29vZCcgYXMgJ2V4Y2VsbGVudCcgfCAnZ29vZCcgfCAnd2FybmluZycgfCAnY3JpdGljYWwnXG4gICAgfTtcblxuICAgIC8vIENhbGN1bGF0ZSBtZXRyaWNzIGZyb20gcmVjZW50IGRhdGFcbiAgICBjb25zdCByZWNlbnRDb252ZXJzaW9ucyA9IGF3YWl0IHByaXNtYS5jb252ZXJzaW9uVHJhY2tpbmcuZmluZE1hbnkoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgb2NjdXJyZWRBdDogeyBndGU6IG5ldyBEYXRlKERhdGUubm93KCkgLSA3ICogMjQgKiA2MCAqIDYwICogMTAwMCkgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgbWV0cmljcy50b3RhbENvbnZlcnNpb25zID0gcmVjZW50Q29udmVyc2lvbnMubGVuZ3RoO1xuICAgIG1ldHJpY3MudG90YWxSZXZlbnVlID0gcmVjZW50Q29udmVyc2lvbnMucmVkdWNlKChzdW0sIGMpID0+IHN1bSArIChjLnZhbHVlIHx8IDApLCAwKTtcblxuICAgIHJldHVybiBtZXRyaWNzO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhdHRyaWJ1dGlvbi1iYXNlZCByZWNvbW1lbmRhdGlvbnNcbiAgICovXG4gIGFzeW5jIGdldEF0dHJpYnV0aW9uUmVjb21tZW5kYXRpb25zKCk6IFByb21pc2U8QXR0cmlidXRpb25SZWNvbW1lbmRhdGlvbltdPiB7XG4gICAgY29uc3QgaW5zaWdodHMgPSBhd2FpdCB0aGlzLmdldFJlY2VudEluc2lnaHRzKDE2OCk7IC8vIExhc3Qgd2Vla1xuICAgIGNvbnN0IHJlY29tbWVuZGF0aW9uczogQXR0cmlidXRpb25SZWNvbW1lbmRhdGlvbltdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IGluc2lnaHQgb2YgaW5zaWdodHMpIHtcbiAgICAgIGlmIChpbnNpZ2h0LmRldGFpbHMucmVjb21tZW5kYXRpb25zKSB7XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKC4uLmluc2lnaHQuZGV0YWlscy5yZWNvbW1lbmRhdGlvbnMpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiByZWNvbW1lbmRhdGlvbnMuc29ydCgoYSwgYikgPT4ge1xuICAgICAgY29uc3QgcHJpb3JpdHlPcmRlciA9IHsgaGlnaDogMCwgbWVkaXVtOiAxLCBsb3c6IDIgfTtcbiAgICAgIHJldHVybiBwcmlvcml0eU9yZGVyW2EucHJpb3JpdHldIC0gcHJpb3JpdHlPcmRlcltiLnByaW9yaXR5XTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgcmVhbC10aW1lIGF0dHJpYnV0aW9uIGNoYW5nZXNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgaGFuZGxlUmVhbHRpbWVBdHRyaWJ1dGlvbkNoYW5nZShldmVudDogYW55KSB7XG4gICAgbG9nZ2VyLmluZm8oJ0hhbmRsaW5nIHJlYWwtdGltZSBhdHRyaWJ1dGlvbiBjaGFuZ2UnLCB7IGV2ZW50IH0pO1xuXG4gICAgLy8gVHJpZ2dlciBpbW1lZGlhdGUgYW5hbHlzaXMgaWYgc2lnbmlmaWNhbnRcbiAgICBpZiAoZXZlbnQuc2lnbmlmaWNhbmNlID09PSAnaGlnaCcpIHtcbiAgICAgIGF3YWl0IHRoaXMucGVyZm9ybUF0dHJpYnV0aW9uQW5hbHlzaXMoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUGFydGljaXBhdGUgaW4gbXVsdGktYWdlbnQgY29sbGFib3JhdGlvblxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBwYXJ0aWNpcGF0ZUluQ29sbGFib3JhdGlvbihyZXF1ZXN0OiBhbnkpIHtcbiAgICBsb2dnZXIuaW5mbygnUGFydGljaXBhdGluZyBpbiBtdWx0aS1hZ2VudCBjb2xsYWJvcmF0aW9uIGZvciBhdHRyaWJ1dGlvbicsIHtcbiAgICAgIHNlc3Npb25JZDogcmVxdWVzdC5zZXNzaW9uSWQsXG4gICAgICBvYmplY3RpdmU6IHJlcXVlc3Qub2JqZWN0aXZlXG4gICAgfSk7XG5cbiAgICAvLyBQcm92aWRlIGF0dHJpYnV0aW9uIGluc2lnaHRzIGZvciBjb2xsYWJvcmF0aW9uXG4gICAgY29uc3QgaW5zaWdodHMgPSBhd2FpdCB0aGlzLmdldFJlY2VudEluc2lnaHRzKCk7XG4gICAgY29uc3QgbWV0cmljcyA9IGF3YWl0IHRoaXMuZ2V0QXR0cmlidXRpb25NZXRyaWNzKCk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgYWdlbnRJZDogJ2F0dHJpYnV0aW9uX2VuZ2luZScsXG4gICAgICBpbnNpZ2h0cyxcbiAgICAgIG1ldHJpY3MsXG4gICAgICByZWNvbW1lbmRhdGlvbnM6IGF3YWl0IHRoaXMuZ2V0QXR0cmlidXRpb25SZWNvbW1lbmRhdGlvbnMoKVxuICAgIH07XG4gIH1cblxuICAvLyBIZWxwZXIgbWV0aG9kcyBmb3IgZ2VuZXJhdGluZyBhY3Rpb25zIGFuZCByZWNvbW1lbmRhdGlvbnNcblxuICBwcml2YXRlIGdlbmVyYXRlQ2hhbm5lbEFjdGlvbnMobWV0cmljczogQ2hhbm5lbFBlcmZvcm1hbmNlLCBjaGFuZ2U6IG51bWJlcik6IEF1dG9ub21vdXNBY3Rpb25bXSB7XG4gICAgY29uc3QgYWN0aW9uczogQXV0b25vbW91c0FjdGlvbltdID0gW107XG5cbiAgICBpZiAoY2hhbmdlID4gMC4zKSB7XG4gICAgICAvLyBDaGFubmVsIHBlcmZvcm1pbmcgd2VsbCAtIHNjYWxlIHVwXG4gICAgICBhY3Rpb25zLnB1c2goe1xuICAgICAgICBpZDogYGFjdGlvbl8ke0RhdGUubm93KCl9X3NjYWxlYCxcbiAgICAgICAgdHlwZTogJ2ltbWVkaWF0ZScsXG4gICAgICAgIGFjdGlvbjogJ3NjYWxlX2hpZ2hfcGVyZm9ybWVycycsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBgU2NhbGUgdXAgJHttZXRyaWNzLmNoYW5uZWx9IGNoYW5uZWwgZHVlIHRvICR7TWF0aC5yb3VuZChjaGFuZ2UgKiAxMDApfSUgaW1wcm92ZW1lbnRgLFxuICAgICAgICB0YXJnZXRFbnRpdHk6IHtcbiAgICAgICAgICB0eXBlOiBtZXRyaWNzLmVudGl0eVR5cGUsXG4gICAgICAgICAgaWQ6IG1ldHJpY3MuY2hhbm5lbFxuICAgICAgICB9LFxuICAgICAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICAgICAgc2NhbGVQZXJjZW50YWdlOiBNYXRoLm1pbig1MCwgTWF0aC5yb3VuZChjaGFuZ2UgKiAxMDApKVxuICAgICAgICB9LFxuICAgICAgICBhcHByb3ZhbFJlcXVpcmVkOiBjaGFuZ2UgPiAwLjUsXG4gICAgICAgIHJpc2tMZXZlbDogY2hhbmdlID4gMC41ID8gJ21lZGl1bScgOiAnbG93J1xuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChjaGFuZ2UgPCAtMC4zKSB7XG4gICAgICAvLyBDaGFubmVsIHVuZGVycGVyZm9ybWluZyAtIGludmVzdGlnYXRlIG9yIHBhdXNlXG4gICAgICBhY3Rpb25zLnB1c2goe1xuICAgICAgICBpZDogYGFjdGlvbl8ke0RhdGUubm93KCl9X3BhdXNlYCxcbiAgICAgICAgdHlwZTogJ2NvbmRpdGlvbmFsJyxcbiAgICAgICAgYWN0aW9uOiAncGF1c2VfdW5kZXJwZXJmb3JtaW5nJyxcbiAgICAgICAgZGVzY3JpcHRpb246IGBDb25zaWRlciBwYXVzaW5nICR7bWV0cmljcy5jaGFubmVsfSBjaGFubmVsIGR1ZSB0byAke01hdGgucm91bmQoTWF0aC5hYnMoY2hhbmdlKSAqIDEwMCl9JSBkZWNsaW5lYCxcbiAgICAgICAgdGFyZ2V0RW50aXR5OiB7XG4gICAgICAgICAgdHlwZTogbWV0cmljcy5lbnRpdHlUeXBlLFxuICAgICAgICAgIGlkOiBtZXRyaWNzLmNoYW5uZWxcbiAgICAgICAgfSxcbiAgICAgICAgcGFyYW1ldGVyczoge1xuICAgICAgICAgIHRocmVzaG9sZDogLTAuNFxuICAgICAgICB9LFxuICAgICAgICB0cmlnZ2VyOiB7XG4gICAgICAgICAgY29uZGl0aW9uOiAncGVyZm9ybWFuY2VfYmVsb3dfdGhyZXNob2xkJyxcbiAgICAgICAgICB0aHJlc2hvbGQ6IC0wLjRcbiAgICAgICAgfSxcbiAgICAgICAgYXBwcm92YWxSZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgcmlza0xldmVsOiAnbWVkaXVtJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGFjdGlvbnM7XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlSm91cm5leUluc2lnaHRzKHBhdHRlcm46IEpvdXJuZXlQYXR0ZXJuKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IGluc2lnaHRzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgaWYgKHBhdHRlcm4uYXZnVGltZVRvQ29udmVyc2lvbiA8IDI0KSB7XG4gICAgICBpbnNpZ2h0cy5wdXNoKCdGYXN0IGNvbnZlcnNpb24gam91cm5leSAtIGN1c3RvbWVycyBkZWNpZGUgcXVpY2tseScpO1xuICAgIH0gZWxzZSBpZiAocGF0dGVybi5hdmdUaW1lVG9Db252ZXJzaW9uID4gMTY4KSB7XG4gICAgICBpbnNpZ2h0cy5wdXNoKCdMb25nIGNvbnNpZGVyYXRpb24gcGVyaW9kIC0gbnVydHVyaW5nIHJlcXVpcmVkJyk7XG4gICAgfVxuXG4gICAgaWYgKHBhdHRlcm4uY2hhbm5lbHMubGVuZ3RoID4gMykge1xuICAgICAgaW5zaWdodHMucHVzaCgnTXVsdGktY2hhbm5lbCBqb3VybmV5IC0gY29vcmRpbmF0aW9uIGltcG9ydGFudCcpO1xuICAgIH1cblxuICAgIGlmIChwYXR0ZXJuLmF2Z1ZhbHVlID4gMTAwMCkge1xuICAgICAgaW5zaWdodHMucHVzaCgnSGlnaC12YWx1ZSBjb252ZXJzaW9uIHBhdGggLSBwcmlvcml0aXplIG9wdGltaXphdGlvbicpO1xuICAgIH1cblxuICAgIHJldHVybiBpbnNpZ2h0cztcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVKb3VybmV5QWN0aW9ucyhwYXR0ZXJuOiBKb3VybmV5UGF0dGVybik6IEF1dG9ub21vdXNBY3Rpb25bXSB7XG4gICAgcmV0dXJuIFt7XG4gICAgICBpZDogYGFjdGlvbl8ke0RhdGUubm93KCl9X29wdGltaXplX2pvdXJuZXlgLFxuICAgICAgdHlwZTogJ3NjaGVkdWxlZCcsXG4gICAgICBhY3Rpb246ICdvcHRpbWl6ZV9qb3VybmV5JyxcbiAgICAgIGRlc2NyaXB0aW9uOiBgT3B0aW1pemUgaGlnaC12YWx1ZSBqb3VybmV5IHBhdHRlcm4gd2l0aCAke3BhdHRlcm4uZnJlcXVlbmN5fSBjb252ZXJzaW9uc2AsXG4gICAgICB0YXJnZXRFbnRpdHk6IHtcbiAgICAgICAgdHlwZTogRW50aXR5VHlwZS5XT1JLRkxPVyxcbiAgICAgICAgaWQ6ICdqb3VybmV5X29wdGltaXphdGlvbidcbiAgICAgIH0sXG4gICAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICAgIHBhdHRlcm46IHBhdHRlcm4ucGF0dGVybixcbiAgICAgICAgdGFyZ2V0Q29udmVyc2lvblJhdGU6IHBhdHRlcm4uY29udmVyc2lvblJhdGUgKiAxLjJcbiAgICAgIH0sXG4gICAgICBhcHByb3ZhbFJlcXVpcmVkOiBmYWxzZSxcbiAgICAgIHJpc2tMZXZlbDogJ2xvdydcbiAgICB9XTtcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVEcml2ZXJSZWNvbW1lbmRhdGlvbnMoZHJpdmVyczogQ29udmVyc2lvbkRyaXZlcltdKTogQXR0cmlidXRpb25SZWNvbW1lbmRhdGlvbltdIHtcbiAgICByZXR1cm4gZHJpdmVycy5tYXAoZHJpdmVyID0+ICh7XG4gICAgICBpZDogYHJlY29fJHtEYXRlLm5vdygpfV8ke2RyaXZlci5mYWN0b3J9YCxcbiAgICAgIHR5cGU6IGRyaXZlci50eXBlID09PSAnY2hhbm5lbCcgPyAnY2hhbm5lbF9vcHRpbWl6YXRpb24nIDogXG4gICAgICAgICAgICBkcml2ZXIudHlwZSA9PT0gJ3RpbWluZycgPyAndGltaW5nX2NoYW5nZScgOiAnY29udGVudF9hZGp1c3RtZW50JyxcbiAgICAgIHByaW9yaXR5OiBNYXRoLmFicyhkcml2ZXIuaW1wYWN0KSA+IDAuNCA/ICdoaWdoJyA6ICdtZWRpdW0nLFxuICAgICAgZGVzY3JpcHRpb246IGRyaXZlci5kZXNjcmlwdGlvbixcbiAgICAgIGV4cGVjdGVkSW1wYWN0OiB7XG4gICAgICAgIGNvbnZlcnNpb25zOiBkcml2ZXIuaW1wYWN0ICogMjAsXG4gICAgICAgIHJldmVudWU6IGRyaXZlci5pbXBhY3QgKiAyNSxcbiAgICAgICAgY29zdDogNVxuICAgICAgfSxcbiAgICAgIGltcGxlbWVudGF0aW9uOiB7XG4gICAgICAgIGRpZmZpY3VsdHk6ICdtZWRpdW0nLFxuICAgICAgICB0aW1lZnJhbWU6ICcxLTIgd2Vla3MnLFxuICAgICAgICBzdGVwczogW2BBbmFseXplICR7ZHJpdmVyLmZhY3Rvcn1gLCAnSW1wbGVtZW50IGNoYW5nZXMnLCAnTW9uaXRvciByZXN1bHRzJ11cbiAgICAgIH1cbiAgICB9KSk7XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlRHJpdmVyQWN0aW9ucyhkcml2ZXJzOiBDb252ZXJzaW9uRHJpdmVyW10pOiBBdXRvbm9tb3VzQWN0aW9uW10ge1xuICAgIGNvbnN0IGhpZ2hJbXBhY3REcml2ZXJzID0gZHJpdmVycy5maWx0ZXIoZCA9PiBNYXRoLmFicyhkLmltcGFjdCkgPiAwLjQpO1xuICAgIFxuICAgIHJldHVybiBoaWdoSW1wYWN0RHJpdmVycy5tYXAoZHJpdmVyID0+ICh7XG4gICAgICBpZDogYGFjdGlvbl8ke0RhdGUubm93KCl9XyR7ZHJpdmVyLmZhY3Rvcn1gLFxuICAgICAgdHlwZTogJ3NjaGVkdWxlZCcsXG4gICAgICBhY3Rpb246ICdpbXBsZW1lbnRfZHJpdmVyX29wdGltaXphdGlvbicsXG4gICAgICBkZXNjcmlwdGlvbjogYE9wdGltaXplICR7ZHJpdmVyLmZhY3Rvcn0gYmFzZWQgb24gYXR0cmlidXRpb24gYW5hbHlzaXNgLFxuICAgICAgdGFyZ2V0RW50aXR5OiB7XG4gICAgICAgIHR5cGU6IEVudGl0eVR5cGUuQ0FNUEFJR04sXG4gICAgICAgIGlkOiAnYWxsJ1xuICAgICAgfSxcbiAgICAgIHBhcmFtZXRlcnM6IHtcbiAgICAgICAgZHJpdmVyLFxuICAgICAgICBvcHRpbWl6YXRpb246IGRyaXZlci50eXBlXG4gICAgICB9LFxuICAgICAgYXBwcm92YWxSZXF1aXJlZDogZHJpdmVyLnR5cGUgPT09ICdidWRnZXRfcmVhbGxvY2F0aW9uJyxcbiAgICAgIHJpc2tMZXZlbDogZHJpdmVyLnR5cGUgPT09ICdidWRnZXRfcmVhbGxvY2F0aW9uJyA/ICdtZWRpdW0nIDogJ2xvdydcbiAgICB9KSk7XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZVRvdGFsSW1wYWN0KHJlY29tbWVuZGF0aW9uczogQXR0cmlidXRpb25SZWNvbW1lbmRhdGlvbltdKTogQnVzaW5lc3NJbXBhY3Qge1xuICAgIGNvbnN0IGN1cnJlbnQgPSB7IHJldmVudWU6IDEwMDAwMCwgY29udmVyc2lvbnM6IDEwMDAgfTsgLy8gRXhhbXBsZSBiYXNlbGluZVxuICAgIFxuICAgIGNvbnN0IHByb2plY3RlZFJldmVudWUgPSByZWNvbW1lbmRhdGlvbnMucmVkdWNlKChzdW0sIHIpID0+IFxuICAgICAgc3VtICsgKGN1cnJlbnQucmV2ZW51ZSAqIChyLmV4cGVjdGVkSW1wYWN0LnJldmVudWUgLyAxMDApKSwgY3VycmVudC5yZXZlbnVlKTtcbiAgICBcbiAgICBjb25zdCBwcm9qZWN0ZWRDb252ZXJzaW9ucyA9IHJlY29tbWVuZGF0aW9ucy5yZWR1Y2UoKHN1bSwgcikgPT4gXG4gICAgICBzdW0gKyAoY3VycmVudC5jb252ZXJzaW9ucyAqIChyLmV4cGVjdGVkSW1wYWN0LmNvbnZlcnNpb25zIC8gMTAwKSksIGN1cnJlbnQuY29udmVyc2lvbnMpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHJldmVudWU6IHtcbiAgICAgICAgY3VycmVudDogY3VycmVudC5yZXZlbnVlLFxuICAgICAgICBwcm9qZWN0ZWQ6IHByb2plY3RlZFJldmVudWUsXG4gICAgICAgIGNoYW5nZTogKHByb2plY3RlZFJldmVudWUgLSBjdXJyZW50LnJldmVudWUpIC8gY3VycmVudC5yZXZlbnVlXG4gICAgICB9LFxuICAgICAgY29udmVyc2lvbnM6IHtcbiAgICAgICAgY3VycmVudDogY3VycmVudC5jb252ZXJzaW9ucyxcbiAgICAgICAgcHJvamVjdGVkOiBwcm9qZWN0ZWRDb252ZXJzaW9ucyxcbiAgICAgICAgY2hhbmdlOiAocHJvamVjdGVkQ29udmVyc2lvbnMgLSBjdXJyZW50LmNvbnZlcnNpb25zKSAvIGN1cnJlbnQuY29udmVyc2lvbnNcbiAgICAgIH0sXG4gICAgICBlZmZpY2llbmN5OiB7XG4gICAgICAgIGN1cnJlbnRDUEE6IDUwLFxuICAgICAgICBwcm9qZWN0ZWRDUEE6IDQ1LFxuICAgICAgICBjdXJyZW50Uk9BUzogNCxcbiAgICAgICAgcHJvamVjdGVkUk9BUzogNC41XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVPcHRpbWl6YXRpb25BY3Rpb25zKHJlY29tbWVuZGF0aW9uczogQXR0cmlidXRpb25SZWNvbW1lbmRhdGlvbltdKTogQXV0b25vbW91c0FjdGlvbltdIHtcbiAgICByZXR1cm4gcmVjb21tZW5kYXRpb25zXG4gICAgICAuZmlsdGVyKHIgPT4gci5wcmlvcml0eSA9PT0gJ2hpZ2gnKVxuICAgICAgLm1hcChyID0+ICh7XG4gICAgICAgIGlkOiBgYWN0aW9uXyR7RGF0ZS5ub3coKX1fJHtyLnR5cGV9YCxcbiAgICAgICAgdHlwZTogJ3NjaGVkdWxlZCcgYXMgY29uc3QsXG4gICAgICAgIGFjdGlvbjogYGltcGxlbWVudF8ke3IudHlwZX1gLFxuICAgICAgICBkZXNjcmlwdGlvbjogci5kZXNjcmlwdGlvbixcbiAgICAgICAgdGFyZ2V0RW50aXR5OiB7XG4gICAgICAgICAgdHlwZTogRW50aXR5VHlwZS5DQU1QQUlHTixcbiAgICAgICAgICBpZDogJ29wdGltaXphdGlvbl90YXJnZXQnXG4gICAgICAgIH0sXG4gICAgICAgIHBhcmFtZXRlcnM6IHtcbiAgICAgICAgICByZWNvbW1lbmRhdGlvbjogcixcbiAgICAgICAgICBzdGVwczogci5pbXBsZW1lbnRhdGlvbi5zdGVwc1xuICAgICAgICB9LFxuICAgICAgICBhcHByb3ZhbFJlcXVpcmVkOiByLmltcGxlbWVudGF0aW9uLmRpZmZpY3VsdHkgPT09ICdoYXJkJyxcbiAgICAgICAgcmlza0xldmVsOiByLmltcGxlbWVudGF0aW9uLmRpZmZpY3VsdHkgPT09ICdoYXJkJyA/ICdoaWdoJyA6IFxuICAgICAgICAgICAgICAgICAgIHIuaW1wbGVtZW50YXRpb24uZGlmZmljdWx0eSA9PT0gJ21lZGl1bScgPyAnbWVkaXVtJyA6ICdsb3cnXG4gICAgICB9KSk7XG4gIH1cblxuICAvLyBTdHViIG1ldGhvZHMgZm9yIHNwZWNpZmljIGFuYWx5c2VzXG4gIHByaXZhdGUgYXN5bmMgYW5hbHl6ZUNoYW5uZWxTZXF1ZW5jZSgpOiBQcm9taXNlPENvbnZlcnNpb25Ecml2ZXIgfCBudWxsPiB7XG4gICAgLy8gSW1wbGVtZW50YXRpb24gd291bGQgYW5hbHl6ZSBvcHRpbWFsIGNoYW5uZWwgc2VxdWVuY2VzXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGFuYWx5emVDb252ZXJzaW9uVGltaW5nKCk6IFByb21pc2U8Q29udmVyc2lvbkRyaXZlciB8IG51bGw+IHtcbiAgICAvLyBJbXBsZW1lbnRhdGlvbiB3b3VsZCBhbmFseXplIG9wdGltYWwgdGltaW5nIHBhdHRlcm5zXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGFuYWx5emVUb3VjaHBvaW50RnJlcXVlbmN5KCk6IFByb21pc2U8Q29udmVyc2lvbkRyaXZlciB8IG51bGw+IHtcbiAgICAvLyBJbXBsZW1lbnRhdGlvbiB3b3VsZCBhbmFseXplIG9wdGltYWwgY29udGFjdCBmcmVxdWVuY3lcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgYW5hbHl6ZUNvbnRlbnRQZXJmb3JtYW5jZSgpOiBQcm9taXNlPENvbnZlcnNpb25Ecml2ZXIgfCBudWxsPiB7XG4gICAgLy8gSW1wbGVtZW50YXRpb24gd291bGQgYW5hbHl6ZSBjb250ZW50IGVmZmVjdGl2ZW5lc3NcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2V0Q3VycmVudENoYW5uZWxNZXRyaWNzKGtleTogc3RyaW5nKTogUHJvbWlzZTxDaGFubmVsUGVyZm9ybWFuY2UgfCBudWxsPiB7XG4gICAgLy8gSW1wbGVtZW50YXRpb24gd291bGQgZmV0Y2ggY3VycmVudCBtZXRyaWNzXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGRldGVjdFVudXN1YWxKb3VybmV5cygpOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gICAgLy8gSW1wbGVtZW50YXRpb24gd291bGQgZGV0ZWN0IGFub21hbG91cyBqb3VybmV5IHBhdHRlcm5zXG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBhbmFseXplQnVkZ2V0QWxsb2NhdGlvbigpOiBQcm9taXNlPEF0dHJpYnV0aW9uUmVjb21tZW5kYXRpb24gfCBudWxsPiB7XG4gICAgLy8gSW1wbGVtZW50YXRpb24gd291bGQgYW5hbHl6ZSBhbmQgcmVjb21tZW5kIGJ1ZGdldCBjaGFuZ2VzXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIG9wdGltaXplQ2hhbm5lbE1peCgpOiBQcm9taXNlPEF0dHJpYnV0aW9uUmVjb21tZW5kYXRpb24gfCBudWxsPiB7XG4gICAgLy8gSW1wbGVtZW50YXRpb24gd291bGQgcmVjb21tZW5kIGNoYW5uZWwgbWl4IGNoYW5nZXNcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgb3B0aW1pemVDdXN0b21lckpvdXJuZXlzKCk6IFByb21pc2U8QXR0cmlidXRpb25SZWNvbW1lbmRhdGlvbiB8IG51bGw+IHtcbiAgICAvLyBJbXBsZW1lbnRhdGlvbiB3b3VsZCByZWNvbW1lbmQgam91cm5leSBvcHRpbWl6YXRpb25zXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIG9wdGltaXplQ2FtcGFpZ25UaW1pbmcoKTogUHJvbWlzZTxBdHRyaWJ1dGlvblJlY29tbWVuZGF0aW9uIHwgbnVsbD4ge1xuICAgIC8vIEltcGxlbWVudGF0aW9uIHdvdWxkIHJlY29tbWVuZCB0aW1pbmcgb3B0aW1pemF0aW9uc1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBxdWV1ZUZvckFwcHJvdmFsKGFjdGlvbjogQXV0b25vbW91c0FjdGlvbiwgaW5zaWdodDogQXR0cmlidXRpb25JbnNpZ2h0KSB7XG4gICAgbG9nZ2VyLmluZm8oJ1F1ZXVlaW5nIGFjdGlvbiBmb3IgYXBwcm92YWwnLCB7XG4gICAgICBhY3Rpb25JZDogYWN0aW9uLmlkLFxuICAgICAgaW5zaWdodElkOiBpbnNpZ2h0LmlkXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHNjaGVkdWxlQWN0aW9uKGFjdGlvbjogQXV0b25vbW91c0FjdGlvbikge1xuICAgIGxvZ2dlci5pbmZvKCdTY2hlZHVsaW5nIGFjdGlvbiBmb3IgbGF0ZXIgZXhlY3V0aW9uJywge1xuICAgICAgYWN0aW9uSWQ6IGFjdGlvbi5pZFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBzZXR1cENvbmRpdGlvbmFsVHJpZ2dlcihhY3Rpb246IEF1dG9ub21vdXNBY3Rpb24pIHtcbiAgICBsb2dnZXIuaW5mbygnU2V0dGluZyB1cCBjb25kaXRpb25hbCB0cmlnZ2VyIGZvciBhY3Rpb24nLCB7XG4gICAgICBhY3Rpb25JZDogYWN0aW9uLmlkLFxuICAgICAgdHJpZ2dlcjogYWN0aW9uLnRyaWdnZXJcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZXhlY3V0ZUJ1ZGdldFJlYWxsb2NhdGlvbihhY3Rpb246IEF1dG9ub21vdXNBY3Rpb24pIHtcbiAgICBsb2dnZXIuaW5mbygnRXhlY3V0aW5nIGJ1ZGdldCByZWFsbG9jYXRpb24nLCBhY3Rpb24ucGFyYW1ldGVycyk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGV4ZWN1dGVDaGFubmVsTWl4QWRqdXN0bWVudChhY3Rpb246IEF1dG9ub21vdXNBY3Rpb24pIHtcbiAgICBsb2dnZXIuaW5mbygnRXhlY3V0aW5nIGNoYW5uZWwgbWl4IGFkanVzdG1lbnQnLCBhY3Rpb24ucGFyYW1ldGVycyk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGV4ZWN1dGVKb3VybmV5T3B0aW1pemF0aW9uKGFjdGlvbjogQXV0b25vbW91c0FjdGlvbikge1xuICAgIGxvZ2dlci5pbmZvKCdFeGVjdXRpbmcgam91cm5leSBvcHRpbWl6YXRpb24nLCBhY3Rpb24ucGFyYW1ldGVycyk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHVwZGF0ZUF0dHJpYnV0aW9uTW9kZWwoYWN0aW9uOiBBdXRvbm9tb3VzQWN0aW9uKSB7XG4gICAgbG9nZ2VyLmluZm8oJ1VwZGF0aW5nIGF0dHJpYnV0aW9uIG1vZGVsJywgYWN0aW9uLnBhcmFtZXRlcnMpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBwYXVzZVVuZGVycGVyZm9ybWluZ0NoYW5uZWxzKGFjdGlvbjogQXV0b25vbW91c0FjdGlvbikge1xuICAgIGxvZ2dlci5pbmZvKCdQYXVzaW5nIHVuZGVycGVyZm9ybWluZyBjaGFubmVscycsIGFjdGlvbi5wYXJhbWV0ZXJzKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgc2NhbGVIaWdoUGVyZm9ybWluZ0NoYW5uZWxzKGFjdGlvbjogQXV0b25vbW91c0FjdGlvbikge1xuICAgIGxvZ2dlci5pbmZvKCdTY2FsaW5nIGhpZ2ggcGVyZm9ybWluZyBjaGFubmVscycsIGFjdGlvbi5wYXJhbWV0ZXJzKTtcbiAgfVxuXG4gIHByaXZhdGUgc3RvcmVJbnNpZ2h0cyhpbnNpZ2h0czogQXR0cmlidXRpb25JbnNpZ2h0W10pIHtcbiAgICBjb25zdCBrZXkgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTsgLy8gRGFpbHkga2V5XG4gICAgXG4gICAgaWYgKCF0aGlzLmluc2lnaHRIaXN0b3J5LmhhcyhrZXkpKSB7XG4gICAgICB0aGlzLmluc2lnaHRIaXN0b3J5LnNldChrZXksIFtdKTtcbiAgICB9XG4gICAgXG4gICAgdGhpcy5pbnNpZ2h0SGlzdG9yeS5nZXQoa2V5KSEucHVzaCguLi5pbnNpZ2h0cyk7XG4gICAgXG4gICAgLy8gS2VlcCBvbmx5IGxhc3QgMzAgZGF5c1xuICAgIGNvbnN0IGN1dG9mZiA9IG5ldyBEYXRlKCk7XG4gICAgY3V0b2ZmLnNldERhdGUoY3V0b2ZmLmdldERhdGUoKSAtIDMwKTtcbiAgICBcbiAgICBmb3IgKGNvbnN0IFtkYXRlLCBfXSBvZiB0aGlzLmluc2lnaHRIaXN0b3J5LmVudHJpZXMoKSkge1xuICAgICAgaWYgKG5ldyBEYXRlKGRhdGUpIDwgY3V0b2ZmKSB7XG4gICAgICAgIHRoaXMuaW5zaWdodEhpc3RvcnkuZGVsZXRlKGRhdGUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhbnVwIGFuZCBzdG9wIHRoZSBlbmdpbmVcbiAgICovXG4gIGRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMuYW5hbHlzaXNJbnRlcnZhbCkge1xuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmFuYWx5c2lzSW50ZXJ2YWwpO1xuICAgICAgdGhpcy5hbmFseXNpc0ludGVydmFsID0gbnVsbDtcbiAgICB9XG4gICAgXG4gICAgdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoKTtcbiAgICBsb2dnZXIuaW5mbygnQXV0b25vbW91cyBhdHRyaWJ1dGlvbiBlbmdpbmUgZGVzdHJveWVkJyk7XG4gIH1cbn1cblxuLy8gRXhwb3J0IHNpbmdsZXRvbiBpbnN0YW5jZVxuZXhwb3J0IGNvbnN0IGF1dG9ub21vdXNBdHRyaWJ1dGlvbkVuZ2luZSA9IG5ldyBBdXRvbm9tb3VzQXR0cmlidXRpb25FbmdpbmUoKTtcblxuLy8gRXhwb3J0IHR5cGVzXG5leHBvcnQgeyBBdXRvbm9tb3VzQXR0cmlidXRpb25FbmdpbmUgfTsiXSwibmFtZXMiOlsiQXV0b25vbW91c0F0dHJpYnV0aW9uRW5naW5lIiwiYXV0b25vbW91c0F0dHJpYnV0aW9uRW5naW5lIiwiRXZlbnRFbWl0dGVyIiwiY29uc3RydWN0b3IiLCJhbmFseXNpc0ludGVydmFsIiwiZGVjaXNpb25RdWV1ZSIsImluc2lnaHRIaXN0b3J5IiwiTWFwIiwicGVyZm9ybWFuY2VCYXNlbGluZSIsImluaXRpYWxpemVFbmdpbmUiLCJsb2dnZXIiLCJpbmZvIiwibG9hZFBlcmZvcm1hbmNlQmFzZWxpbmVzIiwic3RhcnRDb250aW51b3VzQW5hbHlzaXMiLCJyZWdpc3RlcldpdGhEZWNpc2lvbkVuZ2luZXMiLCJlcnJvciIsIkVycm9yIiwibWVzc2FnZSIsIlN0cmluZyIsInRoaXJ0eURheXNBZ28iLCJEYXRlIiwic2V0RGF0ZSIsImdldERhdGUiLCJjb252ZXJzaW9ucyIsInByaXNtYSIsImNvbnZlcnNpb25UcmFja2luZyIsImZpbmRNYW55Iiwid2hlcmUiLCJvY2N1cnJlZEF0IiwiZ3RlIiwiaW5jbHVkZSIsImV2ZW50IiwiY2hhbm5lbERhdGEiLCJjb252ZXJzaW9uIiwidG91Y2hQb2ludHMiLCJKU09OIiwicGFyc2UiLCJ0b3VjaFBvaW50Iiwia2V5IiwiZW50aXR5VHlwZSIsInR5cGUiLCJoYXMiLCJzZXQiLCJyZXZlbnVlIiwiZGF0YSIsImdldCIsInZhbHVlIiwicHVzaCIsImVudHJpZXMiLCJjaGFubmVsIiwic3BsaXQiLCJwZXJmb3JtYW5jZSIsImNvc3QiLCJyb2kiLCJyb2FzIiwiYXR0cmlidXRpb24iLCJmaXJzdFRvdWNoIiwibGFzdFRvdWNoIiwibGluZWFyIiwidGltZURlY2F5IiwicG9zaXRpb25CYXNlZCIsInRyZW5kIiwiY2hhbm5lbHMiLCJzaXplIiwic2V0SW50ZXJ2YWwiLCJwZXJmb3JtQXR0cmlidXRpb25BbmFseXNpcyIsInRyYWNlciIsInRyYWNlIiwiZ2V0VHJhY2VyIiwic3RhcnRBY3RpdmVTcGFuIiwic3BhbiIsInNldEF0dHJpYnV0ZXMiLCJub3ciLCJjaGFubmVsSW5zaWdodHMiLCJhbmFseXplQ2hhbm5lbFBlcmZvcm1hbmNlIiwiam91cm5leUluc2lnaHRzIiwiYW5hbHl6ZUpvdXJuZXlQYXR0ZXJucyIsImRyaXZlckluc2lnaHRzIiwiaWRlbnRpZnlDb252ZXJzaW9uRHJpdmVycyIsImFub21hbHlJbnNpZ2h0cyIsImRldGVjdEF0dHJpYnV0aW9uQW5vbWFsaWVzIiwib3B0aW1pemF0aW9uSW5zaWdodHMiLCJnZW5lcmF0ZU9wdGltaXphdGlvbk9wcG9ydHVuaXRpZXMiLCJhbGxJbnNpZ2h0cyIsImluc2lnaHQiLCJhY3Rpb25SZXF1aXJlZCIsInN1Z2dlc3RlZEFjdGlvbnMiLCJwcm9jZXNzQXV0b25vbW91c0FjdGlvbnMiLCJzdG9yZUluc2lnaHRzIiwiZW1pdCIsInRpbWVzdGFtcCIsImluc2lnaHRDb3VudCIsImxlbmd0aCIsImFjdGlvbnNHZW5lcmF0ZWQiLCJpbnNpZ2h0cyIsImFjdGlvbnMiLCJzZXRTdGF0dXMiLCJjb2RlIiwiZW5kIiwic2V2ZW5EYXlzQWdvIiwiY2hhbm5lbE1ldHJpY3MiLCJtb2RlbHMiLCJBdHRyaWJ1dGlvbk1vZGVsIiwiRklSU1RfVE9VQ0giLCJMQVNUX1RPVUNIIiwiTElORUFSIiwiVElNRV9ERUNBWSIsIlBPU0lUSU9OX0JBU0VEIiwibW9kZWwiLCJhdHRyaWJ1dGVkVG91Y2hQb2ludHMiLCJhcHBseUF0dHJpYnV0aW9uTW9kZWwiLCJtZXRyaWNzIiwiYXR0cmlidXRpb25LZXkiLCJ0b0xvd2VyQ2FzZSIsInJlcGxhY2UiLCJ3ZWlnaHQiLCJiYXNlbGluZSIsImNvbnZlcnNpb25DaGFuZ2UiLCJNYXRoIiwiYWJzIiwiaWQiLCJyYW5kb20iLCJ0b1N0cmluZyIsInN1YnN0ciIsImNvbmZpZGVuY2UiLCJyb3VuZCIsImRldGFpbHMiLCJpbXBhY3QiLCJjdXJyZW50IiwicHJvamVjdGVkIiwiY2hhbmdlIiwiZWZmaWNpZW5jeSIsImN1cnJlbnRDUEEiLCJwcm9qZWN0ZWRDUEEiLCJjdXJyZW50Uk9BUyIsInByb2plY3RlZFJPQVMiLCJnZW5lcmF0ZUNoYW5uZWxBY3Rpb25zIiwibm90IiwidGFrZSIsIm9yZGVyQnkiLCJwYXR0ZXJuTWFwIiwicGF0dGVybktleSIsIm1hcCIsInRwIiwiam9pbiIsInBhdHRlcm4iLCJmcmVxdWVuY3kiLCJhdmdUaW1lVG9Db252ZXJzaW9uIiwiYXZnVmFsdWUiLCJjb252ZXJzaW9uUmF0ZSIsIlNldCIsInNpZ25pZmljYW5jZSIsInRpbWVUb0NvbnZlcnNpb24iLCJnZXRUaW1lIiwidG90YWxDb252ZXJzaW9ucyIsInZhbHVlcyIsImdlbmVyYXRlSm91cm5leUluc2lnaHRzIiwibWluIiwiam91cm5leVBhdHRlcm5zIiwiZ2VuZXJhdGVKb3VybmV5QWN0aW9ucyIsInVuZGVmaW5lZCIsImRyaXZlcnMiLCJzZXF1ZW5jZURyaXZlciIsImFuYWx5emVDaGFubmVsU2VxdWVuY2UiLCJ0aW1pbmdEcml2ZXIiLCJhbmFseXplQ29udmVyc2lvblRpbWluZyIsImZyZXF1ZW5jeURyaXZlciIsImFuYWx5emVUb3VjaHBvaW50RnJlcXVlbmN5IiwiY29udGVudERyaXZlciIsImFuYWx5emVDb250ZW50UGVyZm9ybWFuY2UiLCJzaWduaWZpY2FudERyaXZlcnMiLCJmaWx0ZXIiLCJkIiwiY29udmVyc2lvbkRyaXZlcnMiLCJyZWNvbW1lbmRhdGlvbnMiLCJnZW5lcmF0ZURyaXZlclJlY29tbWVuZGF0aW9ucyIsInNvbWUiLCJnZW5lcmF0ZURyaXZlckFjdGlvbnMiLCJhbm9tYWxpZXMiLCJnZXRDdXJyZW50Q2hhbm5lbE1ldHJpY3MiLCJyZXZlbnVlQ2hhbmdlIiwibWF4IiwidW51c3VhbFBhdHRlcm5zIiwiZGV0ZWN0VW51c3VhbEpvdXJuZXlzIiwiYSIsIkVudGl0eVR5cGUiLCJDQU1QQUlHTiIsImFjdGlvbiIsImRlc2NyaXB0aW9uIiwidGFyZ2V0RW50aXR5IiwicGFyYW1ldGVycyIsImFwcHJvdmFsUmVxdWlyZWQiLCJyaXNrTGV2ZWwiLCJidWRnZXRSZWNvIiwiYW5hbHl6ZUJ1ZGdldEFsbG9jYXRpb24iLCJjaGFubmVsTWl4UmVjbyIsIm9wdGltaXplQ2hhbm5lbE1peCIsImpvdXJuZXlSZWNvIiwib3B0aW1pemVDdXN0b21lckpvdXJuZXlzIiwidGltaW5nUmVjbyIsIm9wdGltaXplQ2FtcGFpZ25UaW1pbmciLCJjYWxjdWxhdGVUb3RhbEltcGFjdCIsInIiLCJwcmlvcml0eSIsImdlbmVyYXRlT3B0aW1pemF0aW9uQWN0aW9ucyIsInF1ZXVlRm9yQXBwcm92YWwiLCJleGVjdXRlQXV0b25vbW91c0FjdGlvbiIsInNjaGVkdWxlQWN0aW9uIiwic2V0dXBDb25kaXRpb25hbFRyaWdnZXIiLCJhY3Rpb25JZCIsImV4ZWN1dGVCdWRnZXRSZWFsbG9jYXRpb24iLCJleGVjdXRlQ2hhbm5lbE1peEFkanVzdG1lbnQiLCJleGVjdXRlSm91cm5leU9wdGltaXphdGlvbiIsInVwZGF0ZUF0dHJpYnV0aW9uTW9kZWwiLCJwYXVzZVVuZGVycGVyZm9ybWluZ0NoYW5uZWxzIiwic2NhbGVIaWdoUGVyZm9ybWluZ0NoYW5uZWxzIiwid2FybiIsInN1Y2Nlc3MiLCJzdHJhdGVnaWNEZWNpc2lvbkVuZ2luZSIsInJlZ2lzdGVyRGF0YVByb3ZpZGVyIiwiZ2V0SW5zaWdodHMiLCJnZXRSZWNlbnRJbnNpZ2h0cyIsImdldE1ldHJpY3MiLCJnZXRBdHRyaWJ1dGlvbk1ldHJpY3MiLCJnZXRSZWNvbW1lbmRhdGlvbnMiLCJnZXRBdHRyaWJ1dGlvblJlY29tbWVuZGF0aW9ucyIsInJlYWx0aW1lRGVjaXNpb25FbmdpbmUiLCJyZWdpc3RlckhhbmRsZXIiLCJoYW5kbGVSZWFsdGltZUF0dHJpYnV0aW9uQ2hhbmdlIiwibXVsdGlBZ2VudENvb3JkaW5hdG9yIiwib24iLCJyZXF1ZXN0IiwiY2FwYWJpbGl0aWVzIiwiaW5jbHVkZXMiLCJwYXJ0aWNpcGF0ZUluQ29sbGFib3JhdGlvbiIsImhvdXJzIiwiY3V0b2ZmIiwic2V0SG91cnMiLCJnZXRIb3VycyIsImkiLCJzb3J0IiwiYiIsInRvdGFsUmV2ZW51ZSIsInRvcENoYW5uZWxzIiwiYXR0cmlidXRpb25IZWFsdGgiLCJyZWNlbnRDb252ZXJzaW9ucyIsInJlZHVjZSIsInN1bSIsImMiLCJwcmlvcml0eU9yZGVyIiwiaGlnaCIsIm1lZGl1bSIsImxvdyIsInNlc3Npb25JZCIsIm9iamVjdGl2ZSIsImFnZW50SWQiLCJzY2FsZVBlcmNlbnRhZ2UiLCJ0aHJlc2hvbGQiLCJ0cmlnZ2VyIiwiY29uZGl0aW9uIiwiV09SS0ZMT1ciLCJ0YXJnZXRDb252ZXJzaW9uUmF0ZSIsImRyaXZlciIsImZhY3RvciIsImV4cGVjdGVkSW1wYWN0IiwiaW1wbGVtZW50YXRpb24iLCJkaWZmaWN1bHR5IiwidGltZWZyYW1lIiwic3RlcHMiLCJoaWdoSW1wYWN0RHJpdmVycyIsIm9wdGltaXphdGlvbiIsInByb2plY3RlZFJldmVudWUiLCJwcm9qZWN0ZWRDb252ZXJzaW9ucyIsInJlY29tbWVuZGF0aW9uIiwiaW5zaWdodElkIiwidG9JU09TdHJpbmciLCJkYXRlIiwiXyIsImRlbGV0ZSIsImRlc3Ryb3kiLCJjbGVhckludGVydmFsIiwicmVtb3ZlQWxsTGlzdGVuZXJzIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Q0FLQzs7Ozs7Ozs7Ozs7SUE0dkNRQSwyQkFBMkI7ZUFBM0JBOztJQUhJQywyQkFBMkI7ZUFBM0JBOzs7d0JBdnZDVTtxQkFDRDsrREFDSDt3QkFDVTt3QkFPdEI7cUNBTUE7eUNBQ2lDO3dDQUNEO3VDQUNEOzs7Ozs7QUFpSHRDLE1BQU1ELG9DQUFvQ0Usb0JBQVk7SUFNcERDLGFBQWM7UUFDWixLQUFLLFNBTkNDLG1CQUEwQyxXQUMxQ0MsZ0JBQW9DLEVBQUUsT0FDdENDLGlCQUFvRCxJQUFJQyxZQUN4REMsc0JBQXVELElBQUlEO1FBSWpFLElBQUksQ0FBQ0UsZ0JBQWdCO0lBQ3ZCO0lBRUE7O0dBRUMsR0FDRCxNQUFjQSxtQkFBbUI7UUFDL0IsSUFBSTtZQUNGQyxjQUFNLENBQUNDLElBQUksQ0FBQztZQUVaLDZCQUE2QjtZQUM3QixNQUFNLElB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